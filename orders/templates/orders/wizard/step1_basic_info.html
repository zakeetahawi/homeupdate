{% extends 'orders/wizard/base_wizard.html' %}
{% load static %}

{% block wizard_content %}

<!-- رسالة وضع التعديل -->
{% if editing_mode and editing_order %}
<div class="alert alert-info alert-dismissible fade show mb-4" role="alert">
    <i class="fas fa-edit me-2"></i>
    <strong>وضع التعديل:</strong> 
    أنت الآن تقوم بتعديل الطلب 
    <a href="{% url 'orders:order_detail_by_number' editing_order.order_number %}" target="_blank" class="alert-link">
        #{{ editing_order.order_number }}
    </a>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

<form method="post" id="step1-form">
    {% csrf_token %}
    
    <div class="row">
        <div class="col-md-6">
            <!-- Customer -->
            <div class="mb-4">
                <label for="{{ form.customer.id_for_label }}" class="form-label fw-bold">
                    <i class="fas fa-user me-2"></i>العميل
                    <span class="text-danger">*</span>
                </label>
                {{ form.customer }}
                {% if form.customer.errors %}
                    <div class="text-danger mt-1">
                        {{ form.customer.errors }}
                    </div>
                {% endif %}
                <div class="form-text">
                    <i class="fas fa-info-circle me-1"></i>
                    اختر العميل من القائمة
                </div>
            </div>
            
            <!-- Branch -->
            <div class="mb-4">
                <label for="{{ form.branch.id_for_label }}" class="form-label fw-bold">
                    <i class="fas fa-building me-2"></i>الفرع
                    <span class="text-danger">*</span>
                </label>
                {{ form.branch }}
                {% if form.branch.errors %}
                    <div class="text-danger mt-1">
                        {{ form.branch.errors }}
                    </div>
                {% endif %}
            </div>
            
            <!-- Salesperson -->
            <div class="mb-4">
                <label for="{{ form.salesperson.id_for_label }}" class="form-label fw-bold">
                    <i class="fas fa-user-tie me-2"></i>البائع
                    <span class="text-danger">*</span>
                </label>
                {{ form.salesperson }}
                {% if form.salesperson.errors %}
                    <div class="text-danger mt-1">
                        {{ form.salesperson.errors }}
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="col-md-6">
            <!-- Status -->
            <div class="mb-4">
                <label for="{{ form.status.id_for_label }}" class="form-label fw-bold">
                    <i class="fas fa-crown me-2"></i>وضع العميل
                </label>
                {{ form.status }}
                {% if form.status.errors %}
                    <div class="text-danger mt-1">
                        {{ form.status.errors }}
                    </div>
                {% endif %}
                <div class="form-text">
                    <i class="fas fa-info-circle me-1"></i>
                    حدد ما إذا كان العميل VIP أم عادي
                </div>
            </div>
            
            <!-- Notes -->
            <div class="mb-4">
                <label for="{{ form.notes.id_for_label }}" class="form-label fw-bold">
                    <i class="fas fa-sticky-note me-2"></i>ملاحظات
                </label>
                {{ form.notes }}
                {% if form.notes.errors %}
                    <div class="text-danger mt-1">
                        {{ form.notes.errors }}
                    </div>
                {% endif %}
                <div class="form-text">
                    <i class="fas fa-info-circle me-1"></i>
                    يمكنك إضافة أي ملاحظات إضافية هنا
                </div>
            </div>
        </div>
    </div>
    
    <!-- Actions -->
    <div class="wizard-actions">
        <div>
            <a href="{% url 'orders:wizard_cancel' %}" class="btn btn-wizard btn-wizard-danger">
                <i class="fas fa-times me-2"></i>إلغاء
            </a>
        </div>
        <div>
            <button type="submit" class="btn btn-wizard btn-wizard-primary">
                <i class="fas fa-arrow-left me-2"></i>التالي
            </button>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
$(document).ready(function() {
    // تفعيل Select2 للعملاء
    $('#{{ form.customer.id_for_label }}').select2({
        placeholder: 'ابحث عن العميل...',
        allowClear: true,
        dir: 'rtl'
    });
    
    // تفعيل Select2 للحقول الأخرى
    $('#{{ form.branch.id_for_label }}, #{{ form.salesperson.id_for_label }}').select2({
        dir: 'rtl'
    });
});

// معالجة إرسال النموذج
document.getElementById('step1-form').addEventListener('submit', function(e) {
    e.preventDefault();
    submitWizardStep(this);
});
</script>
{% endblock %}
