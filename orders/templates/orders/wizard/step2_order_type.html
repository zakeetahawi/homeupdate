{% extends 'orders/wizard/base_wizard.html' %}
{% load static %}

{% block wizard_content %}
<form method="post" id="step2-form">
    {% csrf_token %}
    
    <div class="mb-4">
        <h5 class="mb-3">
            <i class="fas fa-tags me-2"></i>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨
            <span class="text-danger">*</span>
        </h5>
        
        {% if form.selected_type.errors %}
            <div class="alert alert-danger">
                {{ form.selected_type.errors }}
            </div>
        {% endif %}
        
        <div class="row g-3">
            {% for choice in form.selected_type.field.choices %}
            <div class="col-md-4">
                <div class="card h-100 order-type-card" onclick="selectOrderType('{{ choice.0 }}')">
                    <div class="card-body text-center">
                        <input type="radio" name="{{ form.selected_type.name }}" 
                               value="{{ choice.0 }}" 
                               id="type_{{ choice.0 }}"
                               {% if form.selected_type.value == choice.0 %}checked{% endif %}
                               style="display: none;">
                        <div class="order-type-icon mb-3">
                            {% if choice.0 == 'accessory' %}
                                <i class="fas fa-gem fa-3x text-primary"></i>
                            {% elif choice.0 == 'installation' %}
                                <i class="fas fa-tools fa-3x text-success"></i>
                            {% elif choice.0 == 'inspection' %}
                                <i class="fas fa-eye fa-3x text-info"></i>
                            {% elif choice.0 == 'tailoring' %}
                                <i class="fas fa-cut fa-3x text-warning"></i>
                            {% elif choice.0 == 'products' %}
                                <i class="fas fa-boxes fa-3x text-secondary"></i>
                            {% endif %}
                        </div>
                        <h5>{{ choice.1 }}</h5>
                        <small class="text-muted d-block mt-2">
                            {% if choice.0 == 'accessory' %}
                                ğŸ”§ Ù…ÙˆØ¬Ù‡ Ø¥Ù„Ù‰ ÙˆØ±Ø´Ø© Ø§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±
                            {% elif choice.0 == 'installation' %}
                                ğŸ­ Ù…ÙˆØ¬Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØµÙ†Ø¹
                            {% elif choice.0 == 'tailoring' %}
                                ğŸ“¦ Ù…ÙˆØ¬Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØµÙ†Ø¹
                            {% elif choice.0 == 'inspection' %}
                                ğŸ‘ï¸ Ù…ÙˆØ¬Ù‡ Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª
                            {% elif choice.0 == 'products' %}
                                ğŸ“¦ Ù…ÙˆØ¬Ù‡ Ù„Ù„Ù…Ø®Ø§Ø²Ù†
                            {% endif %}
                        </small>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- Related Inspection (shown conditionally) -->
    <div id="related-inspection-section" style="display: none;">
        <div class="mb-4">
            <label for="{{ form.related_inspection.id_for_label }}" class="form-label fw-bold">
                <i class="fas fa-eye me-2"></i>Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø±ØªØ¨Ø·Ø©
            </label>
            {{ form.related_inspection }}
            <div class="form-text">
                <i class="fas fa-info-circle me-1"></i>
                Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            </div>
        </div>
    </div>
    
    <!-- Actions -->
    <div class="wizard-actions">
        <div>
            <a href="{% url 'orders:wizard_cancel' %}" class="btn btn-wizard btn-wizard-danger me-2">
                <i class="fas fa-times me-2"></i>Ø¥Ù„ØºØ§Ø¡
            </a>
            <a href="{% url 'orders:wizard_step' step=1 %}" class="btn btn-wizard btn-wizard-secondary">
                <i class="fas fa-arrow-right me-2"></i>Ø§Ù„Ø³Ø§Ø¨Ù‚
            </a>
        </div>
        <div>
            <button type="submit" class="btn btn-wizard btn-wizard-primary">
                <i class="fas fa-arrow-left me-2"></i>Ø§Ù„ØªØ§Ù„ÙŠ
            </button>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<style>
.order-type-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid #e2e8f0;
}

.order-type-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.order-type-card.selected {
    border-color: #198754;
    background: #f0fdf4;
    box-shadow: 0 4px 12px rgba(25, 135, 84, 0.3);
}
</style>

<script>
function selectOrderType(type) {
    // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    document.querySelectorAll('.order-type-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const radio = document.getElementById('type_' + type);
    if (radio) {
        radio.checked = true;
        radio.closest('.order-type-card').classList.add('selected');
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
    const relatedInspectionSection = document.getElementById('related-inspection-section');
    if (['installation', 'tailoring', 'accessory'].includes(type)) {
        relatedInspectionSection.style.display = 'block';
    } else {
        relatedInspectionSection.style.display = 'none';
    }
}

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    const selectedRadio = document.querySelector('input[name="{{ form.selected_type.name }}"]:checked');
    if (selectedRadio) {
        selectOrderType(selectedRadio.value);
    }
});

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
document.getElementById('step2-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const selectedType = document.querySelector('input[name="{{ form.selected_type.name }}"]:checked');
    if (!selectedType) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨');
        return;
    }
    
    submitWizardStep(this);
});
</script>
{% endblock %}
