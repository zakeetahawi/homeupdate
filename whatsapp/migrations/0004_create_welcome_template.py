# Generated by Django 6.0 on 2026-01-01 15:37

from django.db import migrations


def create_welcome_template(apps, schema_editor):
    """Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ ØªØ±Ø­ÙŠØ¨ÙŠ ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø¥Ø´Ø¹Ø§Ø±"""
    WhatsAppMessageTemplate = apps.get_model("whatsapp", "WhatsAppMessageTemplate")
    WhatsAppNotificationRule = apps.get_model("whatsapp", "WhatsAppNotificationRule")

    # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ù„Ø¨
    template, created = WhatsAppMessageTemplate.objects.get_or_create(
        name="customer_welcome",
        defaults={
            "message_type": "CUSTOM",
            "language": "ar",
            "template_text": """Ù…Ø±Ø­Ø¨Ø§Ù‹ {customer_name}! ğŸ‘‹

Ù†Ø´ÙƒØ±Ùƒ Ø¹Ù„Ù‰ Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ø®ÙˆØ§Ø¬Ø© Ù„Ù„Ù…ÙØ±ÙˆØ´Ø§Øª ÙˆØ§Ù„Ø³ØªØ§Ø¦Ø± ğŸ‰

Ù†Ø­Ù† Ø³Ø¹Ø¯Ø§Ø¡ Ø¨Ø®Ø¯Ù…ØªÙƒ ÙˆØªÙ„Ø¨ÙŠØ© Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ù…Ù†:
ğŸ›‹ï¸ Ø§Ù„Ø£Ø«Ø§Ø« Ø§Ù„ÙØ§Ø®Ø±
ğŸªŸ Ø§Ù„Ø³ØªØ§Ø¦Ø± Ø§Ù„Ø¹ØµØ±ÙŠØ©
ğŸ  Ø§Ù„Ù…ÙØ±ÙˆØ´Ø§Øª Ø§Ù„Ø±Ø§Ù‚ÙŠØ©

Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø£Ùˆ Ø§Ù„Ø·Ù„Ø¨:
ğŸ“ Ø§ØªØµÙ„ Ø¨Ù†Ø§: 01282026384
ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨: {phone}

Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ… ğŸ™""",
            "is_active": True,
        },
    )

    # Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    if created:
        WhatsAppNotificationRule.objects.get_or_create(
            event_type="CUSTOMER_WELCOME",
            defaults={
                "template": template,
                "is_enabled": False,  # Ù…Ø¹Ø·Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
                "delay_minutes": 0,
            },
        )


def reverse_welcome_template(apps, schema_editor):
    """Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ù‚Ø§Ø¹Ø¯Ø©"""
    WhatsAppMessageTemplate = apps.get_model("whatsapp", "WhatsAppMessageTemplate")
    WhatsAppNotificationRule = apps.get_model("whatsapp", "WhatsAppNotificationRule")

    WhatsAppNotificationRule.objects.filter(event_type="CUSTOMER_WELCOME").delete()
    WhatsAppMessageTemplate.objects.filter(name="customer_welcome").delete()


class Migration(migrations.Migration):

    dependencies = [
        ("whatsapp", "0003_whatsappsettings_enable_welcome_messages"),
    ]

    operations = [
        migrations.RunPython(create_welcome_template, reverse_welcome_template),
    ]
