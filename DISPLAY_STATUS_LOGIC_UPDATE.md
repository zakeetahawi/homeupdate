# تحديث منطق عرض حالة الطلب

## نظرة عامة

تم تحديث منطق عرض حالة الطلب في صفحة تفاصيل الطلب وقائمة الطلبات ليعكس المتطلبات الجديدة:

### القواعد الجديدة

1. **إذا كان الطلب يحتوي على تركيب:**
   - إذا كانت حالة المصنع "جاهز للتركيب" (`ready_install`) أو ما بعدها → اعرض حالة التركيب كحالة الطلب
   - قبل الوصول إلى "جاهز للتركيب" → اعرض حالة المصنع كحالة الطلب

2. **إذا كان الطلب لا يحتوي على تركيب:**
   - اعرض حالة الطلب الأساسية

## التغييرات المطبقة

### 1. إضافة دوال جديدة في نموذج الطلب (`orders/models.py`)

#### `get_display_status()`
- ترجع معلومات الحالة المعروضة مع مصدرها
- تحدد ما إذا كانت الحالة من التركيب أو المصنع أو الطلب الأساسي

#### `get_display_status_badge_class()`
- ترجع فئة CSS المناسبة للبادج حسب نوع الحالة

#### `get_display_status_icon()`
- ترجع الأيقونة المناسبة للحالة

#### `get_display_status_text()`
- ترجع النص العربي المناسب للحالة

### 2. تحديث قالب تفاصيل الطلب (`orders/templates/orders/order_detail.html`)

- استبدال عرض الحالة الثابت بالدوال الجديدة
- إضافة إشارة لمصدر الحالة (تركيب/مصنع)
- إضافة معلومات إضافية حسب الحالة

### 3. تحديث قالب قائمة الطلبات (`orders/templates/orders/order_list.html`)

- تحديث عمود "الحالة" لاستخدام الدوال الجديدة
- إضافة إشارة مصغرة لمصدر الحالة

## أمثلة على العرض

### حالة التركيب (عندما تكون حالة المصنع جاهز للتركيب أو ما بعدها)

```
🔧 غير مجدول
   حالة التركيب

⏳ في الانتظار
   حالة التركيب

📅 مجدول
   حالة التركيب

🔧 قيد التنفيذ
   حالة التركيب

✅ مكتمل
   حالة التركيب

⚠️ يحتاج تعديل
   حالة التركيب
```

### حالة المصنع (قبل الوصول إلى جاهز للتركيب)

```
⏰ قيد الموافقة
   حالة المصنع

⏳ قيد الانتظار
   حالة المصنع

⚙️ قيد التصنيع
   حالة المصنع
```

### حالة الطلب الأساسية (عند عدم وجود تركيب أو مصنع)

```
⏰ قيد الموافقة
⏳ قيد الانتظار
⚙️ قيد التصنيع
🔧 جاهز للتركيب
✅ مكتمل
🚚 تم التسليم
❌ مرفوض
🚫 ملغي
🗑️ أمر تصنيع محذوف
```

## الفوائد

1. **وضوح أكبر:** المستخدم يعرف مصدر الحالة المعروضة
2. **منطق منطقي:** التركيب يظهر فقط بعد جاهزية المصنع
3. **مرونة:** يمكن إضافة حالات جديدة بسهولة
4. **اتساق:** نفس المنطق في جميع الصفحات

## الاختبار

تم إنشاء صفحة اختبار `test_display_status.html` لعرض جميع الحالات المحتملة والتأكد من صحة التطبيق.

## الملفات المحدثة

- `orders/models.py` - إضافة الدوال الجديدة
- `orders/templates/orders/order_detail.html` - تحديث عرض الحالة
- `orders/templates/orders/order_list.html` - تحديث عمود الحالة
- `test_display_status.html` - صفحة اختبار
- `DISPLAY_STATUS_LOGIC_UPDATE.md` - هذا الملف

## ملاحظات تقنية

- الدوال الجديدة تستخدم `get_selected_types_list()` للتحقق من وجود تركيب
- يتم التحقق من وجود أمر تصنيع قبل عرض حالته
- جميع النصوص باللغة العربية
- الأيقونات من Font Awesome
- الألوان متوافقة مع نظام التصميم الحالي 