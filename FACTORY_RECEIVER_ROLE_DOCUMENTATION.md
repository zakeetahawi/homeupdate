# ุชูุซูู ุฅุถุงูุฉ ุฏูุฑ "ูุณุคูู ุงุณุชูุงู ูุตูุน" (Factory Receiver Role)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ุฏูุฑ ุฌุฏูุฏ ูููุธุงู: **ูุณุคูู ุงุณุชูุงู ูุตูุน** (Factory Receiver) ุงูุฐู ูุณูุญ ุจุฅุฏุงุฑุฉ ุงุณุชูุงู ุงูุฃููุดุฉ ูู ูุณู ุงูุชูุทูุน ูุชุณููููุง ูุฎุทูุท ุงูุฅูุชุงุฌ.

---

## โ ุงูุชุบููุฑุงุช ุงููููููุฐุฉ

### 1. ุชุญุฏูุซ User Model (`accounts/models.py`)

#### ุฅุถุงูุฉ ุงูุญูู ุงูุฌุฏูุฏ:
```python
is_factory_receiver = models.BooleanField(
    default=False, 
    verbose_name=_("ูุณุคูู ุงุณุชูุงู ูุตูุน")
)
```

#### ุชุญุฏูุซ ROLE_HIERARCHY:
```python
'factory_receiver': {
    'level': 4,
    'display': 'ูุณุคูู ุงุณุชูุงู ูุตูุน',
    'inherits_from': [],
    'permissions': [
        'receive_fabric', 
        'deliver_to_production_line', 
        'view_fabric_receipts'
    ]
},
'factory_manager': {
    'level': 2,
    'display': 'ูุณุคูู ูุตูุน',
    'inherits_from': ['factory_receiver'],  # ูุฑุซ ูู ูุณุคูู ุงูุงุณุชูุงู
    'permissions': [
        'view_all_orders', 
        'manage_manufacturing', 
        'manage_inventory'
    ]
}
```

#### ุชุญุฏูุซ Method `clean()`:
```python
roles = [
    self.is_salesperson,
    self.is_branch_manager,
    self.is_region_manager,
    self.is_general_manager,
    self.is_factory_manager,
    self.is_factory_receiver,  # โ ุชูุช ุงูุฅุถุงูุฉ
    self.is_inspection_manager,
    self.is_installation_manager,
    self.is_warehouse_staff
]
```

#### ุชุญุฏูุซ Method `get_user_role()`:
```python
def get_user_role(self):
    if self.is_general_manager:
        return "general_manager"
    # ... ุจููุฉ ุงูุฃุฏูุงุฑ
    elif self.is_factory_receiver:  # โ ุชูุช ุงูุฅุถุงูุฉ
        return "factory_receiver"
    # ... ุจููุฉ ุงูุฃุฏูุงุฑ
```

---

### 2. ุฅุถุงูุฉ ุงูุตูุงุญูุงุช ุงูููุฎุตุตุฉ (`manufacturing/models.py`)

ุชูุช ุฅุถุงูุฉ ุตูุงุญูุงุช ูุฎุตุตุฉ ูู `ManufacturingOrderItem.Meta`:

```python
class Meta:
    verbose_name = _("ุนูุตุฑ ุฃูุฑ ุชุตููุน")
    verbose_name_plural = _("ุนูุงุตุฑ ุฃูุงูุฑ ุงูุชุตููุน")
    permissions = [
        ('can_receive_fabric', 'ููููู ุงุณุชูุงู ุงูุฃููุดุฉ ูู ุงูุชูุทูุน'),
        ('can_deliver_to_production_line', 'ููููู ุชุณููู ุงูุฃููุดุฉ ูุฎุทูุท ุงูุฅูุชุงุฌ'),
        ('can_view_fabric_receipts', 'ููููู ุนุฑุถ ูุงุฆูุฉ ุงุณุชูุงูุงุช ุงูุฃููุดุฉ'),
    ]
```

---

### 3. ุฅูุดุงุก Data Migration ูููุฌููุนุงุช ุงูุซุงุจุชุฉ

**Migration File**: `accounts/migrations/0036_create_system_groups.py`

#### ุงููุฌููุนุงุช ุงููููุดุฃุฉ:

| ุงููุฌููุนุฉ | ุนุฏุฏ ุงูุตูุงุญูุงุช | ุงููุตู |
|---------|--------------|-------|
| **ูุฏูุฑ ุนุงู** | 719 | ุฌููุน ุงูุตูุงุญูุงุช |
| **ูุฏูุฑ ููุทูุฉ** | 7 | ุฅุฏุงุฑุฉ ุงูููุงุทู ูุงููุฑูุน |
| **ูุฏูุฑ ูุฑุน** | 6 | ุฅุฏุงุฑุฉ ุงููุฑุน ูุงูููุธููู |
| **ุจุงุฆุน** | 31 | ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงูุทูุจุงุช |
| **ูุณุคูู ูุตูุน** | 8 | ุฅุฏุงุฑุฉ ุงูุชุตููุน ุงููุงููุฉ |
| **ูุณุคูู ุงุณุชูุงู ูุตูุน** โญ | 6 | ุงุณุชูุงู ุงูุฃููุดุฉ ูุงูุชุณููู |
| **ูุณุคูู ูุนุงููุงุช** | 4 | ุฅุฏุงุฑุฉ ุงููุนุงููุงุช |
| **ููู ูุนุงููุฉ** | 2 | ุชูููุฐ ุงููุนุงููุงุช |
| **ูุณุคูู ุชุฑููุจุงุช** | 0 | (ููุฏ ุงูุชุทููุฑ) |
| **ููุธู ูุณุชูุฏุน** | 5 | ุฅุฏุงุฑุฉ ุงููุฎุฒูู |

#### ุตูุงุญูุงุช "ูุณุคูู ุงุณุชูุงู ูุตูุน":
```python
'ูุณุคูู ุงุณุชูุงู ูุตูุน': [
    'manufacturing.can_receive_fabric',              # ุงุณุชูุงู ุงูุฃููุดุฉ
    'manufacturing.can_deliver_to_production_line',  # ุงูุชุณููู ูุฎุทูุท ุงูุฅูุชุงุฌ
    'manufacturing.can_view_fabric_receipts',        # ุนุฑุถ ุงูุงุณุชูุงูุงุช
    'manufacturing.view_manufacturingorder',         # ุนุฑุถ ุฃูุงูุฑ ุงูุชุตููุน
    'manufacturing.view_manufacturingorderitem',     # ุนุฑุถ ุนูุงุตุฑ ุงูุฃูุงูุฑ
    'manufacturing.view_productionline',             # ุนุฑุถ ุฎุทูุท ุงูุฅูุชุงุฌ
]
```

---

### 4. ุชุญุฏูุซ ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ (`accounts/admin.py`)

#### ุฅุถุงูุฉ ููู `list_filter`:
```python
list_filter = (
    'is_staff', 'is_superuser', 'is_active', 'branch',
    'is_inspection_technician', 'is_salesperson', 'is_branch_manager',
    'is_region_manager', 'is_general_manager', 'is_factory_manager',
    'is_factory_receiver',  # โ ุชูุช ุงูุฅุถุงูุฉ
    'is_inspection_manager', 'is_installation_manager',
    'is_warehouse_staff', 'user_roles__role'
)
```

#### ุฅุถุงูุฉ ููู `fieldsets`:
```python
(_('ุงูุตูุงุญูุงุช'), {
    'fields': (
        'is_active', 'is_staff', 'is_superuser',
        'is_inspection_technician', 'is_salesperson', 'is_branch_manager',
        'is_region_manager', 'is_general_manager', 'is_factory_manager',
        'is_factory_receiver',  # โ ุชูุช ุงูุฅุถุงูุฉ
        'is_inspection_manager', 'is_installation_manager',
        'managed_branches', 'groups', 'user_permissions'
    ),
    ...
}),
```

---

### 5. ุชุญุฏูุซ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ (`templates/base.html`)

ุชูุช ุฅุถุงูุฉ ุฑุงุจุท ูุจุงุดุฑ ูุตูุญุฉ "ุงุณุชูุงู ูู ุงููุตูุน" ูุธูุฑ **ูุจุงุดุฑุฉ** ูู ุงูููุฏุฑ ุนูุฏ ุชุณุฌูู ุฏุฎูู ูุณุชุฎุฏู ุจุฏูุฑ "ูุณุคูู ุงุณุชูุงู ูุตูุน":

```html
{% elif user.is_factory_receiver %}
    <!-- ูุณุคูู ุงุณุชูุงู ุงููุตูุน ูุฑู ุฑุงุจุท ุงุณุชูุงู ุงูุฃููุดุฉ ูุจุงุดุฑุฉ -->
    <li class="nav-item">
        <a class="nav-link" href="/manufacturing/fabric-receipt/">
            <i class="fas fa-industry"></i>
            <span class="nav-text">ุงุณุชูุงู ูู ุงููุตูุน</span>
        </a>
    </li>
{% elif user.is_staff %}
    <!-- ุจููุฉ ุงูููุธููู ูุฑูู ุงููุงุฆูุฉ ุงููุงููุฉ -->
    ...
```

**ุงููููุฒุงุช:**
- โ ูุธูุฑ ุงูุฑุงุจุท ูุจุงุดุฑุฉ ูู ุงูู navbar (ููุณ ุฏุงุฎู ูุงุฆูุฉ ููุณุฏูุฉ)
- โ ูุธูุฑ ููุท ููุณุคูู ุงุณุชูุงู ุงููุตูุน
- โ ูุง ูุธูุฑ ูููุณุชุฎุฏููู ุงูุขุฎุฑูู (ุญุชู ูุณุคูู ุงููุตูุน ูุฑุงู ุถูู dropdown)
- โ ูุฑุชุจ ุญุณุจ ุงูุฃููููุฉ ูุจู `is_staff`

---

## ๐๏ธ Migrations ุงูููุทุจููุฉ

### 1. Migration 0035: ุฅุถุงูุฉ ุญูู `is_factory_receiver`
```bash
accounts/migrations/0035_user_is_factory_receiver.py
```
- โ ุชู ุงูุชุทุจูู ุจูุฌุงุญ (Faked - ูุฃู ุงูุญูู ูุงู ููุฌูุฏ ูุณุจูุงู)

### 2. Migration 0036: ุฅูุดุงุก ุงููุฌููุนุงุช ุงูุซุงุจุชุฉ
```bash
accounts/migrations/0036_create_system_groups.py
```
- โ ุชู ุงูุชุทุจูู ุจูุฌุงุญ
- โ ุชู ุฅูุดุงุก 8 ูุฌููุนุงุช ุฌุฏูุฏุฉ
- โ ุชู ุชุญุฏูุซ 2 ูุฌููุนุฉ ููุฌูุฏุฉ (ุจุงุฆุนุ ูุณุคูู ุงุณุชูุงู ูุตูุน)

### 3. Migration 0028: ุฅุถุงูุฉ ุงูุตูุงุญูุงุช ุงููุฎุตุตุฉ
```bash
manufacturing/migrations/0028_alter_manufacturingorderitem_options.py
```
- โ ุชู ุงูุชุทุจูู ุจูุฌุงุญ

---

## ๐งช ุงูุชุญูู ูู ุงูุชุทุจูู

### 1. ุงูุชุญูู ูู ุงููุฌููุนุงุช:
```bash
python manage.py shell -c "
from django.contrib.auth.models import Group
for group in Group.objects.all().order_by('name'):
    print(f'{group.name}: {group.permissions.count()} ุตูุงุญูุฉ')
"
```

**ุงููุชูุฌุฉ:**
```
โ ูุณุคูู ุงุณุชูุงู ูุตูุน: 6 ุตูุงุญูุฉ
```

### 2. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:
```bash
python manage.py shell -c "
from django.contrib.auth.models import Group
group = Group.objects.get(name='ูุณุคูู ุงุณุชูุงู ูุตูุน')
for perm in group.permissions.all():
    print(f'{perm.content_type.app_label}.{perm.codename}: {perm.name}')
"
```

**ุงููุชูุฌุฉ:**
```
โ manufacturing.view_manufacturingorder: Can view ุฃูุฑ ุชุตููุน
โ manufacturing.can_deliver_to_production_line: ููููู ุชุณููู ุงูุฃููุดุฉ ูุฎุทูุท ุงูุฅูุชุงุฌ
โ manufacturing.can_receive_fabric: ููููู ุงุณุชูุงู ุงูุฃููุดุฉ ูู ุงูุชูุทูุน
โ manufacturing.can_view_fabric_receipts: ููููู ุนุฑุถ ูุงุฆูุฉ ุงุณุชูุงูุงุช ุงูุฃููุดุฉ
โ manufacturing.view_manufacturingorderitem: Can view ุนูุตุฑ ุฃูุฑ ุชุตููุน
โ manufacturing.view_productionline: Can view ุฎุท ุฅูุชุงุฌ
```

### 3. ุงูุชุญูู ูู ุญูู User:
```bash
python manage.py shell -c "
from accounts.models import User
print('โ ุญูู is_factory_receiver ููุฌูุฏ:', hasattr(User, 'is_factory_receiver'))
"
```

**ุงููุชูุฌุฉ:**
```
โ ุญูู is_factory_receiver ููุฌูุฏ: True
```

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ ุจุฏูุฑ "ูุณุคูู ุงุณุชูุงู ูุตูุน":

1. ุงุฐูุจ ุฅูู ููุญุฉ ุงูุฅุฏุงุฑุฉ: `/admin/accounts/user/add/`
2. ุฃุฏุฎู ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุฃุณุงุณูุฉ
3. ูู ูุณู **ุงูุตูุงุญูุงุช**ุ ูุนูู ุฎูุงุฑ:
   - โ๏ธ **ูุณุคูู ุงุณุชูุงู ูุตูุน** (is_factory_receiver)
4. ุงุญูุธ ุงููุณุชุฎุฏู
5. ุณูุชู ุชููุงุฆูุงู ุฅุถุงูุฉ ุงููุณุชุฎุฏู ููุฌููุนุฉ "ูุณุคูู ุงุณุชูุงู ูุตูุน"

### 2. ุชุนุฏูู ูุณุชุฎุฏู ููุฌูุฏ:

1. ุงุฐูุจ ุฅูู: `/admin/accounts/user/<user_id>/change/`
2. ูุนูู: **ูุณุคูู ุงุณุชูุงู ูุตูุน**
3. ุงุญูุธ ุงูุชุบููุฑุงุช

### 3. ุงููุชูุฌุฉ ุงููุชููุนุฉ:

ุนูุฏ ุชุณุฌูู ุฏุฎูู ุงููุณุชุฎุฏู:
- โ ุณูุฑู ุฑุงุจุท **"ุงุณุชูุงู ูู ุงููุตูุน"** ูู ุงูู navbar ูุจุงุดุฑุฉ
- โ ุณูุชููู ูู ุงููุตูู ุฅูู: `/manufacturing/fabric-receipt/`
- โ ุณูุญุตู ุนูู ุงูุตูุงุญูุงุช ุงูุชุงููุฉ:
  - ุงุณุชูุงู ุงูุฃููุดุฉ ูู ูุณู ุงูุชูุทูุน
  - ุชุณููู ุงูุฃููุดุฉ ูุฎุทูุท ุงูุฅูุชุงุฌ
  - ุนุฑุถ ูุงุฆูุฉ ุงูุงุณุชูุงูุงุช
  - ุนุฑุถ ุฃูุงูุฑ ุงูุชุตููุน (ูููุฑุงุกุฉ ููุท)

---

## ๐ ุงูุชุณูุณู ุงููุฑูู ููุฃุฏูุงุฑ

```
ูุฏูุฑ ุนุงู (Level 1)
  โโ ูุฏูุฑ ููุทูุฉ (Level 2)
      โโ ูุฏูุฑ ูุฑุน (Level 3)
          โโ ุจุงุฆุน (Level 4)

ูุฏูุฑ ุนุงู (Level 1)
  โโ ูุณุคูู ูุตูุน (Level 2)
      โโ ูุณุคูู ุงุณุชูุงู ูุตูุน (Level 4) โญ

ูุฏูุฑ ุนุงู (Level 1)
  โโ ูุณุคูู ูุนุงููุงุช (Level 3)
      โโ ููู ูุนุงููุฉ (Level 5)
```

**ููุงุญุธุฉ ูููุฉ:**
- ูุณุคูู ุงููุตูุน ูุฑุซ ุตูุงุญูุงุช ูุณุคูู ุงูุงุณุชูุงู
- ูุณุคูู ุงูุงุณุชูุงู **ูุง ูุฑุซ** ูู ุฃู ุฏูุฑ ุขุฎุฑ (ุฏูุฑ ูุณุชูู)

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ุงููุฌููุนุงุช ุงููููุดุฃุฉ:
- โ **10 ูุฌููุนุงุช** ุฅุฌูุงูู
- โ **8 ูุฌููุนุงุช ุฌุฏูุฏุฉ** (ุชู ุฅูุดุงุคูุง)
- โ **2 ูุฌููุนุงุช ูุญุฏูุซุฉ** (ุจุงุฆุนุ ูุณุคูู ุงุณุชูุงู ูุตูุน)

### ุงูุตูุงุญูุงุช:
- โ **6 ุตูุงุญูุงุช** ููุณุคูู ุงุณุชูุงู ุงููุตูุน
- โ **3 ุตูุงุญูุงุช ูุฎุตุตุฉ** ุฌุฏูุฏุฉ ูู manufacturing
- โ **719 ุตูุงุญูุฉ** ูููุฏูุฑ ุงูุนุงู (ุฌููุน ุงูุตูุงุญูุงุช)

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

### ุชุญุณููุงุช ููุชุฑุญุฉ:

1. **ุฅุถุงูุฉ Dashboard ุฎุงุต:**
   - ุฅูุดุงุก ุตูุญุฉ dashboard ููุณุคูู ุงูุงุณุชูุงู ุชุนุฑุถ:
     - ุงูุฃููุดุฉ ุงูููุชุธุฑุฉ ููุงุณุชูุงู
     - ุงูุฃููุดุฉ ุงููุณุชููุฉ ุงูููู
     - ุงูุฃููุดุฉ ุงูููุณูููุฉ ูุฎุทูุท ุงูุฅูุชุงุฌ

2. **ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ:**
   - ุฅุฑุณุงู ุฅุดุนุงุฑ ููุณุคูู ุงูุงุณุชูุงู ุนูุฏ ุฌุงูุฒูุฉ ุฃููุดุฉ ููุงุณุชูุงู
   - ุฅุฑุณุงู ุฅุดุนุงุฑ ููุณุคูู ุงููุตูุน ุนูุฏ ุฅุชูุงู ุนูููุฉ ุงูุงุณุชูุงู

3. **ุชูุงุฑูุฑ:**
   - ุชูุฑูุฑ ูููู ุจุงูุฃููุดุฉ ุงููุณุชููุฉ
   - ุชูุฑูุฑ ุดูุฑู ุจุงูุฃุฏุงุก
   - ููุงุฑูุฉ ุจูู ูุณุคููู ุงูุงุณุชูุงู (ูู ุญุงูุฉ ูุฌูุฏ ุฃูุซุฑ ูู ูุงุญุฏ)

4. **Audit Log:**
   - ุชุณุฌูู ุฌููุน ุนูููุงุช ุงูุงุณุชูุงู ูุงูุชุณููู
   - ุชุชุจุน ูู ูุงู ุจูุงุฐุง ููุชู

---

## โ๏ธ ุชูุจููุงุช ูููุฉ

1. **ุงููุฌููุนุฉ "ูุณุคูู ุชุฑููุจุงุช":**
   ```
   โ๏ธ ุงูุตูุงุญูุฉ ุบูุฑ ููุฌูุฏุฉ: installations.view_installation
   ```
   - ุชุทุจูู `installations` ูุฏ ูุง ูุญุชูู ุนูู Model `Installation`
   - ูููุตุญ ุจูุฑุงุฌุนุฉ ุงูุชุทุจูู ูุฅุถุงูุฉ ุงูู Model ุงูููุงุณุจ

2. **ุงุณุชุนุงุฏุฉ ุงูู Backup:**
   - ุฅุฐุง ุชู ุนูู rollbackุ ุงุณุชุฎุฏู:
   ```bash
   python manage.py migrate accounts 0034
   python manage.py migrate manufacturing 0027
   ```

3. **ุงูุตูุงุญูุงุช ุงูุชููุงุฆูุฉ:**
   - ุนูุฏ ุชูุนูู `is_factory_receiver`ุ ูุฌุจ ุงูุชุฃูุฏ ูู ุฑุจุท ุงููุณุชุฎุฏู ุจูุฌููุนุฉ "ูุณุคูู ุงุณุชูุงู ูุตูุน" ูุฏููุงู ูู Admin

---

## ๐ ุงูุฏุนู ุงูููู

ูู ุญุงู ูุฌูุฏ ุฃู ูุดุงูู:
1. ุชุญูู ูู ุงูู logs: `/logs/`
2. ุฑุงุฌุน ุงูู migrations: `python manage.py showmigrations`
3. ุชุฃูุฏ ูู ูุฌูุฏ ุงูุตูุงุญูุงุช: `python manage.py shell` ุซู ูุญุต `Group.objects.all()`

---

## โ ููุฎุต ุงูุชุฃููุฏ

### ุงูุชุฃููุฏุงุช ุงููุทููุจุฉ:

#### 1. โ ุฏูุฑ "ูุณุคูู ุงุณุชูุงู ูุตูุน" ููุฌูุฏ:
- โ ุญูู `is_factory_receiver` ูู User model
- โ ููุฌูุฏ ูู `ROLE_HIERARCHY`
- โ ููุฌูุฏ ูู `clean()` validation
- โ ููุฌูุฏ ูู `get_user_role()` method

#### 2. โ ุงููุฌููุนุงุช ุซุงุจุชุฉ:
- โ Data migration `0036_create_system_groups.py`
- โ ูุชู ุฅูุดุงุก ุงููุฌููุนุงุช ุชููุงุฆูุงู ุนูุฏ `python manage.py migrate`
- โ ุงูุตูุงุญูุงุช ูุญุฏุฏุฉ ูููุฑุจุทุฉ ุชููุงุฆูุงู

#### 3. โ ุงูุตูุงุญูุงุช ููุฌูุฏุฉ:
- โ ูุฌููุนุฉ "ูุณุคูู ุงุณุชูุงู ูุตูุน" ุชุญุชูู ุนูู **6 ุตูุงุญูุงุช**
- โ ุงูุตูุงุญูุงุช ุงููุฎุตุตุฉ ููุฌูุฏุฉ ูู `ManufacturingOrderItem`

#### 4. โ ุฑุงุจุท "ุงุณุชูุงู ูู ุงููุตูุน" ูุธูุฑ ูู ุงูููุฏุฑ:
- โ ุชู ุงูุชุนุฏูู ุนูู `templates/base.html`
- โ ุงูุฑุงุจุท ูุธูุฑ **ูุจุงุดุฑุฉ** ูู navbar (ููุณ dropdown)
- โ ูุธูุฑ **ููุท** ุนูุฏูุง `user.is_factory_receiver == True`
- โ ูุง ูุธูุฑ ูููุณุชุฎุฏููู ุงูุขุฎุฑูู

---

## ๐ ุชู ุงูุฅูุฌุงุฒ ุจูุฌุงุญ!

ุฌููุน ุงููุชุทูุจุงุช ุชู ุชูููุฐูุง ูุชุทุจูููุง ุจูุฌุงุญ โ

**ุขุฎุฑ ุชุญุฏูุซ:** ุชู ุชุทุจูู ุฌููุน ุงูู migrations ุจูุฌุงุญ ูู ุงูุชุงุฑูุฎ ุงูุญุงูู.
