# داش بورد الإدارة - نظام الخواجه

## نظرة عامة

تم إنشاء داش بورد احترافي للمدراء يعرض تحليلات شاملة لجميع أقسام النظام. هذا الداش بورد متاح فقط للمستخدمين الذين لديهم صلاحيات إدارية (`is_staff` أو `is_superuser`).

## الميزات الرئيسية

### 1. إحصائيات شاملة
- **العملاء**: إجمالي العملاء، العملاء النشطون، العملاء الجدد
- **الطلبات**: إجمالي الطلبات، الطلبات المعلقة، الطلبات المكتملة، إجمالي المبيعات
- **التصنيع**: أوامر التصنيع، الحالات المختلفة، التقدم
- **المعاينات**: المعاينات المجدولة، المكتملة، الناجحة
- **التركيبات**: طلبات التركيب، الحالات المختلفة
- **المخزون**: المنتجات، المخزون المنخفض، القيمة الإجمالية

### 2. فلاتر متقدمة
- **فلتر الفرع**: عرض البيانات لفرع محدد أو جميع الفروع
- **فلتر الشهر**: اختيار شهر محدد للتحليل
- **فلتر السنة**: اختيار سنة محددة
- **مقارنة زمنية**: مقارنة البيانات مع شهر/سنة أخرى

### 3. رسوم بيانية تفاعلية
- رسم بياني للطلبات الشهرية
- رسم بياني للعملاء الشهريين
- تحديث تلقائي للبيانات

### 4. تصميم حديث
- تصميم متجاوب يعمل على جميع الأجهزة
- ألوان متدرجة جذابة
- تأثيرات تفاعلية
- رسوم متحركة سلسة

## كيفية الوصول

### للمدراء (is_staff أو is_superuser):
1. تسجيل الدخول للنظام
2. سيتم توجيهك تلقائياً إلى داش بورد الإدارة
3. أو يمكن الوصول عبر الرابط: `/admin-dashboard/`

### للمستخدمين العاديين:
- سيتم توجيههم إلى الصفحة الرئيسية العادية

## المسارات والملفات

### المسارات:
- `admin-dashboard/` - الداش بورد الإداري

### الملفات المضافة:
- `templates/admin_dashboard.html` - قالب الداش بورد
- `static/css/admin-dashboard.css` - أنماط الداش بورد
- `static/js/admin-dashboard.js` - وظائف JavaScript
- `crm/views.py` - عرض الداش بورد (تم إضافة `admin_dashboard`)

### الملفات المعدلة:
- `crm/urls.py` - إضافة مسار الداش بورد
- `crm/views.py` - إضافة وظائف الإحصائيات
- `templates/base.html` - إضافة رابط الداش بورد في القائمة

## الوظائف المضافة

### في `crm/views.py`:

#### `admin_dashboard(request)`
- العرض الرئيسي للداش بورد
- معالجة الفلاتر والبيانات
- إرجاع السياق مع جميع الإحصائيات

#### `get_customers_statistics(branch_filter, start_date, end_date)`
- إحصائيات العملاء حسب الفرع والفترة الزمنية

#### `get_orders_statistics(branch_filter, start_date, end_date)`
- إحصائيات الطلبات والمبيعات

#### `get_manufacturing_statistics(branch_filter, start_date, end_date)`
- إحصائيات أوامر التصنيع

#### `get_inspections_statistics(branch_filter, start_date, end_date)`
- إحصائيات المعاينات

#### `get_installations_statistics(branch_filter, start_date, end_date)`
- إحصائيات التركيبات

#### `get_inventory_statistics(branch_filter)`
- إحصائيات المخزون

#### `get_chart_data(branch_filter, year)`
- بيانات الرسوم البيانية الشهرية

## الأمان والصلاحيات

### التحقق من الصلاحيات:
```python
def is_admin_user(user):
    """التحقق من أن المستخدم مدير للنظام"""
    return user.is_staff or user.is_superuser
```

### التوجيه التلقائي:
- المدراء يتم توجيههم تلقائياً إلى الداش بورد
- المستخدمون العاديون يبقون في الصفحة الرئيسية

## التخصيص والتطوير

### إضافة إحصائيات جديدة:
1. إضافة وظيفة إحصائية جديدة في `views.py`
2. إضافة البيانات للسياق في `admin_dashboard`
3. إضافة العرض في القالب

### إضافة فلتر جديد:
1. إضافة معامل جديد في `admin_dashboard`
2. إضافة خيارات الفلتر في القالب
3. تحديث وظائف الإحصائيات

### إضافة رسم بياني جديد:
1. إضافة بيانات الرسم في `get_chart_data`
2. إضافة canvas في القالب
3. إعداد الرسم في JavaScript

## الأداء والتحسين

### تحسينات الأداء:
- استخدام `select_related` و `prefetch_related` للاستعلامات
- تخزين مؤقت للبيانات المتكررة
- تحديث تلقائي كل 5 دقائق فقط

### تحسينات المستقبل:
- إضافة المزيد من الرسوم البيانية
- إضافة تقارير PDF
- إضافة إشعارات فورية
- إضافة تصدير البيانات

## استكشاف الأخطاء

### مشاكل شائعة:

#### 1. عدم ظهور الداش بورد للمدراء:
- تأكد من أن المستخدم لديه `is_staff=True` أو `is_superuser=True`
- تحقق من إعدادات الصلاحيات في Django Admin

#### 2. عدم تحميل الرسوم البيانية:
- تأكد من تحميل Chart.js
- تحقق من وجود البيانات في السياق
- راجع وحدة تحكم المتصفح للأخطاء

#### 3. عدم عمل الفلاتر:
- تحقق من صحة معاملات URL
- تأكد من وجود البيانات في قاعدة البيانات
- راجع وظائف الإحصائيات

### سجلات التصحيح:
- تحقق من سجلات Django للاستعلامات البطيئة
- راجع أداء قاعدة البيانات
- تحقق من استخدام الذاكرة

## الدعم والصيانة

### الصيانة الدورية:
- مراجعة أداء الاستعلامات شهرياً
- تحديث الرسوم البيانية حسب الحاجة
- إضافة فلاتر جديدة حسب متطلبات الإدارة

### التحديثات المستقبلية:
- إضافة المزيد من التحليلات المتقدمة
- دعم المزيد من أنواع الرسوم البيانية
- إضافة تقارير مخصصة

---

**تم تطوير هذا الداش بورد بواسطة فريق تطوير نظام الخواجه**
**تاريخ التطوير: {{ current_date }}** 