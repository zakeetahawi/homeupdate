# ๐ง ุฏููู ุฅุฏุงุฑุฉ ุชุณูุณู ID ุงูุดุงูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุฏููู ููุถุญ ููููุฉ ุงุณุชุฎุฏุงู ูุธุงู ุฅุฏุงุฑุฉ ุชุณูุณู ID ุงูุดุงูู ุงูุฐู ุชู ุชุทููุฑู ูุญู ูุดุงูู ุชุถุงุฑุจ ID ุฎุงุตุฉ ุจุนุฏ ุงุณุชุนุงุฏุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ูู ููุงุนุฏ ุจูุงูุงุช PostgreSQL.

## ๐จ ุงููุดููุฉ

ุจุนุฏ ุงุณุชุนุงุฏุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉุ ูุฏ ุชุญุฏุซ ูุดุงูู ูู ุชุณูุณู ID ุญูุซ:
- ูููุฉ ุงูุชุณูุณู (sequence) ุชุตุจุญ ุฃูู ูู ุฃุนูู ID ููุฌูุฏ ูู ุงูุฌุฏูู
- ูุคุฏู ูุฐุง ุฅูู ุชุถุงุฑุจ ูู ID ุนูุฏ ุฅูุดุงุก ุณุฌูุงุช ุฌุฏูุฏุฉ
- ุชุธูุฑ ุฃุฎุทุงุก "duplicate key value violates unique constraint"

## ๐๏ธ ุงูุญููู ุงููุทูุฑุฉ

ุชู ุชุทููุฑ ูุฌููุนุฉ ุดุงููุฉ ูู ุงูุฃุฏูุงุช ูุญู ูุฐู ุงููุดููุฉ:

### 1. ุฃุฏุงุฉ ุงูุฅุตูุงุญ ุงูุดุงููุฉ
```bash
python manage.py fix_all_sequences
```

**ุงูุฎูุงุฑุงุช:**
- `--app <app_name>`: ุฅุตูุงุญ ุชุทุจูู ูุญุฏุฏ ููุท
- `--table <table_name>`: ุฅุตูุงุญ ุฌุฏูู ูุญุฏุฏ ููุท
- `--dry-run`: ูุนุงููุฉ ุงูุชุบููุฑุงุช ุฏูู ุชุทุจูููุง
- `--verbose`: ุนุฑุถ ุชูุงุตูู ุฃูุซุฑ

**ุฃูุซูุฉ:**
```bash
# ุฅุตูุงุญ ุฌููุน ุงูุชุณูุณูุงุช
python manage.py fix_all_sequences

# ุฅุตูุงุญ ุชุทุจูู ุงูุนููุงุก ููุท
python manage.py fix_all_sequences --app customers

# ูุนุงููุฉ ุงูุชุบููุฑุงุช
python manage.py fix_all_sequences --dry-run --verbose
```

### 2. ุฃุฏุงุฉ ูุญุต ุงูุชุณูุณู
```bash
python manage.py check_sequences
```

**ุงูุฎูุงุฑุงุช:**
- `--app <app_name>`: ูุญุต ุชุทุจูู ูุญุฏุฏ
- `--table <table_name>`: ูุญุต ุฌุฏูู ูุญุฏุฏ
- `--show-all`: ุนุฑุถ ุฌููุน ุงูุฌุฏุงูู ุญุชู ุงูุณูููุฉ
- `--export <filename>`: ุชุตุฏูุฑ ุงููุชุงุฆุฌ ุฅูู ููู JSON

**ุฃูุซูุฉ:**
```bash
# ูุญุต ุฌููุน ุงูุชุณูุณูุงุช
python manage.py check_sequences --show-all

# ูุญุต ุชุทุจูู ุงูุทูุจุงุช
python manage.py check_sequences --app orders

# ุชุตุฏูุฑ ุชูุฑูุฑ ุงููุญุต
python manage.py check_sequences --export sequence_report.json
```

### 3. ุฃุฏุงุฉ ุงูุฅุตูุงุญ ุงูุชููุงุฆู
```bash
python manage.py auto_fix_sequences
```

**ุงูุฎูุงุฑุงุช:**
- `--check-only`: ูุญุต ููุท ุฏูู ุฅุตูุงุญ
- `--force`: ุฅุฌุจุงุฑ ุงูุฅุตูุงุญ ุญุชู ูู ูู ุชููุชุดู ูุดุงูู
- `--log-file <filename>`: ููู ุชุณุฌูู ุงูุนูููุงุช

**ุฃูุซูุฉ:**
```bash
# ูุญุต ูุฅุตูุงุญ ุชููุงุฆู
python manage.py auto_fix_sequences

# ูุญุต ููุท
python manage.py auto_fix_sequences --check-only

# ุฅุตูุงุญ ูุน ุชุณุฌูู
python manage.py auto_fix_sequences --log-file /var/log/sequence_fix.log
```

### 4. ุฃุฏุงุฉ ุงููุฑุงูุจุฉ ุงูุฏูุฑูุฉ
```bash
python manage.py monitor_sequences
```

**ุงูุฎูุงุฑุงุช:**
- `--interval <minutes>`: ูุชุฑุฉ ุงููุฑุงูุจุฉ ุจุงูุฏูุงุฆู (ุงูุชุฑุงุถู: 60)
- `--email-alerts`: ุฅุฑุณุงู ุชูุจููุงุช ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- `--auto-fix`: ุฅุตูุงุญ ุชููุงุฆู ุนูุฏ ุงูุชุดุงู ูุดุงูู
- `--daemon`: ุชุดุบูู ูุฎุฏูุฉ ูู ุงูุฎูููุฉ
- `--report-file <filename>`: ููู ุชูุฑูุฑ ุงููุฑุงูุจุฉ

**ุฃูุซูุฉ:**
```bash
# ูุฑุงูุจุฉ ูู 30 ุฏูููุฉ ูุน ุฅุตูุงุญ ุชููุงุฆู
python manage.py monitor_sequences --interval 30 --auto-fix

# ุชุดุบูู ูุฎุฏูุฉ ูุน ุชูุจููุงุช
python manage.py monitor_sequences --daemon --email-alerts --auto-fix
```

### 5. ุฃุฏุงุฉ ุงูุฅุฏุงุฑุฉ ุงูุดุงููุฉ
```bash
python manage.py sequence_manager
```

ูุฐู ุฃุฏุงุฉ ููุญุฏุฉ ุชุฌูุน ุฌููุน ุงููุธุงุฆู:

**ุงูุฅุฌุฑุงุกุงุช:**
- `check`: ูุญุต ุญุงูุฉ ุงูุชุณูุณู
- `fix`: ุฅุตูุงุญ ุงูุชุณูุณู
- `monitor`: ูุฑุงูุจุฉ ุงูุชุณูุณู
- `auto`: ุฅุตูุงุญ ุชููุงุฆู
- `info`: ูุนูููุงุช ุงูุชุณูุณู
- `reset`: ุฅุนุงุฏุฉ ุชุนููู ุงูุชุณูุณู

**ุฃูุซูุฉ:**
```bash
# ูุญุต ุดุงูู
python manage.py sequence_manager check --show-all

# ุฅุตูุงุญ ุดุงูู
python manage.py sequence_manager fix

# ูุนูููุงุช ููุตูุฉ
python manage.py sequence_manager info --detailed

# ุฅุนุงุฏุฉ ุชุนููู ุชุณูุณู ุฌุฏูู ูุญุฏุฏ
python manage.py sequence_manager reset customers_customer --confirm
```

## ๐ ุงูุฅุตูุงุญ ุงูุชููุงุฆู

ุชู ุชุทููุฑ ูุธุงู ุฅุตูุงุญ ุชููุงุฆู ูุนูู ูู ุงูุฎูููุฉ:

### ุงูุฅุดุงุฑุงุช (Signals)
- ูุชู ุชุดุบูู ูุญุต ุชููุงุฆู ุจุนุฏ ูู ุนูููุฉ `migrate`
- ููุชุดู ูุดุงูู ุงูุชุณูุณู ููุตูุญูุง ุชููุงุฆูุงู
- ูุณุฌู ุฌููุน ุงูุนูููุงุช ูู ูููุงุช ุงูุณุฌู

### ุงููุฑุงูุจ ุงูุชููุงุฆู
- ููุญุต ุงูุชุณูุณูุงุช ุจุดูู ุฏูุฑู
- ูุฑุณู ุชูุจููุงุช ุนูุฏ ุงูุชุดุงู ูุดุงูู
- ูููู ุชููููู ููุฅุตูุงุญ ุงูุชููุงุฆู

## ๐ ุฃููุงุน ุงููุดุงูู ุงูููุชุดูุฉ

### 1. ูุดุงูู ุญุฑุฌุฉ (Critical)
- ุงูุชุณูุณู ุฃูู ูู ุฃู ูุณุงูู ุฃุนูู ID ูู ุงูุฌุฏูู
- **ุงูุฎุทุฑ:** ุชุถุงุฑุจ ID ููุฑู
- **ุงูุญู:** ุฅุตูุงุญ ููุฑู ูุทููุจ

### 2. ุชุญุฐูุฑุงุช (Warnings)
- ูุฌูุฉ ูุจูุฑุฉ ูู ุงูุชุณูุณู (> 1000)
- **ุงูุฎุทุฑ:** ูุฏุฑ ูู ุงููุณุงุญุฉ
- **ุงูุญู:** ุฅุนุงุฏุฉ ุชุนููู ุงุฎุชูุงุฑูุฉ

### 3. ุญุงูุฉ ุณูููุฉ (Healthy)
- ุงูุชุณูุณู ูุนูู ุจุดูู ุตุญูุญ
- **ุงูุญู:** ูุง ุญุงุฌุฉ ูุฅุฌุฑุงุก

## ๐ง ุงูุงุณุชุฎุฏุงู ุจุนุฏ ุงุณุชุนุงุฏุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ

### ุงูุฎุทูุงุช ุงูููุตู ุจูุง:

1. **ูุญุต ููุฑู:**
```bash
python manage.py check_sequences --show-all
```

2. **ุฅุตูุงุญ ุดุงูู:**
```bash
python manage.py fix_all_sequences --verbose
```

3. **ุงูุชุญูู ูู ุงููุชุงุฆุฌ:**
```bash
python manage.py check_sequences
```

4. **ุชูุนูู ุงููุฑุงูุจุฉ:**
```bash
python manage.py monitor_sequences --daemon --auto-fix
```

## ๐ ูููุงุช ุงูุณุฌู

### ููุงูุน ูููุงุช ุงูุณุฌู:
- `/media/auto_fix_sequences.log`: ุณุฌู ุงูุฅุตูุงุญ ุงูุชููุงุฆู
- `/media/sequence_monitor.log`: ุณุฌู ุงููุฑุงูุจุฉ
- `/media/sync_from_sheets.log`: ุณุฌู ูุฒุงููุฉ Google Sheets

### ูุฑุงูุจุฉ ุงูุณุฌูุงุช:
```bash
# ูุฑุงูุจุฉ ุณุฌู ุงูุฅุตูุงุญ ุงูุชููุงุฆู
tail -f media/auto_fix_sequences.log

# ูุฑุงูุจุฉ ุณุฌู ุงููุฑุงูุจุฉ
tail -f media/sequence_monitor.log
```

## โ๏ธ ุงูุชูููู ุงููุชูุฏู

### ุฅุนุฏุงุฏุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุชูุจููุงุช:
```python
# ูู settings.py
EMAIL_HOST = 'smtp.gmail.com'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_HOST_USER = 'your-email@gmail.com'
EMAIL_HOST_PASSWORD = 'your-password'
DEFAULT_FROM_EMAIL = 'your-email@gmail.com'
ADMINS = [('Admin', 'admin@example.com')]
```

### ุฌุฏููุฉ ุงููุฑุงูุจุฉ ุงูุฏูุฑูุฉ:
```bash
# ุฅุถุงูุฉ ุฅูู crontab ูููุฑุงูุจุฉ ูู ุณุงุนุฉ
0 * * * * cd /path/to/project && python manage.py auto_fix_sequences

# ูุฑุงูุจุฉ ููููุฉ ุดุงููุฉ
0 3 * * * cd /path/to/project && python manage.py check_sequences --export daily_report.json
```

## ๐ ุฃูุถู ุงูููุงุฑุณุงุช

### 1. ุงููุญุต ุงูุฏูุฑู
- ูู ุจูุญุต ุงูุชุณูุณูุงุช ุฃุณุจูุนูุงู ุนูู ุงูุฃูู
- ุงุณุชุฎุฏู ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ

### 2. ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
- ูู ุจูุญุต ุงูุชุณูุณู ููุฑุงู ุจุนุฏ ุงุณุชุนุงุฏุฉ ุฃู ูุณุฎุฉ ุงุญุชูุงุทูุฉ
- ุงุญุชูุธ ุจุณุฌู ูุนูููุงุช ุงูุฅุตูุงุญ

### 3. ุงููุฑุงูุจุฉ
- ูุนูู ุงูุชูุจููุงุช ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุฑุงุฌุน ูููุงุช ุงูุณุฌู ุจุงูุชุธุงู

### 4. ุงูุงุฎุชุจุงุฑ
- ุงุฎุชุจุฑ ุงูุฃุฏูุงุช ูู ุจูุฆุฉ ุงูุชุทููุฑ ุฃููุงู
- ุงุณุชุฎุฏู `--dry-run` ููุนุงููุฉ ุงูุชุบููุฑุงุช

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ:

1. **ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```bash
# ุชุญูู ูู ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
python manage.py dbshell
```

2. **ุตูุงุญูุงุช ุบูุฑ ูุงููุฉ:**
```bash
# ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู ูู PostgreSQL
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO your_user;
```

3. **ุฌุฏุงูู ููููุฏุฉ:**
```bash
# ุชุญูู ูู ูุฌูุฏ ุงูุฌุฏุงูู
python manage.py sequence_manager info
```

## ๐ ุงูุฏุนู

ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู:
1. ุฑุงุฌุน ูููุงุช ุงูุณุฌู
2. ุงุณุชุฎุฏู `--verbose` ููุญุตูู ุนูู ุชูุงุตูู ุฃูุซุฑ
3. ุฌุฑุจ `--dry-run` ููุนุงููุฉ ุงูุชุบููุฑุงุช
4. ุชุญูู ูู ุตูุงุญูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

ุงูููุฒุงุช ุงููุฎุทุทุฉ:
- ูุงุฌูุฉ ููุจ ูุฅุฏุงุฑุฉ ุงูุชุณูุณู
- ุชูุงุฑูุฑ ูุฑุฆูุฉ ูููุฑุงูุจุฉ
- ุฏุนู ููุงุนุฏ ุจูุงูุงุช ุฃุฎุฑู
- ุชุญุณููุงุช ูู ุงูุฃุฏุงุก
