# دليل إدارة صلاحيات الموافقة على التصنيع

## نظرة عامة
تم تحديث لوحة تحكم المدير لتشمل إدارة شاملة لصلاحيات الموافقة على طلبات التصنيع.

## الميزات الجديدة

### 1. إدارة المستخدمين المحسنة
- **عمود جديد**: "صلاحية الموافقة على التصنيع" يظهر حالة الصلاحية لكل مستخدم
- **إجراءات مجمعة**: يمكن إعطاء أو إزالة صلاحيات الموافقة لعدة مستخدمين معاً

### 2. إجراءات الصلاحيات المتاحة

#### إعطاء صلاحيات الموافقة:
1. اذهب إلى **المستخدمون** في لوحة التحكم
2. حدد المستخدمين المطلوبين
3. اختر **"إعطاء صلاحيات الموافقة على التصنيع"** من قائمة الإجراءات
4. اضغط **تنفيذ**

#### إزالة صلاحيات الموافقة:
1. اذهب إلى **المستخدمون** في لوحة التحكم
2. حدد المستخدمين المطلوبين
3. اختر **"إزالة صلاحيات الموافقة على التصنيع"** من قائمة الإجراءات
4. اضغط **تنفيذ**

### 3. إدارة أوامر التصنيع المحسنة

#### ميزات العرض الجديدة:
- **معلومات التسليم**: عرض رقم الإذن واسم المستلم للطلبات المسلمة
- **ألوان الحالة**: تمييز بصري واضح لكل حالة
- **روابط سريعة**: ربط مباشر بالطلب الأصلي

#### الحقول المتاحة:
- معلومات الطلب الأساسية
- معلومات التسليم (قابلة للطي)
- الملفات المرفقة
- التواريخ والأوقات

### 4. التحكم في الصلاحيات

#### قيود الوصول:
- **الطلبات في حالة "قيد الموافقة"**: يمكن تعديلها فقط من قبل:
  - المستخدمين الذين لديهم صلاحية الموافقة
  - مدير النظام

#### نظام الصلاحيات:
- **can_approve_orders**: صلاحية الموافقة على الطلبات
- **can_reject_orders**: صلاحية رفض الطلبات
- يتم إعطاء الصلاحيتين معاً تلقائياً

## كيفية الاستخدام

### للمدير:
1. **مراجعة الصلاحيات الحالية**:
   - اذهب إلى قائمة المستخدمين
   - راجع عمود "صلاحية الموافقة على التصنيع"

2. **إعطاء صلاحيات جديدة**:
   - حدد المستخدمين المطلوبين
   - استخدم الإجراء المجمع "إعطاء صلاحيات الموافقة"

3. **إزالة صلاحيات**:
   - حدد المستخدمين المطلوبين
   - استخدم الإجراء المجمع "إزالة صلاحيات الموافقة"

### للمستخدمين المخولين:
1. **الوصول لأوامر التصنيع**:
   - اذهب إلى قسم "أوامر التصنيع"
   - يمكن تعديل الطلبات في حالة "قيد الموافقة"

2. **الموافقة/الرفض**:
   - افتح الطلب المطلوب
   - غير الحالة حسب الحاجة
   - أضف ملاحظات الرفض إذا لزم الأمر

## الصلاحيات المطلوبة

### للمدير:
- **is_superuser**: للوصول الكامل
- **is_staff**: للوصول للوحة التحكم

### للمستخدمين المخولين:
- **is_staff**: للوصول للوحة التحكم
- **can_approve_orders**: لتعديل الطلبات في حالة "قيد الموافقة"
- **can_reject_orders**: لرفض الطلبات

## ملاحظات مهمة

1. **الأمان**: فقط المدير يمكنه إعطاء/إزالة صلاحيات الموافقة
2. **التسلسل**: يجب الموافقة على الطلب قبل تغيير حالته
3. **التتبع**: جميع التغييرات مسجلة مع الوقت والمستخدم
4. **النسخ الاحتياطي**: يُنصح بأخذ نسخة احتياطية قبل تغيير الصلاحيات

## استكشاف الأخطاء

### المشاكل الشائعة:
1. **لا يمكن رؤية الإجراءات**: تأكد من أنك مدير النظام
2. **لا يمكن تعديل الطلبات**: تأكد من وجود صلاحية الموافقة
3. **الصلاحيات لا تظهر**: تحديث الصفحة أو إعادة تسجيل الدخول

### الحلول:
1. **إعادة تشغيل الخادم** بعد تغيير الصلاحيات
2. **مسح الكاش** في المتصفح
3. **التحقق من قاعدة البيانات** للتأكد من حفظ الصلاحيات

---

**تم التحديث**: تم إضافة نظام شامل لإدارة صلاحيات الموافقة من لوحة التحكم مع واجهة سهلة الاستخدام وإجراءات مجمعة فعالة. 