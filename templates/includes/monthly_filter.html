{% load static %}

<!-- Monthly Filter Component -->
<div class="monthly-filter-component">
    <div class="filter-header">
        <h6 class="filter-title">
            <i class="fas fa-calendar-alt me-2"></i>
            فلترة شهرية
        </h6>
        <button class="btn btn-sm btn-outline-secondary reset-filters" type="button" onclick="resetMonthlyFilters()">
            <i class="fas fa-undo me-1"></i>
            إعادة تعيين
        </button>
    </div>
    
    <div class="filter-controls">
        <!-- Year Selection -->
        <div class="filter-group">
            <label for="year-select" class="form-label">السنة</label>
            <select name="year" id="year-select" class="form-select form-select-sm" onchange="submitForm()">
                <option value="">جميع السنوات</option>
                {% for year in available_years %}
                    <option value="{{ year }}" {% if selected_year == year|stringformat:'s' %}selected{% endif %}>
                        {{ year }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Month Selection -->
        <div class="filter-group">
            <label for="month-select" class="form-label">الشهر</label>
            <select name="month" id="month-select" class="form-select form-select-sm" onchange="submitForm()">
                <option value="">جميع الشهور</option>
                <option value="1" {% if selected_month == '1' %}selected{% endif %}>يناير</option>
                <option value="2" {% if selected_month == '2' %}selected{% endif %}>فبراير</option>
                <option value="3" {% if selected_month == '3' %}selected{% endif %}>مارس</option>
                <option value="4" {% if selected_month == '4' %}selected{% endif %}>أبريل</option>
                <option value="5" {% if selected_month == '5' %}selected{% endif %}>مايو</option>
                <option value="6" {% if selected_month == '6' %}selected{% endif %}>يونيو</option>
                <option value="7" {% if selected_month == '7' %}selected{% endif %}>يوليو</option>
                <option value="8" {% if selected_month == '8' %}selected{% endif %}>أغسطس</option>
                <option value="9" {% if selected_month == '9' %}selected{% endif %}>سبتمبر</option>
                <option value="10" {% if selected_month == '10' %}selected{% endif %}>أكتوبر</option>
                <option value="11" {% if selected_month == '11' %}selected{% endif %}>نوفمبر</option>
                <option value="12" {% if selected_month == '12' %}selected{% endif %}>ديسمبر</option>
            </select>
        </div>
        
        <!-- Quick Month Buttons -->
        <div class="filter-group">
            <label class="form-label">اختيار سريع</label>
            <div class="quick-month-buttons">
                <button type="button" class="btn btn-sm btn-outline-primary quick-month" data-month="current">
                    الشهر الحالي
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary quick-month" data-month="last">
                    الشهر الماضي
                </button>
                <button type="button" class="btn btn-sm btn-outline-info quick-month" data-month="quarter">
                    آخر 3 أشهر
                </button>
            </div>
        </div>
    </div>
    
    <!-- Filter Summary -->
    <div class="filter-summary" id="filter-summary" style="display: none;">
        <div class="summary-content">
            <i class="fas fa-filter me-2"></i>
            <span id="summary-text"></span>
            <button type="button" class="btn btn-sm btn-link clear-filter" onclick="clearMonthlyFilter()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
</div>

<style>
.monthly-filter-component {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
    border: 1px solid rgba(102, 126, 234, 0.1);
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
}

.filter-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.filter-title {
    margin: 0;
    color: #4a5568;
    font-weight: 600;
}

.filter-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    align-items: end;
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-group .form-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #718096;
    margin-bottom: 0.5rem;
}

.quick-month-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.quick-month {
    font-size: 0.8rem;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.quick-month:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.filter-summary {
    margin-top: 1rem;
    padding: 0.75rem;
    background: rgba(102, 126, 234, 0.1);
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

.summary-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 0.875rem;
    color: #4a5568;
}

.clear-filter {
    padding: 0.25rem;
    color: #e53e3e;
    text-decoration: none;
}

.clear-filter:hover {
    color: #c53030;
}

@media (max-width: 768px) {
    .filter-controls {
        grid-template-columns: 1fr;
    }
    
    .quick-month-buttons {
        justify-content: center;
    }
}
</style>

<script>
// Monthly Filter JavaScript
function submitForm() {
    const form = document.querySelector('form');
    if (form) {
        form.submit();
    }
}

function resetMonthlyFilters() {
    document.getElementById('year-select').value = '';
    document.getElementById('month-select').value = '';
    updateFilterSummary();
    submitForm();
}

function clearMonthlyFilter() {
    resetMonthlyFilters();
}

function updateFilterSummary() {
    const yearSelect = document.getElementById('year-select');
    const monthSelect = document.getElementById('month-select');
    const summary = document.getElementById('filter-summary');
    const summaryText = document.getElementById('summary-text');
    
    const year = yearSelect.value;
    const month = monthSelect.value;
    
    if (year || month) {
        let text = 'الفلتر النشط: ';
        if (year && month) {
            const monthName = monthSelect.options[monthSelect.selectedIndex].text;
            text += `${monthName} ${year}`;
        } else if (year) {
            text += `سنة ${year}`;
        } else if (month) {
            const monthName = monthSelect.options[monthSelect.selectedIndex].text;
            text += `شهر ${monthName}`;
        }
        
        summaryText.textContent = text;
        summary.style.display = 'block';
    } else {
        summary.style.display = 'none';
    }
}

// Quick month button handlers
document.addEventListener('DOMContentLoaded', function() {
    const quickMonthButtons = document.querySelectorAll('.quick-month');
    const yearSelect = document.getElementById('year-select');
    const monthSelect = document.getElementById('month-select');
    
    quickMonthButtons.forEach(button => {
        button.addEventListener('click', function() {
            const monthType = this.dataset.month;
            const now = new Date();
            
            switch(monthType) {
                case 'current':
                    yearSelect.value = now.getFullYear();
                    monthSelect.value = now.getMonth() + 1;
                    break;
                case 'last':
                    const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    yearSelect.value = lastMonth.getFullYear();
                    monthSelect.value = lastMonth.getMonth() + 1;
                    break;
                case 'quarter':
                    // For quarter, we'll just set the year and let the backend handle the logic
                    yearSelect.value = now.getFullYear();
                    monthSelect.value = '';
                    break;
            }
            
            updateFilterSummary();
            submitForm();
        });
    });
    
    // Update summary on page load
    updateFilterSummary();
    
    // Update summary when selects change
    yearSelect.addEventListener('change', updateFilterSummary);
    monthSelect.addEventListener('change', updateFilterSummary);
});
</script>
