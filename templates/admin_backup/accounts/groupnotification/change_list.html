{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block content_title %}
    <h1>{{ title }} - Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ({{ notifications_stats.total }})</h1>
    
    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© -->
    {% if notifications_stats %}
    <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745;">
        <h3 style="margin: 0 0 15px 0; color: #495057;">
            <i class="fas fa-users me-2"></i>
            Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© - Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù€ {{ notifications_stats.total }} Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        </h3>
        
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
            <div style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6; min-width: 150px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #28a745; margin-bottom: 5px;">
                    {{ notifications_stats.total }}
                </div>
                <div style="color: #6c757d; font-size: 14px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
            </div>
            
            <!-- Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙŠ -->
            <div style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6; min-width: 150px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #007bff; margin-bottom: 5px;">
                    {{ notifications_stats.user_total }}
                </div>
                <div style="color: #6c757d; font-size: 14px;">Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙŠ</div>
            </div>
            
            <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø© -->
            <div style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6; min-width: 150px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #dc3545; margin-bottom: 5px;">
                    {{ notifications_stats.unread }}
                </div>
                <div style="color: #6c757d; font-size: 14px;">ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø© Ù„ÙŠ</div>
            </div>
            
            <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¬Ù„Ø© -->
            <div style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6; min-width: 150px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #dc3545; margin-bottom: 5px;">
                    {{ notifications_stats.urgent }}
                </div>
                <div style="color: #6c757d; font-size: 14px;">Ø¹Ø§Ø¬Ù„Ø© Ù„ÙŠ</div>
            </div>
            
            <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© -->
            <div style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6; min-width: 150px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #ffc107; margin-bottom: 5px;">
                    {{ notifications_stats.high }}
                </div>
                <div style="color: #6c757d; font-size: 14px;">Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„ÙŠ</div>
            </div>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø³Ø±ÙŠØ¹Ø© -->
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
            <h4 style="margin: 0 0 10px 0; color: #495057; font-size: 16px;">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©:</h4>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="markAllAsRead()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    âœ… ØªØ­Ø¯ÙŠØ¯ Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙŠ ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©
                </button>
                <button onclick="deleteOldNotifications()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (30+ ÙŠÙˆÙ…)
                </button>
                <button onclick="deleteAllNotifications()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; border: 2px solid #fff;">
                    ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                </button>
                <button onclick="selectAllNotifications()" style="background: #6f42c1; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    â˜‘ï¸ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
                </button>
                <button onclick="showAll()" style="background: #fd7e14; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ ({{ notifications_stats.total }})
                </button>
                <button onclick="refreshPage()" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”„ ØªØ­Ø¯ÙŠØ«
                </button>
            </div>
        </div>
        
        <!-- Ù…Ø¤Ø´Ø± Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ -->
        {% if showing_all %}
        <div style="margin-top: 15px; padding: 10px; background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 4px; color: #0c5460;">
            <i class="fas fa-info-circle me-2"></i>
            <strong>ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© ({{ notifications_stats.total }}) ÙÙŠ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©</strong>
            <a href="?" style="margin-right: 10px; color: #0c5460;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ø¯ÙŠ</a>
        </div>
        {% endif %}
    </div>
    {% endif %}
{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .result_list th, .result_list td {
            padding: 12px 8px;
            vertical-align: middle;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .button, input[type=submit], input[type=button], .submit-row input, a.button {
            transition: all 0.2s ease;
        }
        
        .button:hover, input[type=submit]:hover, input[type=button]:hover, .submit-row input:hover, a.button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ± */
        #changelist-filter {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        #changelist-filter h2 {
            color: #495057;
            border-bottom: 2px solid #28a745;
            padding-bottom: 8px;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
        #changelist-search {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
    </style>
{% endblock %}

{% block extrajs %}
    {{ block.super }}
    <script>
        function markAllAsRead() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙƒ ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©ØŸ')) {
                const form = document.getElementById('changelist-form');
                const actionSelect = document.querySelector('select[name="action"]');
                
                const checkboxes = document.querySelectorAll('input[name="_selected_action"]');
                checkboxes.forEach(cb => cb.checked = true);
                
                actionSelect.value = 'mark_all_as_read';
                form.submit();
            }
        }
        
        function deleteOldNotifications() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø£ÙƒØ«Ø± Ù…Ù† 30 ÙŠÙˆÙ…)ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                const form = document.getElementById('changelist-form');
                const actionSelect = document.querySelector('select[name="action"]');
                
                const checkboxes = document.querySelectorAll('input[name="_selected_action"]');
                checkboxes.forEach(cb => cb.checked = true);
                
                actionSelect.value = 'delete_old_notifications';
                form.submit();
            }
        }
        
        function deleteAllNotifications() {
            if (confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©ØŸ\n\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ({{ notifications_stats.total }}) Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!\n\nØ§ÙƒØªØ¨ "Ù†Ø¹Ù…" Ù„Ù„ØªØ£ÙƒÙŠØ¯:')) {
                const confirmation = prompt('Ø§ÙƒØªØ¨ "Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©" Ù„Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:');
                if (confirmation === 'Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©') {
                    const form = document.getElementById('changelist-form');
                    const actionSelect = document.querySelector('select[name="action"]');
                    
                    const checkboxes = document.querySelectorAll('input[name="_selected_action"]');
                    checkboxes.forEach(cb => cb.checked = true);
                    
                    actionSelect.value = 'delete_all_notifications';
                    form.submit();
                } else {
                    alert('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© - Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„ ØºÙŠØ± ØµØ­ÙŠØ­');
                }
            }
        }
        
        function selectAllNotifications() {
            const checkboxes = document.querySelectorAll('input[name="_selected_action"]');
            const selectAllCheckbox = document.querySelector('#action-toggle');
            
            checkboxes.forEach(cb => cb.checked = true);
            if (selectAllCheckbox) selectAllCheckbox.checked = true;
            
            const selectedCount = checkboxes.length;
            alert(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ ${selectedCount} Ø¥Ø´Ø¹Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ`);
        }
        
        function showAll() {
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('all', '1');
            window.location.href = currentUrl.toString();
        }
        
        function refreshPage() {
            window.location.reload();
        }
        
        // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
        setInterval(function() {
            fetch(window.location.href)
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newStats = doc.querySelector('.notifications-stats');
                    const currentStats = document.querySelector('.notifications-stats');
                    if (newStats && currentStats) {
                        currentStats.innerHTML = newStats.innerHTML;
                    }
                })
                .catch(error => console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error));
        }, 60000);
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù„Ù„ØµÙÙˆÙ
        document.addEventListener('DOMContentLoaded', function() {
            const rows = document.querySelectorAll('.result_list tbody tr');
            rows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f8f9fa';
                    this.style.transform = 'scale(1.01)';
                    this.style.transition = 'all 0.2s ease';
                });
                
                row.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                    this.style.transform = 'scale(1)';
                });
            });
        });
    </script>
{% endblock %}
