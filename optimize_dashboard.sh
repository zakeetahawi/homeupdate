#!/bin/bash

# ======================================
# Dashboard Performance Optimization Script
# ======================================

echo "๐ ุจุฏุก ุชุญุณููุงุช ุงูุฃุฏุงุก ููู Dashboard..."

# ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
source venv/bin/activate

# ุชุดุบูู Valkey/Redis ุฅุฐุง ูู ููู ูุนูู
echo "โ ุชุดุบูู Valkey Server..."
valkey-server --daemonize yes --port 6379

# ุชูููุฐ indexes ุงูุฅุถุงููุฉ
echo "๐ ุฅุถุงูุฉ indexes ูุญุณูุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช..."
python manage.py dbshell < dashboard_performance_indexes.sql

# ูุณุญ cache ุงููุฏูู
echo "๐งน ูุณุญ cache ุงููุฏูู..."
python manage.py shell -c "from django.core.cache import cache; cache.clear()"

# ุฅุนุงุฏุฉ ุชุดุบูู Celery
echo "๐ ุฅุนุงุฏุฉ ุชุดุบูู Celery..."
pkill -f celery
sleep 2
celery -A crm worker --loglevel=info --detach
celery -A crm beat --loglevel=info --detach

# ุชุดุบูู ุงูุฎุงุฏู
echo "๐ ุชุดุบูู ุงูุฎุงุฏู ุงููุญุณู..."
python manage.py runserver 0.0.0.0:8000

echo "โ ุชู ุฅูุฌุงุฒ ุฌููุน ุงูุชุญุณููุงุช!"
echo "๐ ุงูุฃุฏุงุก ุงููุญุณู: ุชูููู ุงูุงุณุชุนูุงูุงุช ูู 120 ุฅูู ุฃูู ูู 15"
echo "โก ุงูุณุฑุนุฉ: ูู 5-10 ุซูุงู ุฅูู ุฃูู ูู ุซุงููุฉ ูุงุญุฏุฉ"