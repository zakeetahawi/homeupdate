# ุฎุทุฉ ุฅุตูุงุญ ูุธุงู ุงูุดูุงูู ุงูุดุงููุฉ
## Complaints Module - Complete Fix Plan

**ุชุงุฑูุฎ ุงูุจุฏุก**: 2026-02-14
**ุงูุญุงูุฉ**: โ ุงููุฑุญูุฉ 1 ููุชููุฉ | ๐ ุงููุฑุญูุฉ 2 ููุฏ ุงูุชูููุฐ

---

## ุงููุฑุญูุฉ 1 โ ุฅุตูุงุญุงุช ููุฑูุฉ (Critical Fixes)

### 1.1 โ ูุธุงู ุฅุดุนุงุฑุงุช ููุจุซูุฉ ุนุงู (General Popup Notification System)
- **ุงููุดููุฉ**: ุงูุฅุดุนุงุฑุงุช ุงูููุจุซูุฉ ุงูุฌูููุฉ (popup) ููุฌูุฏุฉ ููุท ููุดูุงููุ ุจุงูู ุงููุธุงู ูุณุชุฎุฏู dropdown ููุท
- **ุงูุญู**: ุฅูุดุงุก ูุธุงู popup ุนุงู ูุนุฑุถ ุฃุญุฏุซ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ ูู ุฌููุน ุงูุฃูุณุงู ุจููุณ ุงูุชุตููู
- **ุงููููุงุช ุงููุชุฃุซุฑุฉ**: 
  - `templates/base.html` - ุฅุถุงูุฉ popup ุนุงู + JavaScript
  - `notifications/views.py` - ุฅูุดุงุก API endpoint ุฌุฏูุฏ ููุฅุดุนุงุฑุงุช ุงูููุจุซูุฉ
  - `notifications/urls.py` - ุฅุถุงูุฉ ูุณุงุฑ API

### 1.2 โ ุฅุตูุงุญ ุฃููููุฉ ุงูุฅุณูุงุฏ ุงูุงูุชุฑุงุถู
- **ุงููุดููุฉ**: ููุดุฆ ุงูุดููู (created_by) ููุนูููู ููุณุคูู ุนู ุงูุญู (ุฎุทุฃ ููุทูู)
- **ุงูุญู**: ุงูุฃููููุฉ ูู `default_assignee` ูู ููุน ุงูุดูููุ ุซู `created_by` ููุฑุฌุน ุฃุฎูุฑ
- **ุงูููู**: `complaints/models.py` - ุฏุงูุฉ `save()`

### 1.3 โ ุญุฐู ุญูู response_time_hours ุงูููุฑุฑ
- **ุงููุดููุฉ**: ุงูุญูู `response_time_hours` ูุนุฑูู ูุฑุชูู ูู `ComplaintSLA`
- **ุงูุญู**: ุญุฐู ุงูุชุนุฑูู ุงูุฃูู (ุจุฏูู validators) ูุงูุฅุจูุงุก ุนูู ุงูุซุงูู (ูุน validators)
- **ุงูููู**: `complaints/models.py` - `ComplaintSLA` model

### 1.4 โ ุฑุจุท ูุญุต ุงูููุงุนูุฏ ุงูููุงุฆูุฉ ุจู Celery Beat
- **ุงููุดููุฉ**: ุฏุงูุฉ `check_complaint_deadlines()` ููุฌูุฏุฉ ููู ูุง ุชูุณุชุฏุนู ุฃุจุฏุงู
- **ุงูุญู**: ุฅูุดุงุก Celery task ูุฑุจุทูุง ุจู Beat schedule
- **ุงููููุงุช ุงููุชุฃุซุฑุฉ**:
  - `complaints/tasks.py` - ุฅุถุงูุฉ task
  - `crm/settings.py` - ุฅุถุงูุฉ CELERY_BEAT_SCHEDULE

### 1.5 โ ุชูุญูุฏ ูุธุงู ุงูุฅุดุนุงุฑุงุช
- **ุงููุดููุฉ**: ูุธุงูุงู ูููุตูุงู (ComplaintNotification + Notification ุงูุฑุฆูุณู)
- **ุงูุญู**: ุฅุถุงูุฉ ุฃููุงุน ุดูุงูู ูู notifications/signals.py ูุชุบุทูุฉ ูู ุงูุฃุญุฏุงุซ (status_change, assignment, escalation) ุจุงูุฅุถุงูุฉ ููุฅุดุนุงุฑุงุช ุงูุฏุงุฎููุฉ
- **ุงูููู**: `notifications/signals.py` - ุฅุถุงูุฉ signal handlers ุฌุฏูุฏุฉ

---

## ุงููุฑุญูุฉ 2 โ ุชุญุณููุงุช ุงูุฃุฏุงุก ูุงูุชูุงูู (Performance & Integration)

### 2.1 โ ุชุญุณูู ุฃุฏุงุก escalated_complaints_api
- **ุงููุดููุฉ**: N+1 queries ูู Python loop
- **ุงูุญู**: ุงุณุชุจุฏุงู ุจู Subquery ูู ุงุณุชุนูุงู ูุงุญุฏ
- **ุงูููู**: `complaints/api_views.py`

### 2.2 โ ุฅุตูุงุญ ุฑุงุจุท ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- **ุงููุดููุฉ**: hardcoded `localhost:8000`
- **ุงูุญู**: ุงุณุชุฎุฏุงู `settings.SITE_URL` ุฃู `settings.ALLOWED_HOSTS` ุฏููุงููููุงู
- **ุงูููู**: `complaints/services/notification_service.py`

### 2.3 โ ุชูุนูู ComplaintUserPermissions
- **ุงููุดููุฉ**: ูุธุงู ุตูุงุญูุงุช ุบูู ููู ุบูุฑ ูุณุชุฎุฏู
- **ุงูุญู**: ุฅุถุงูุฉ ูุญูุตุงุช `can_be_assigned_complaints` ู `can_accept_new_complaint()` ู `can_assign_complaints` ูู views ุงูุฅุณูุงุฏ
- **ุงููููุงุช**: `complaints/api_views.py` - `ComplaintAssignmentUpdateView`

---

## ุงููุฑุญูุฉ 3 โ ุชูุงูู ุดุงูู ูุน ุงููุธุงู (Full System Integration)

### 3.1 โฌ ุฅูุดุงุก ุดูุงูู ุชููุงุฆูุฉ ูู ุชุฃุฎุฑ ุงูุทูุจุงุช ูุงูุชุฑููุจุงุช
### 3.2 โฌ ุฑุจุท ุงูุดูุงูู ุจูุธุงู WhatsApp
### 3.3 โฌ ุฅุถุงูุฉ KPIs ูู ููุญุฉ ุงููุนูููุงุช ุงูุฑุฆูุณูุฉ
### 3.4 โฌ ุฏูุฌ ุชูุงุฑูุฑ ุงูุดูุงูู ูุน reports/

---

## ุณุฌู ุงูุชุบููุฑุงุช
| ุงูุชุงุฑูุฎ | ุงูุชุบููุฑ | ุงูุญุงูุฉ |
|---------|--------|--------|
| 2026-02-14 | ุฅูุดุงุก ุงูุฎุทุฉ | โ |
| 2026-02-14 | ุงููุฑุญูุฉ 1 - ุงูุชูุงู ุงูุชูููุฐ | โ |
| 2026-02-14 | ุงููุฑุญูุฉ 2 - ุงูุชูุงู ุงูุชูููุฐ | โ |
