#!/bin/bash

################################################################################
# ุณูุฑูุจุช ูุฒุงููุฉ ุจูุงูุงุช ุงุณุชูุงู ุงูุฃููุดุฉ
# Fabric Receipt Data Synchronization Script
################################################################################

echo "================================"
echo "ูุฒุงููุฉ ุจูุงูุงุช ุงุณุชูุงู ุงูุฃููุดุฉ"
echo "Fabric Receipt Data Sync"
echo "================================"
echo ""

# ุงูุชุญูู ูู ูุฌูุฏ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
if [ -d "venv" ]; then
	echo "โ ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ..."
	source venv/bin/activate
else
	echo "โ๏ธ  ุชุญุฐูุฑ: ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ุบูุฑ ููุฌูุฏุฉ"
	echo "   ุณูุชู ุงุณุชุฎุฏุงู Python ุงูุนุงู"
fi

echo ""
echo "================================"
echo "ุงูุฎุทูุฉ 1: ุณุญุจ ุขุฎุฑ ุงูุชุญุฏูุซุงุช ูู GitHub"
echo "================================"
git pull origin main

if [ $? -ne 0 ]; then
	echo "โ ูุดู ุณุญุจ ุงูุชุญุฏูุซุงุช ูู GitHub"
	exit 1
fi

echo ""
echo "================================"
echo "ุงูุฎุทูุฉ 2: ูุนุงููุฉ ุงูุจูุงูุงุช ุงูุชู ุณูุชู ูุฒุงููุชูุง"
echo "================================"
python manage.py migrate_fabric_receipts --dry-run

echo ""
read -p "ูู ุชุฑูุฏ ุงููุชุงุจุนุฉ ุจุงููุฒุงููุฉ ุงููุนููุฉุ (y/N): " confirm

if [ "$confirm" != "y" ] && [ "$confirm" != "Y" ]; then
	echo "โ ุชู ุฅูุบุงุก ุงููุฒุงููุฉ"
	exit 0
fi

echo ""
echo "================================"
echo "ุงูุฎุทูุฉ 3: ุชูููุฐ ุงููุฒุงููุฉ"
echo "================================"
python manage.py migrate_fabric_receipts

if [ $? -eq 0 ]; then
	echo ""
	echo "================================"
	echo "โ ุชูุช ุงููุฒุงููุฉ ุจูุฌุงุญ!"
	echo "================================"
	echo ""
	echo "๐ ุงูุขู ููููู:"
	echo "   1. ูุชุญ ููุญุฉ ุงูุชุญูู: http://127.0.0.1:8000/admin/manufacturing/fabricreceipt/"
	echo "   2. ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุฒุงููุฉ"
	echo "   3. ุงููุฒุงููุฉ ุงููุณุชูุจููุฉ ุณุชููู ุชููุงุฆูุฉ"
	echo ""
else
	echo ""
	echo "================================"
	echo "โ ูุดูุช ุงููุฒุงููุฉ!"
	echo "================================"
	echo "ูุฑุฌู ุงูุชุญูู ูู ุงูุฃุฎุทุงุก ุฃุนูุงู"
	exit 1
fi
