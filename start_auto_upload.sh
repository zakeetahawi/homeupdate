#!/bin/bash

# ูุธุงู ุงูุฑูุน ุงูุชููุงุฆู ูููููุงุช - ูุญุณู ูููุตูุญ
# ูุฑูุน 40 ููู ูู 5 ุฏูุงุฆู ุจุฏูู ุถุบุท ุนูู ุงูุณูุฑูุฑ

echo "๐ ุจุฏุก ูุธุงู ุงูุฑูุน ุงูุชููุงุฆู ุงููุญุณู"
echo "===================================="
echo "โ ุชู ุฅุตูุงุญ ูุดููุฉ Celery queues"
echo "๐ค ุณูุชู ุฑูุน 40 ููู ูู 5 ุฏูุงุฆู"
echo "๐ ุงููุธุงู ูุชุฌุงูู ุงููููุงุช ุบูุฑ ุงูููุฌูุฏุฉ"
echo "โน๏ธ  ุงุถุบุท Ctrl+C ููุชููู"
echo "===================================="

cd /home/zakee/homeupdate

# ุงูุชุฃูุฏ ูู ุชุดุบูู Celery worker ุงูุตุญูุญ
echo "๐ ูุญุต Celery worker..."
if ! pgrep -f "celery.*worker.*queues=celery,file_uploads" > /dev/null; then
    echo "โ๏ธ Celery worker ุบูุฑ ููุดุบูุ ุชุดุบููู ุงูุขู..."
    python fix_celery_queues.py
    sleep 3
fi

echo "โ Celery worker ูุนูู ุจุดูู ุตุญูุญ"
echo "๐ ุจุฏุก ุงูุฑูุน ุงูุชููุงุฆู..."

# ุชุดุบูู ุงููุธุงู ูู ูุถุน ูุณุชูุฑ
python auto_upload_system.py continuous
