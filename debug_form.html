<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .info { background: #e3f2fd; color: #1565c0; }
        button { padding: 10px 20px; margin: 5px; }
        input[type="file"] { margin: 10px 0; }
        select { margin: 10px 0; padding: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</h1>
    
    <div class="debug info">
        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ:</h3>
        <div id="diagnostics"></div>
    </div>
    
    <form id="testForm" action="/odoo-db-manager/backups/upload/" method="post" enctype="multipart/form-data">
        <h3>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
        
        <div>
            <label>Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:</label><br>
            <input type="file" id="backup_file" name="backup_file" accept=".json,.gz" required>
        </div>
        
        <div>
            <label>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</label><br>
            <select id="database_id" name="database_id" required>
                <option value="">Ø§Ø®ØªØ± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
                <option value="1">Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª 1</option>
                <option value="2">Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª 2</option>
                <option value="3">Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª 3</option>
            </select>
        </div>
        
        <div>
            <input type="hidden" name="csrfmiddlewaretoken" value="test-token">
            <input type="hidden" name="backup_type" value="full">
            <input type="hidden" name="clear_data" value="off">
            <input type="hidden" name="session_id" id="session_id" value="">
        </div>
        
        <div>
            <button type="submit" id="submitBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
            <button type="button" id="testBtn">Ø§Ø®ØªØ¨Ø§Ø± JavaScript</button>
            <button type="button" id="clearBtn">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
        </div>
    </form>
    
    <div class="debug">
        <h3>Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:</h3>
        <div id="eventLog"></div>
    </div>

    <script>
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„
        function log(message, type = 'info') {
            const eventLog = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            
            const logEntry = document.createElement('div');
            logEntry.className = `debug ${className}`;
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            
            eventLog.appendChild(logEntry);
            eventLog.scrollTop = eventLog.scrollHeight;
            
            // Ø·Ø¨Ø§Ø¹Ø© ÙÙŠ console Ø£ÙŠØ¶Ø§Ù‹
            console.log(`[${timestamp}] ${message}`);
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ
        function updateDiagnostics() {
            const diagnostics = document.getElementById('diagnostics');
            
            const info = [
                `URL: ${window.location.href}`,
                `User Agent: ${navigator.userAgent}`,
                `Document Ready State: ${document.readyState}`,
                `Form Element: ${document.getElementById('testForm') ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`,
                `Submit Button: ${document.getElementById('submitBtn') ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`,
                `File Input: ${document.getElementById('backup_file') ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`,
                `Database Select: ${document.getElementById('database_id') ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`,
                `Fetch API: ${typeof fetch !== 'undefined' ? 'Ù…ØªÙˆÙØ±' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}`,
                `XMLHttpRequest: ${typeof XMLHttpRequest !== 'undefined' ? 'Ù…ØªÙˆÙØ±' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}`
            ];
            
            diagnostics.innerHTML = info.map(item => `<div>â€¢ ${item}</div>`).join('');
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ´Ø®ÙŠØµ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©', 'success');
            updateDiagnostics();
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø±Ù Ø¬Ù„Ø³Ø©
            const sessionId = 'test_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            document.getElementById('session_id').value = sessionId;
            log(`ğŸ“‹ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø©: ${sessionId}`, 'info');
        });

        // Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            log('ğŸ“¤ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬', 'info');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const fileInput = document.getElementById('backup_file');
            const databaseSelect = document.getElementById('database_id');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                log('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù', 'error');
                return;
            }
            
            if (!databaseSelect.value) {
                log('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                return;
            }
            
            log(`âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù: ${fileInput.files[0].name} (${fileInput.files[0].size} Ø¨Ø§ÙŠØª)`, 'success');
            log(`âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${databaseSelect.value}`, 'success');
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… fetch
            const formData = new FormData(this);
            
            log('ğŸ”„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…...', 'info');
            
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                log(`ğŸ“¨ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø¯: ${response.status}`, response.ok ? 'success' : 'error');
                return response.text();
            })
            .then(data => {
                log(`ğŸ“„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¯: ${data.substring(0, 200)}...`, 'info');
                
                try {
                    const jsonData = JSON.parse(data);
                    log(`âœ… JSON ØµØ§Ù„Ø­: ${JSON.stringify(jsonData)}`, 'success');
                } catch (e) {
                    log(`âš ï¸ Ø§Ù„Ø±Ø¯ Ù„ÙŠØ³ JSON: ${e.message}`, 'error');
                }
            })
            .catch(error => {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${error.message}`, 'error');
            });
        });

        // Ø²Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        document.getElementById('testBtn').addEventListener('click', function() {
            log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± JavaScript', 'info');
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ±
            const elements = [
                'testForm',
                'backup_file',
                'database_id',
                'submitBtn',
                'session_id'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`âœ… Ø§Ù„Ø¹Ù†ØµØ± ${id} Ù…ÙˆØ¬ÙˆØ¯`, 'success');
                } else {
                    log(`âŒ Ø§Ù„Ø¹Ù†ØµØ± ${id} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`, 'error');
                }
            });
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙˆØ§Ù„
            if (typeof fetch !== 'undefined') {
                log('âœ… fetch API Ù…ØªÙˆÙØ±', 'success');
            } else {
                log('âŒ fetch API ØºÙŠØ± Ù…ØªÙˆÙØ±', 'error');
            }
            
            updateDiagnostics();
        });

        // Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
        document.getElementById('clearBtn').addEventListener('click', function() {
            document.getElementById('eventLog').innerHTML = '';
            log('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„', 'info');
        });

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        window.addEventListener('error', function(e) {
            log(`âŒ Ø®Ø·Ø£ JavaScript: ${e.message} ÙÙŠ ${e.filename}:${e.lineno}`, 'error');
        });

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
        window.addEventListener('unhandledrejection', function(e) {
            log(`âŒ Promise ØºÙŠØ± Ù…Ø¹Ø§Ù„Ø¬: ${e.reason}`, 'error');
        });
    </script>
</body>
</html> 