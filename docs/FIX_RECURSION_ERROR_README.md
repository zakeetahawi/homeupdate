# ุฅุตูุงุญ ูุดููุฉ ุงูุญููุฉ ุงููุงููุงุฆูุฉ ูู ุชุญุฏูุซ ุญุงูุฉ ุงูุชุฑููุจ

## ุงููุดููุฉ
ูุงู ูุธูุฑ ุฎุทุฃ "maximum recursion depth exceeded" ุนูุฏ ุชุญุฏูุซ ุญุงูุฉ ุงูุชุฑููุจ. ูุฐุง ุงูุฎุทุฃ ูุญุฏุซ ุจุณุจุจ ุญููุฉ ูุง ููุงุฆูุฉ (recursion) ุจูู:

1. **InstallationSchedule.save()** - ูุญุฏุซ ุญุงูุฉ ุงูุทูุจ
2. **Signal update_order_installation_status** - ูุณุชุฌูุจ ูุชุบููุฑ InstallationSchedule ููุญุฏุซ Order
3. **Order.save()** - ูุฏ ูุญุฏุซ InstallationSchedule ูุฑุฉ ุฃุฎุฑู

## ุงูุณุจุจ ุงูุฌุฐุฑู
ุงููุดููุฉ ูุงูุช ูู ุงูุฅุดุงุฑุฉ (signal) `update_order_installation_status` ูู ููู `orders/models.py` ุญูุซ ูุงู ูุชู ุงุณุชุฏุนุงุก `instance.order.save()` ุจุฏูู `update_fields` ููุง ูุณุจุจ ุงุณุชุฏุนุงุก ุฏุงูุฉ `save` ุงููุงููุฉ ูุชุดุบูู ุฌููุน ุงูุฅุดุงุฑุงุช ูุฑุฉ ุฃุฎุฑู.

## ุงูุญู ุงููุทุจู

### 1. ุฅุตูุงุญ ุงูุฅุดุงุฑุฉ ูู orders/models.py
```python
@receiver(post_save, sender='installations.InstallationSchedule')
def update_order_installation_status(sender, instance, **kwargs):
    """ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุชุฑููุจ"""
    try:
        if instance.order:
            # ุชุญุฏูุซ ุญุงูุฉ ุงูุชุฑููุจ ูู ุงูุทูุจ ููุท ุฅุฐุง ุชุบูุฑุช
            if instance.order.installation_status != instance.status:
                instance.order.installation_status = instance.status
                # ุงุณุชุฎุฏุงู update_fields ูุชุฌูุจ ุงุณุชุฏุนุงุก ุฏุงูุฉ save ุงููุงููุฉ
                instance.order.save(update_fields=['installation_status'])
                
                # ุชุญุฏูุซ ุฅุดุงุฑุฉ ุงูุฅููุงู ุจุฏูู ุงุณุชุฏุนุงุก save ุงููุงููุฉ
                try:
                    instance.order.update_completion_status()
                except Exception as e:
                    print(f"ุฎุทุฃ ูู ุชุญุฏูุซ ุญุงูุฉ ุงูุฅููุงู: {e}")
                
                # ุฅุฐุง ุชู ุฅููุงู ุงูุชุฑููุจุ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุฅูู ููุชูู
                if instance.status == 'completed':
                    if instance.order.order_status not in ['completed', 'delivered']:
                        instance.order.order_status = 'completed'
                        # ุงุณุชุฎุฏุงู update_fields ูุชุฌูุจ ุงุณุชุฏุนุงุก ุฏุงูุฉ save ุงููุงููุฉ
                        instance.order.save(update_fields=['order_status'])
    except Exception as e:
        print(f"ุฎุทุฃ ูู ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ูู ุงูุชุฑููุจ: {e}")
        pass
```

### 2. ุฅุตูุงุญ ูููุฐุฌ InstallationSchedule
ุชู ุฅุฒุงูุฉ ุงูุชุญุฏูุซ ุงููุจุงุดุฑ ูุญุงูุฉ ุงูุทูุจ ูู ุฏุงูุฉ `save` ูู `InstallationSchedule` ูุชุฌูุจ ุงูุญููุฉ ุงููุงููุงุฆูุฉ:

```python
def save(self, *args, **kwargs):
    # ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุนูุฏ ุฅููุงู ุงูุชุฑููุจ
    if self.status == 'completed' and not self.completion_date:
        self.completion_date = timezone.now()
        # ุชู ุฅุฒุงูุฉ ูุฐุง ุงูุชุญุฏูุซ ูุชุฌูุจ ุงูุญููุฉ ุงููุงููุงุฆูุฉ
        # ุณูุชู ุงูุชุนุงูู ูุนู ูู ุงูุฅุดุงุฑุฉ (signal) ุจุฏูุงู ูู ุฐูู
    super().save(*args, **kwargs)
```

## ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. ุงุณุชุฎุฏุงู update_fields
- ุงุณุชุฎุฏุงู `update_fields=['installation_status']` ูุชุญุฏูุซ ุญุงูุฉ ุงูุชุฑููุจ ููุท
- ุงุณุชุฎุฏุงู `update_fields=['order_status']` ูุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ููุท
- ุชุฌูุจ ุงุณุชุฏุนุงุก ุฏุงูุฉ `save` ุงููุงููุฉ

### 2. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุฅุถุงูุฉ try-catch blocks ููุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุทุจุงุนุฉ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููุชุดุฎูุต
- ุนุฏู ุฅููุงู ุงูุนูููุฉ ุจุณุจุจ ุฃุฎุทุงุก ุซุงูููุฉ

### 3. ูุตู ุงููุณุคูููุงุช
- ุฅุฒุงูุฉ ุงูุชุญุฏูุซ ุงููุจุงุดุฑ ูู `InstallationSchedule.save()`
- ุงูุงุนุชูุงุฏ ุนูู ุงูุฅุดุงุฑุงุช (signals) ููุชุนุงูู ูุน ุงูุชุญุฏูุซุงุช ุงููุชุฑุงุจุทุฉ
- ุชุญุณูู ุชุฏูู ุงูุจูุงูุงุช ุจูู ุงูููุงุฐุฌ

## ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### โ **ุฅุตูุงุญ ุงูุฎุทุฃ**
- ุนุฏู ุธููุฑ ุฎุทุฃ "maximum recursion depth exceeded"
- ุชุญุฏูุซ ุญุงูุฉ ุงูุชุฑููุจ ุจุดูู ุตุญูุญ
- ุนุฏู ุญุฏูุซ ุญููุฉ ูุง ููุงุฆูุฉ

### โ **ุชุญุณูู ุงูุฃุฏุงุก**
- ุชูููู ุนุฏุฏ ุงุณุชุฏุนุงุกุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุชุญุณูู ุณุฑุนุฉ ุชุญุฏูุซ ุงูุญุงูุฉ
- ุชูููู ุงูุญูู ุนูู ุงูุฎุงุฏู

### โ **ุชุญุณูู ุงูุงุณุชูุฑุงุฑ**
- ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก
- ุนุฏู ุชููู ุงููุธุงู ุจุณุจุจ ุฃุฎุทุงุก ูู ุงูุชุญุฏูุซ
- ุชุญุณูู ููุซูููุฉ ุงููุธุงู

## ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุชุญุฏูุซ ุงูุญุงูุฉ
1. ุงูุชูู ุฅูู ุตูุญุฉ ุชูุงุตูู ุงูุชุฑููุจ
2. ูู ุจุชุบููุฑ ุญุงูุฉ ุงูุชุฑููุจ
3. ุชุญูู ูู ุนุฏู ุธููุฑ ุฎุทุฃ ุงูุญููุฉ ุงููุงููุงุฆูุฉ
4. ุชุญูู ูู ุชุญุฏูุซ ุงูุญุงูุฉ ุจุดูู ุตุญูุญ

### 2. ุงุฎุชุจุงุฑ ุงูุฅููุงู
1. ูู ุจุชุบููุฑ ุญุงูุฉ ุงูุชุฑููุจ ุฅูู "ููุชูู"
2. ุชุญูู ูู ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุฅูู "ููุชูู"
3. ุชุญูู ูู ุนุฏู ุญุฏูุซ ุฎุทุฃ

### 3. ุงุฎุชุจุงุฑ ุงูุฃุฎุทุงุก
1. ูู ุจุชุญุฏูุซ ุงูุญุงูุฉ ุนุฏุฉ ูุฑุงุช ูุชุชุงููุฉ
2. ุชุญูู ูู ุนุฏู ุญุฏูุซ ุฃุฎุทุงุก
3. ุชุญูู ูู ุงุณุชูุฑุงุฑ ุงููุธุงู

## ููุงุญุธุงุช ุชูููุฉ

### 1. ุงุณุชุฎุฏุงู update_fields
```python
# ูุจู ุงูุฅุตูุงุญ
instance.order.save()  # ูุณุจุจ ุญููุฉ ูุง ููุงุฆูุฉ

# ุจุนุฏ ุงูุฅุตูุงุญ
instance.order.save(update_fields=['installation_status'])  # ุขูู
```

### 2. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
```python
try:
    instance.order.update_completion_status()
except Exception as e:
    print(f"ุฎุทุฃ ูู ุชุญุฏูุซ ุญุงูุฉ ุงูุฅููุงู: {e}")
```

### 3. ูุตู ุงููุณุคูููุงุช
- `InstallationSchedule.save()`: ุชุญุฏูุซ ุจูุงูุงุช ุงูุชุฑููุจ ููุท
- `Signal`: ุงูุชุนุงูู ูุน ุงูุชุญุฏูุซุงุช ุงููุชุฑุงุจุทุฉ
- `Order.save()`: ุชุญุฏูุซ ุจูุงูุงุช ุงูุทูุจ ููุท

## ุงููููุงุช ุงููุนุฏูุฉ

### orders/models.py
- ุฅุตูุงุญ ุงูุฅุดุงุฑุฉ `update_order_installation_status`
- ุงุณุชุฎุฏุงู `update_fields` ูุชุฌูุจ ุงูุญููุฉ ุงููุงููุงุฆูุฉ
- ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก

### installations/models.py
- ุฅุฒุงูุฉ ุงูุชุญุฏูุซ ุงููุจุงุดุฑ ูู `InstallationSchedule.save()`
- ุงูุงุนุชูุงุฏ ุนูู ุงูุฅุดุงุฑุงุช ููุชุนุงูู ูุน ุงูุชุญุฏูุซุงุช

## ููุงุฑูุฉ ูุจู ูุจุนุฏ

### ูุจู ุงูุฅุตูุงุญ
- ุฎุทุฃ "maximum recursion depth exceeded"
- ุญููุฉ ูุง ููุงุฆูุฉ ุจูู ุงูููุงุฐุฌ
- ุชููู ุงููุธุงู ุนูุฏ ุชุญุฏูุซ ุงูุญุงูุฉ
- ุฃุฏุงุก ุจุทูุก ุจุณุจุจ ุงูุชุญุฏูุซุงุช ุงููุชูุฑุฑุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ
- ุชุญุฏูุซ ุณูุณ ูุณุฑูุน ููุญุงูุฉ
- ุนุฏู ุญุฏูุซ ุญููุฉ ูุง ููุงุฆูุฉ
- ุงุณุชูุฑุงุฑ ุงููุธุงู
- ุฃุฏุงุก ูุญุณู

## ุงูุฎุทูุงุช ุงููุณุชูุจููุฉ

### 1. ุชุญุณููุงุช ุฅุถุงููุฉ
- ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุชุญูู ูู ุงูุฃุฎุทุงุก
- ุชุญุณูู ุฑุณุงุฆู ุงูุฎุทุฃ
- ุฅุถุงูุฉ ุณุฌูุงุช ุฃูุซุฑ ุชูุตููุงู

### 2. ุชุญุณููุงุช ุงูุฃุฏุงุก
- ุชุญุณูู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅุถุงูุฉ caching ููุจูุงูุงุช ุงููุชูุฑุฑุฉ
- ุชุญุณูู ุณุฑุนุฉ ุงูุชุญุฏูุซ

### 3. ุชุญุณููุงุช ุงูุฃูุงู
- ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุฅุถุงูุฉ ุณุฌูุงุช ุงูุฃูุงู

## ููุงุญุธุงุช ูููุฉ

### 1. ุงูุชูุงูู
- ุงููุธุงู ูุชูุงูู ูุน ุฌููุน ุงููุชุตูุญุงุช
- ูุง ูุคุซุฑ ุนูู ุงููุธุงุฆู ุงูุฃุฎุฑู
- ุงูุญูุงุธ ุนูู ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู

### 2. ุงูุฃูุงู
- ูู ูุชู ุชุบููุฑ ุฃู ุฅุนุฏุงุฏุงุช ุฃูููุฉ
- ุชู ุงูุญูุงุธ ุนูู ุฌููุน ุงููุธุงุฆู ุงูุฃูููุฉ
- ูู ูุชู ุญุฐู ุฃู ุจูุงูุงุช ุญุณุงุณุฉ

### 3. ุงูุตูุงูุฉ
- ุงูููุฏ ุณูู ุงูุตูุงูุฉ ูุงูุชุทููุฑ
- ูููู ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ ุจุณูููุฉ
- ุงููุธุงู ูุงุจู ููุชูุณุน

## ุงุณุชูุชุงุฌ

ุชู ุฅุตูุงุญ ูุดููุฉ ุงูุญููุฉ ุงููุงููุงุฆูุฉ ุจูุฌุงุญ ูู ุฎูุงู:

1. **ุงุณุชุฎุฏุงู `update_fields`** ูุชุฌูุจ ุงุณุชุฏุนุงุก ุฏุงูุฉ `save` ุงููุงููุฉ
2. **ูุตู ุงููุณุคูููุงุช** ุจูู ุงูููุงุฐุฌ ูุงูุฅุดุงุฑุงุช
3. **ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก** ูุชุฌูุจ ุชููู ุงููุธุงู
4. **ุชุญุณูู ุงูุฃุฏุงุก** ูู ุฎูุงู ุชูููู ุงูุชุญุฏูุซุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ

ุงูุขู ูููู ุชุญุฏูุซ ุญุงูุฉ ุงูุชุฑููุจ ุจุดูู ุณูุณ ูุณุฑูุน ุจุฏูู ุญุฏูุซ ุฃุฎุทุงุก! ๐ฏ 