# إصلاح عرض رقم العقد في صفحة التفاصيل

## التاريخ: 2025-11-23

## المشكلة
كان رقم العقد في صفحة تفاصيل الطلب يعرض رقم الطلب فقط (مثال: 12345) بدلاً من رقم العقد المنسق (مثال: BR-00123).

## الحل
تم تحديث جميع أماكن عرض رقم العقد في صفحة `order_detail.html` ليتطابق مع التنسيق المستخدم في قالب العقد الإلكتروني.

## التعديلات المُنفذة

### الملف: `/orders/templates/orders/order_detail.html`

#### 1. رقم العقد الرئيسي (3 أماكن)
تم التحديث في جميع الأماكن التي تعرض `order.contract_number`:

**قبل:**
```html
<td>{{ order.contract_number|default:'-' }}</td>
```

**بعد:**
```html
<td>
    <span dir="ltr" style="font-weight: bold; color: #a67c52;">
        {{ order.branch.code|default:"BR" }}-{{ order.contract_number|stringformat:"05d"|default:order.order_number }}
    </span>
</td>
```

**الأماكن المُحدثة:**
- السطر 40-47: عرض رقم العقد بعد رقم الطلب مباشرة
- السطر 150-157: عرض رقم العقد في حالة أنواع طلبات متعددة
- السطر 133 و 198: عرض رقم عقد المعاينة المرتبطة

#### 2. ترتيب العرض الجديد
تم نقل رقم العقد ليظهر **مباشرة بعد رقم الطلب** وليس قبله:

```
✅ الترتيب الجديد:
1. رقم الطلب
2. رقم العقد  ← هنا
3. العميل
4. البائع
5. تاريخ الطلب
...
```

**قبل:**
```
رقم الطلب: 12345
العميل: محمد أحمد
...
رقم العقد: 123  ← كان في الأسفل
```

**بعد:**
```
رقم الطلب: 12345
رقم العقد: BR-00123  ← الآن مباشرة بعد رقم الطلب
العميل: محمد أحمد
...
```

#### 3. عرض رقم عقد المعاينة المرتبطة
تم تحديث عرض رقم العقد في معلومات المعاينة المرتبطة:

**قبل:**
```html
{{ order.related_inspection.contract_number }}
```

**بعد:**
```html
<span dir="ltr" style="font-weight: bold; color: #a67c52;">
    {{ order.related_inspection.branch.code|default:"BR" }}-{{ order.related_inspection.contract_number|stringformat:"05d" }}
</span>
```

## التنسيق الجديد

- **رمز الفرع:** يُعرض كود الفرع (مثل: BR، RY، JD)
- **رقم العقد:** يُعرض مكون من 5 أرقام مع أصفار بادئة (مثل: 00123)
- **التنسيق الكامل:** BR-00123
- **اللون:** بني ذهبي (#a67c52) ليتطابق مع العقد
- **الخط:** عريض (bold)
- **الاتجاه:** من اليسار لليمين (LTR) للأرقام
- **الموقع:** مباشرة بعد رقم الطلب

## أمثلة

| رقم الطلب | الفرع | رقم العقد المعروض |
|-----------|-------|-------------------|
| 123 | الرئيسي (BR) | BR-00123 |
| 4567 | الرياض (RY) | RY-04567 |
| 89 | جدة (JD) | JD-00089 |

## المناطق المُحدثة

✅ **تم التحديث في:**
1. معلومات الطلب - رقم العقد الرئيسي (بعد رقم الطلب مباشرة)
2. معلومات الطلب - رقم العقد للطلبات المتعددة الأنواع
3. المعاينة المرتبطة - رقم عقد المعاينة (موقعين)

✅ **لم يتم التعديل:**
- أرقام العقود الإضافية (contract_number_2, contract_number_3) - تُعرض كما هي لأنها اختيارية ونصية

## التوافق

- ✅ يتطابق 100% مع تنسيق العقد الإلكتروني
- ✅ يتطابق مع تنسيق العقد المطبوع
- ✅ يظهر بشكل احترافي ومنسق
- ✅ سهل القراءة والتعرف عليه
- ✅ رقم العقد يظهر مباشرة بعد رقم الطلب

## الاختبار

```bash
python manage.py check
# ✅ System check identified no issues (0 silenced).
```

---

✅ **تم الإصلاح بنجاح في جميع المواقع**
