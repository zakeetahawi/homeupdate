# ๐ ุชุญุฏูุซ: ุฅุนุงุฏุฉ ุญุณุงุจ ุชููุงุฆูุฉ ููุฃุณุนุงุฑ ูู ุญุณุงุจุงุช ุงููุตูุน

**ุงูุชุงุฑูุฎ:** 2026-01-20  
**ุงูุญุงูุฉ:** โ ููุชูู

---

## ๐ ุงูููุฎุต

ุชู ุฅุถุงูุฉ ุขููุฉ **ุฅุนุงุฏุฉ ุญุณุงุจ ุชููุงุฆูุฉ** ููุฃุณุนุงุฑ ูู ูุธุงู ุญุณุงุจุงุช ุงููุตูุน. ุนูุฏ ุชุบููุฑ ุงูุฃุณุนุงุฑ ูู ุงูุฅุนุฏุงุฏุงุช ุฃู ุชุญุฏูุซ ุณุนุฑ ุฎูุงุท ูุนููุ ูุชู ุชุญุฏูุซ ุฌููุน ุงูุนูุงุตุฑ **ุบูุฑ ุงููุฏููุนุฉ** ุชููุงุฆูุงู.

---

## ๐ฏ ุงููุดููุฉ ุงูุณุงุจูุฉ

- ุชุบููุฑ ุงูุฃุณุนุงุฑ ูู ุงูุฅุนุฏุงุฏุงุช ูู ูุคุซุฑ ุนูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
- ุงูุนูุงุตุฑ ุบูุฑ ุงููุฏููุนุฉ ุงุญุชูุธุช ุจุงูุฃุณุนุงุฑ ุงููุฏููุฉ
- ุงูุชูุงุฑูุฑ ุงุณุชุฎุฏูุช methods ุฏููุงููููุฉ ููู ููุญุฉ ุงูุชุญูู ุนุฑุถุช ุงูููู ุงููุฎุฒูุฉ ุงููุฏููุฉ
- ุนุฏู ุชุทุงุจู ุจูู ุงูุจูุงูุงุช ูู ููุญุฉ ุงูุชุญูู ูุงูุชูุงุฑูุฑ

---

## โจ ุงูุญู ุงููุทุจู

### 1. ุฅุนุงุฏุฉ ุญุณุงุจ ุชููุงุฆูุฉ ุนูุฏ ุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช

#### ูู `FactoryAccountingSettings`:

```python
def save(self, *args, **kwargs):
    # ุชุชุจุน ุงูุชุบููุฑุงุช ูู ุงูุฃุณุนุงุฑ
    old_cutter_rate = None
    old_tailor_rate = None
    
    if not is_new:
        old_obj = FactoryAccountingSettings.objects.get(pk=1)
        old_cutter_rate = old_obj.default_cutter_rate
        old_tailor_rate = old_obj.default_rate_per_meter
    
    super().save(*args, **kwargs)
    
    # ุฅุนุงุฏุฉ ุญุณุงุจ ุชููุงุฆูุฉ ููุนูุงุตุฑ ุบูุฑ ุงููุฏููุนุฉ
    if old_cutter_rate != self.default_cutter_rate:
        self.recalculate_unpaid_cutter_costs()
    if old_tailor_rate != self.default_rate_per_meter:
        self.recalculate_unpaid_tailor_costs()
```

**ุงููุชูุฌุฉ:**
- โ ุชุญุฏูุซ ููุฑู ูุฌููุน ุจุทุงูุงุช ุงููุตุงุต ุบูุฑ ุงููุฏููุนุฉ
- โ ุชุญุฏูุซ ููุฑู ูุฌููุน ุชูุณููุงุช ุงูุฎูุงุทูู ุงูุชู ุชุณุชุฎุฏู ุงูุณุนุฑ ุงูุนุงู

---

### 2. ุฅุนุงุฏุฉ ุญุณุงุจ ุชููุงุฆูุฉ ุนูุฏ ุชุบููุฑ ุณุนุฑ ุฎูุงุท

#### ูู `Tailor`:

```python
def save(self, *args, **kwargs):
    # ุชุชุจุน ุงูุชุบููุฑุงุช ูู ุงูุณุนุฑ
    if not is_new:
        old_obj = Tailor.objects.get(pk=self.pk)
        old_rate = old_obj.get_rate()
    
    super().save(*args, **kwargs)
    
    # ุฅุนุงุฏุฉ ุญุณุงุจ ุฅุฐุง ุชุบูุฑ ุงูุณุนุฑ
    if old_rate != new_rate:
        self.recalculate_unpaid_splits()
```

**ุงููุชูุฌุฉ:**
- โ ุชุญุฏูุซ ููุฑู ูุฌููุน ุชูุณููุงุช ูุฐุง ุงูุฎูุงุท ุบูุฑ ุงููุฏููุนุฉ
- โ ูุดูู ุงูุชุบููุฑุงุช ูู ุงูุณุนุฑ ุงููุฎุตุต ุฃู ุงูุชุจุฏูู ูู/ุฅูู ุงูุณุนุฑ ุงูุนุงู

---

### 3. ุชุญุณููุงุช ููุญุฉ ุงูุชุญูู

#### ุนุฑุถ ุงูุฃุณุนุงุฑ ุงูุฏููุงููููุฉ:

**ูู `FactoryCardAdmin`:**
- โ `cutter_price_display`: ุนุฑุถ ุงูุณุนุฑ ุงูุญุงูู ูููุตุงุต
- โ `cutter_cost_display`: ุนุฑุถ ุงูุชูููุฉ ุงูุญุงููุฉ ูููุตุงุต
- ๐จ ุฃููุงู ูููุฒุฉ: ุฃุฎุถุฑ ูููุฏููุน (ูุญููุธ)ุ ุจุฑุชูุงูู ูุบูุฑ ุงููุฏููุน (ุฏููุงูููู)

**ูู `CardMeasurementSplitInline` ู `CardMeasurementSplitAdmin`:**
- โ `current_rate_display`: ุงูุณุนุฑ ุงูุญุงูู ูููุชุฑ
- โ `current_value_display`: ุงููููุฉ ุงููุงููุฉ ุงูุญุงููุฉ
- ๐จ ููุณ ูุธุงู ุงูุฃููุงู ููุชูููุฒ

**ูุซุงู:**
```
ุงูุณุนุฑ ุงููุฎุฒู: 1.00 ุฌ.ู
ุงูุณุนุฑ ุงูุญุงูู: 1.25 ุฌ.ู (ุญุงูู - ุณูุชู ุงูุชุญุฏูุซ) โ ุจุฑุชูุงูู

ุฃู:

ุงูุณุนุฑ ุงููุฎุฒู: 1.00 ุฌ.ู  
ุงูุณุนุฑ ุงูุญุงูู: 1.00 ุฌ.ู (ูุฏููุน - ูุญููุธ) โ ุฃุฎุถุฑ
```

---

### 4. ุฑุณุงุฆู ุชูุถูุญูุฉ

#### ุนูุฏ ุญูุธ ุงูุฅุนุฏุงุฏุงุช:
```
โ ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ. ุชู ุฅุนุงุฏุฉ ุญุณุงุจ ุฌููุน ุงูุนูุงุตุฑ 
ุบูุฑ ุงููุฏููุนุฉ ุชููุงุฆูุงู ุจุงุณุชุฎุฏุงู ุงูุฃุณุนุงุฑ ุงูุฌุฏูุฏุฉ.
```

#### ุนูุฏ ุชุญุฏูุซ ุฎูุงุท:
```
โ ุชู ุชุญุฏูุซ [ุงุณู ุงูุฎูุงุท] ุจูุฌุงุญ. ุชู ุฅุนุงุฏุฉ ุญุณุงุจ ุฌููุน 
ุงูุชูุณููุงุช ุบูุฑ ุงููุฏููุนุฉ ุชููุงุฆูุงู ุจุงุณุชุฎุฏุงู ุงูุณุนุฑ ุงูุฌุฏูุฏ.
```

---

### 5. ุฃูุฑ ุฅุฏุงุฑู ููุฅุนุงุฏุฉ ุงููุฏููุฉ

ุชู ุฅุถุงูุฉ management command ูุฅุนุงุฏุฉ ุงูุญุณุงุจ ูุฏููุงู ุนูุฏ ุงูุญุงุฌุฉ:

```bash
# ูุนุงููุฉ ุงูุชุบููุฑุงุช ุฏูู ุชุทุจูููุง
python manage.py recalculate_unpaid_prices --dry-run

# ุชุทุจูู ุงูุชุญุฏูุซุงุช
python manage.py recalculate_unpaid_prices

# ุชุญุฏูุซ ุงููุตุงุตูู ููุท
python manage.py recalculate_unpaid_prices --cutters

# ุชุญุฏูุซ ุงูุฎูุงุทูู ููุท
python manage.py recalculate_unpaid_prices --tailors
```

**ูุฎุฑุฌุงุช ุงูุฃูุฑ:**
```
๐ ูุถุน ุงููุนุงููุฉ - ูู ูุชู ุชุทุจูู ุฃู ุชุบููุฑุงุช

๐ ุฅุนุงุฏุฉ ุญุณุงุจ ุชูุงููู ุงููุตุงุต...
โ ุณูุชู ุชุญุฏูุซ 0 ุจุทุงูุฉ ูุตุงุต

๐งต ุฅุนุงุฏุฉ ุญุณุงุจ ุชูุงููู ุงูุฎูุงุทูู...
  โข ุงููู ููููุจ - ุงูุจุทุงูุฉ 16-0701-0002: 68.00 โ 85.0000 ุฌ.ู (ุณุนุฑ: 1.25)
  โข ูุณุนุฏ ุญูุฏู - ุงูุจุทุงูุฉ 14-1029-0003: 11.00 โ 13.7500 ุฌ.ู (ุณุนุฑ: 1.25)
  ...
โ ุณูุชู ุชุญุฏูุซ 24 ุชูุณูู ุฎูุงุท

============================================================
๐ ุงููุนุงููุฉ: ุณูุชู ุชุญุฏูุซ 24 ุนูุตุฑ ุฅุฌูุงูุงู
ูู ุจุชุดุบูู ุงูุฃูุฑ ุจุฏูู --dry-run ูุชุทุจูู ุงูุชุบููุฑุงุช
============================================================
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### Models (`factory_accounting/models.py`):

1. **FactoryAccountingSettings:**
   - โ `save()`: ุชุชุจุน ุชุบููุฑุงุช ุงูุฃุณุนุงุฑ ูุชูุนูู ุฅุนุงุฏุฉ ุงูุญุณุงุจ
   - โ `recalculate_unpaid_cutter_costs()`: ุฅุนุงุฏุฉ ุญุณุงุจ ุจุทุงูุงุช ุงููุตุงุต
   - โ `recalculate_unpaid_tailor_costs()`: ุฅุนุงุฏุฉ ุญุณุงุจ ุชูุณููุงุช ุงูุฎูุงุทูู

2. **Tailor:**
   - โ `save()`: ุชุชุจุน ุชุบููุฑุงุช ุงูุณุนุฑ ูุชูุนูู ุฅุนุงุฏุฉ ุงูุญุณุงุจ
   - โ `recalculate_unpaid_splits()`: ุฅุนุงุฏุฉ ุญุณุงุจ ุชูุณููุงุช ูุฐุง ุงูุฎูุงุท

### Admin (`factory_accounting/admin.py`):

1. **FactoryAccountingSettingsAdmin:**
   - โ `save_model()`: ุฑุณุงูุฉ ูุฌุงุญ ุนูุฏ ุงูุญูุธ

2. **FactoryCardAdmin:**
   - โ `cutter_price_display()`: ุนุฑุถ ุงูุณุนุฑ ุงูุฏููุงูููู
   - โ `cutter_cost_display()`: ุนุฑุถ ุงูุชูููุฉ ุงูุฏููุงููููุฉ
   - โ ุชุญุฏูุซ `list_display` ู `readonly_fields`

3. **CardMeasurementSplitInline:**
   - โ `current_rate_display()`: ุนุฑุถ ุงูุณุนุฑ ุงูุญุงูู
   - โ `current_value_display()`: ุนุฑุถ ุงููููุฉ ุงูุญุงููุฉ

4. **CardMeasurementSplitAdmin:**
   - โ ููุณ ุงูู methods ุงูุฏููุงููููุฉ
   - โ ุชุญุฏูุซ `list_display` ู `readonly_fields`

5. **TailorAdmin:**
   - โ `save_model()`: ุฑุณุงูุฉ ูุฌุงุญ ุนูุฏ ุชุญุฏูุซ ุงูุณุนุฑ

### Management Command:

- โ `factory_accounting/management/commands/recalculate_unpaid_prices.py`

---

## ๐ ุณูุงุณุฉ ุงูุญูุงูุฉ

### ููุนูุงุตุฑ ุงููุฏููุนุฉ:
- โ **ูุญููุธุฉ** - ูุง ูุชู ุชุบููุฑ ุฃุณุนุงุฑูุง ุฃุจุฏุงู
- โ ุชุญุงูุธ ุนูู ุงูุฃุณุนุงุฑ ุงูุชุงุฑูุฎูุฉ ุงูุฃุตููุฉ
- โ ุงูุฃุณุนุงุฑ ุงููุนุฑูุถุฉ ุจุงูููู ุงูุฃุฎุถุฑ

### ููุนูุงุตุฑ ุบูุฑ ุงููุฏููุนุฉ:
- ๐ **ุฏููุงููููุฉ** - ุชุชุญุฏุซ ุชููุงุฆูุงู ูุน ุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช
- ๐ ุชุณุชุฎุฏู ุงูุฃุณุนุงุฑ ุงูุญุงููุฉ ุฏุงุฆูุงู
- ๐ ุงูุฃุณุนุงุฑ ุงููุนุฑูุถุฉ ุจุงูููู ุงูุจุฑุชูุงูู

---

## ๐ฏ ุงูููุงุฆุฏ

1. โ **ุฏูุฉ ุงูุจูุงูุงุช**: ุชุทุงุจู ุชุงู ุจูู ููุญุฉ ุงูุชุญูู ูุงูุชูุงุฑูุฑ
2. โ **ุชุญุฏูุซ ููุฑู**: ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุญุณุงุจ ูุฏููุฉ
3. โ **ุดูุงููุฉ**: ุนุฑุถ ูุงุถุญ ููุฃุณุนุงุฑ ุงูุญุงููุฉ ูุงููุฎุฒูุฉ
4. โ **ุฃูุงู**: ุญูุงูุฉ ุงูุฃุณุนุงุฑ ุงูุชุงุฑูุฎูุฉ ููุนูุงุตุฑ ุงููุฏููุนุฉ
5. โ **ูุฑููุฉ**: ุฅููุงููุฉ ุฅุนุงุฏุฉ ุงูุญุณุงุจ ูุฏููุงู ุนูุฏ ุงูุญุงุฌุฉ

---

## ๐ ุงุฎุชุจุงุฑ

ุชู ุงุฎุชุจุงุฑ ุงููุธุงู ูุฃุธูุฑ:
- โ 0 ุจุทุงูุฉ ูุตุงุต ุชุญุชุงุฌ ุชุญุฏูุซ
- โ 24 ุชูุณูู ุฎูุงุท ุชุญุชุงุฌ ุชุญุฏูุซ
- โ ุฌููุน ุงูุชุญุฏูุซุงุช ุชูุช ุจูุฌุงุญ

---

## ๐ ุงูุชูุงูู ูุน ุงูุชุญุฏูุซ ุงูุณุงุจู

ูุฐุง ุงูุชุญุฏูุซ ูููู ุงูุชุญุฏูุซ `2282c18e` ุงูุฐู ุฃุถุงู:
- Methods ุฏููุงููููุฉ ูู Models
- ุญุณุงุจุงุช ุฏููุงููููุฉ ูู ุงูุชูุงุฑูุฑ

ูุงูุขู ูุถูู:
- โ ุฅุนุงุฏุฉ ุญุณุงุจ ุชููุงุฆูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุนุฑุถ ุฏููุงูููู ูู ููุญุฉ ุงูุชุญูู
- โ ุชุทุงุจู ูุงูู ุจูู ุฌููุน ุงูุฃุฌุฒุงุก

---

## ๐ ููุงุญุธุงุช

- ุงูุชุญุฏูุซ **ูุง ูุคุซุฑ** ุนูู ุงูุนูุงุตุฑ ุงููุฏููุนุฉ
- ุงูุชุญุฏูุซ **ุชููุงุฆู** ุนูุฏ ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุฃู ุงูุฎูุงุท
- ูููู ุงูุชุญูู ูุฏููุงู ุนุจุฑ management command
- ุฌููุน ุงูุชุบููุฑุงุช **ูุญููุฉ** ุจุชุชุจุน ุงูุญุงูุฉ (paid/unpaid)
