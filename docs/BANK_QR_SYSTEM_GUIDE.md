# ๐ฆ ูุธุงู QR ููุญุณุงุจุงุช ุงูุจูููุฉ - ุฏููู ุดุงูู
**Bank Accounts QR System - Complete Guide**

---

## ๐ **ูุธุฑุฉ ุนุงูุฉ**

ูุธุงู ูุชูุงูู ูุฅูุดุงุก ูุฅุฏุงุฑุฉ QR Codes ููุญุณุงุจุงุช ุงูุจูููุฉ ุงูุฎุงุตุฉ ุจุงูุดุฑูุฉุ ูุน ุตูุญุงุช ุซุงุจุชุฉ ุนูู Cloudflare Workers ูุนุฑุถ ุจูุงูุงุช ุงูุญุณุงุจุงุช ุจุดูู ุงุญุชุฑุงูู.

### โจ **ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ**

- โ **ุฅุฏุงุฑุฉ ูุงููุฉ ููุญุณุงุจุงุช ุงูุจูููุฉ** ูู ููุญุฉ ุชุญูู Django Admin
- โ **ุชูููุฏ QR Code ุชููุงุฆู** ููู ุญุณุงุจ ุจููู
- โ **ุตูุญุงุช ุซุงุจุชุฉ ุนูู Cloudflare** ุณุฑูุนุฉ ููุชุงุญุฉ ุฏุงุฆูุงู
- โ **ุฏุนู ุญุณุงุจุงุช ูุชุนุฏุฏุฉ** - ุตูุญุฉ ููู ุญุณุงุจ + ุตูุญุฉ ูุฌููุน ุงูุญุณุงุจุงุช
- โ **ูุณุฎ ุณุฑูุน** ููุจูุงูุงุช (ุฑูู ุงูุญุณุงุจุ IBANุ SWIFT)
- โ **ุชุตุฏูุฑ PDF** ูุทุจุงุนุฉ QR Codes
- โ **ูุฒุงููุฉ ุชููุงุฆูุฉ** ูุน Cloudflare Workers KV
- โ **ุชุตููู ุงุญุชุฑุงูู** ุจููุณ ุงูููุท ุงูุฐูุจู ููููุชุฌุงุช

---

## ๐๏ธ **ูููู ุงููููุงุช**

```
accounting/
โโโ models.py                          # ูููุฐุฌ BankAccount
โโโ admin.py                           # ููุญุฉ ุชุญูู ุงูุญุณุงุจุงุช ุงูุจูููุฉ
โโโ views_bank.py                      # Views ููุญุณุงุจุงุช
โโโ urls.py                            # URLs (ูุญุฏุซ)
โโโ cloudflare_sync.py                 # ูุธุงู ูุฒุงููุฉ Cloudflare
โโโ migrations/
โ   โโโ 0023_add_bank_accounts.py     # Migration ููุฌุฏูู ุงูุฌุฏูุฏ
โโโ management/commands/
โ   โโโ generate_bank_qr.py           # ุชูููุฏ QR Codes
โ   โโโ sync_bank_accounts.py         # ูุฒุงููุฉ ูุน Cloudflare
โโโ templates/accounting/
    โโโ bank_qr.html                   # ุตูุญุฉ ุญุณุงุจ ูุงุญุฏ
    โโโ all_banks_qr.html              # ุตูุญุฉ ุฌููุน ุงูุญุณุงุจุงุช

cloudflare-worker/src/
โโโ index.js                           # ูุญุฏุซ ูุฏุนู /bank/<code>
```

---

## ๐ **ุงูุฅุนุฏุงุฏ ูุงูุชุซุจูุช**

### **1. ุชุทุจูู Migration**

```bash
python manage.py migrate accounting
```

### **2. ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ (.env)**

ุฃุถู ุงููุชุบูุฑุงุช ุงูุชุงููุฉ ุฅูู ููู `.env`:

```bash
# Cloudflare Settings
CLOUDFLARE_WORKER_URL=https://qr.elkhawaga.uk
CLOUDFLARE_ACCOUNT_ID=your-account-id
CLOUDFLARE_SYNC_API_KEY=your-api-token
CLOUDFLARE_KV_NAMESPACE_ID=your-namespace-id
CLOUDFLARE_SYNC_ENABLED=True

# Site Settings
SITE_NAME=ุงูุฎูุงุฌุฉ
MAIN_SITE_URL=https://elkhawaga.com
```

### **3. ุฅุนุฏุงุฏ Cloudflare Worker**

#### ุฃ) ูุดุฑ Worker

```bash
cd cloudflare-worker
wrangler deploy
```

#### ุจ) ุฑุจุท KV Namespace

ูู `wrangler.toml`:

```toml
[[kv_namespaces]]
binding = "PRODUCTS_KV"
id = "your-kv-namespace-id"
```

---

## ๐ **ุงุณุชุฎุฏุงู ุงููุธุงู**

### **1. ุฅุถุงูุฉ ุญุณุงุจ ุจููู ุฌุฏูุฏ**

#### ูู Django Admin:

1. ุงุฐูุจ ุฅูู: **Accounting โ Bank Accounts โ Add Bank Account**
2. ุฃุฏุฎู ุงูุจูุงูุงุช:
   - **ุงุณู ุงูุจูู** (ุนุฑุจู/ุฅูุฌููุฒู)
   - **ุฑูู ุงูุญุณุงุจ**
   - **IBAN** (ุงุฎุชูุงุฑู)
   - **SWIFT Code** (ุงุฎุชูุงุฑู)
   - **ุงููุฑุน**
   - **ุงุณู ุตุงุญุจ ุงูุญุณุงุจ**
3. **ุงูููุฏ ุงููุฑูุฏ** ูุชู ุชูููุฏู ุชููุงุฆูุงู (ูุซุงู: `CIB001`, `NBE001`)
4. ุญุฏุฏ **ุญุณุงุจ ุฑุฆูุณู** ุฅุฐุง ูุงู ุงูุญุณุงุจ ุงูุงูุชุฑุงุถู
5. ุงุญูุธ

#### ูุซุงู ุจูุงูุงุช:

```python
ุงูุจูู: ุจูู CIB ุดุฑูุงุช
Bank Name (EN): CIB Corporate
ุฑูู ุงูุญุณุงุจ: 100054913731
IBAN: EG380002000534913731000100001
SWIFT Code: CIBEEGCX
ุงููุฑุน: ูุฑุน ุงูุฌูุฒุฉ
ุตุงุญุจ ุงูุญุณุงุจ: ุงูุฎูุงุฌุฉ
ุงูููุฏ ุงููุฑูุฏ: CIB001  # ูุชู ุชูููุฏู ุชููุงุฆูุงู
```

### **2. ุชูููุฏ QR Codes**

#### ูู Admin (ุฅุฌุฑุงุกุงุช):
1. ุญุฏุฏ ุงูุญุณุงุจุงุช ุงููุทููุจุฉ
2. ุงุฎุชุฑ ุฅุฌุฑุงุก: **"๐ฒ ุชูููุฏ QR Codes"**
3. ุงููุฑ "Go"

#### ูู Terminal:

```bash
# ุชูููุฏ QR ูุฌููุน ุงูุญุณุงุจุงุช
python manage.py generate_bank_qr

# ุชูููุฏ QR ููุญุณุงุจุงุช ุงููุดุทุฉ ููุท
python manage.py generate_bank_qr --active-only

# ุฅุนุงุฏุฉ ุชูููุฏ QR (Force)
python manage.py generate_bank_qr --force

# ุชูููุฏ QR ูุญุณุงุจ ูุญุฏุฏ
python manage.py generate_bank_qr --code CIB001
```

### **3. ูุฒุงููุฉ ูุน Cloudflare**

#### ูู Admin:
1. ุญุฏุฏ ุงูุญุณุงุจุงุช
2. ุงุฎุชุฑ: **"โ๏ธ ูุฒุงููุฉ ูุน Cloudflare"**

#### ูู Terminal:

```bash
# ูุฒุงููุฉ ุฌููุน ุงูุญุณุงุจุงุช
python manage.py sync_bank_accounts

# ูุฒุงููุฉ ุงูุญุณุงุจุงุช ุงููุดุทุฉ ููุท
python manage.py sync_bank_accounts --active-only

# ูุฒุงููุฉ ุญุณุงุจ ูุญุฏุฏ
python manage.py sync_bank_accounts --code CIB001
```

### **4. ุงููุตูู ููุตูุญุงุช**

#### **Cloudflare Worker (ุงูุตูุญุงุช ุงูููุงุฆูุฉ):**

```
# ุตูุญุฉ ุญุณุงุจ ูุงุญุฏ
https://qr.elkhawaga.uk/bank/CIB001
https://qr.elkhawaga.uk/bank/NBE001

# ุตูุญุฉ ุฌููุน ุงูุญุณุงุจุงุช
https://qr.elkhawaga.uk/bank/all
```

#### **Django Local (ููุงุฎุชุจุงุฑ):**

```
# ุตูุญุฉ ุญุณุงุจ ูุงุญุฏ
http://localhost:8000/accounting/bank-qr/CIB001/

# ุตูุญุฉ ุฌููุน ุงูุญุณุงุจุงุช
http://localhost:8000/accounting/bank-qr-all/
```

### **5. ุชุตุฏูุฑ PDF**

#### ูู Admin:
1. ุญุฏุฏ ุงูุญุณุงุจุงุช ุงููุทููุจุฉ
2. ุงุฎุชุฑ: **"๐ ุชุตุฏูุฑ PDF"**
3. ุณูุชู ุชูุฒูู ููู PDF ูุญุชูู ุนูู QR Codes + ุงูุจูุงูุงุช

---

## ๐จ **ุงูุชุตููู ูุงููุงุฌูุฉ**

### **ุตูุญุฉ ุงูุญุณุงุจ ุงููุงุญุฏ** (`/bank/<code>`)

- ุนุฑุถ ุดุนุงุฑ ุงูุดุฑูุฉ
- ุงุณู ุงูุจูู (ุนุฑุจู/ุฅูุฌููุฒู)
- ูุนูููุงุช ุงูุญุณุงุจ:
  - โ ุตุงุญุจ ุงูุญุณุงุจ
  - โ ุฑูู ุงูุญุณุงุจ (ูุน ุฒุฑ ูุณุฎ)
  - โ IBAN (ูุน ุฒุฑ ูุณุฎ)
  - โ SWIFT Code (ูุน ุฒุฑ ูุณุฎ)
  - โ ุงููุฑุน
- ุฒุฑ "ุฒูุงุฑุฉ ุงููููุน"

### **ุตูุญุฉ ุฌููุน ุงูุญุณุงุจุงุช** (`/bank/all`)

- ุนุฑุถ ุฌููุน ุงูุญุณุงุจุงุช ุงููุดุทุฉ
- ูู ุญุณุงุจ ูู ุจุทุงูุฉ ูููุตูุฉ
- ุชูููุฒ ุงูุญุณุงุจ ุงูุฑุฆูุณู ุจู โญ
- ุฃุฒุฑุงุฑ ูุณุฎ ูุฌููุน ุงูุจูุงูุงุช

---

## ๐ง **ุงูุฅุนุฏุงุฏุงุช ุงููุชูุฏูุฉ**

### **Admin Actions**

| ุงูุฅุฌุฑุงุก | ุงููุตู |
|---------|-------|
| ๐ฒ ุชูููุฏ QR Codes | ุชูููุฏ QR ููุญุณุงุจุงุช ุงููุญุฏุฏุฉ |
| โ๏ธ ูุฒุงููุฉ ูุน Cloudflare | ุฑูุน ุงูุจูุงูุงุช ุฅูู KV |
| โญ ุชุญุฏูุฏ ูุญุณุงุจ ุฑุฆูุณู | ุฌุนู ุงูุญุณุงุจ ูู ุงูุงูุชุฑุงุถู |
| โ ุชูุนูู ุงูุญุณุงุจุงุช | ุชูุนูู ุญุณุงุจุงุช ูุญุฏุฏุฉ |
| โ ุฅูุบุงุก ุงูุชูุนูู | ุฅูุบุงุก ุชูุนูู ุญุณุงุจุงุช |
| ๐ ุชุตุฏูุฑ PDF | ุชูุฒูู QR Codes ูู PDF |

### **Admin List Display**

- ุงูููุฏ ุงููุฑูุฏ
- ุงุณู ุงูุจูู (ูุน ุงูุดุนุงุฑ)
- ุฑูู ุงูุญุณุงุจ
- IBAN
- ุงูุนููุฉ
- ุญุงูุฉ ุงูุญุณุงุจ ุงูุฑุฆูุณู
- ุญุงูุฉ ุงููุดุงุท
- ูุนุงููุฉ QR
- ุชุฑุชูุจ ุงูุนุฑุถ

---

## ๐ **ูููุฐุฌ ุงูุจูุงูุงุช (BankAccount Model)**

```python
class BankAccount(models.Model):
    # ูุนูููุงุช ุฃุณุงุณูุฉ
    bank_name = CharField()           # ุงุณู ุงูุจูู
    bank_name_en = CharField()        # Bank Name (EN)
    bank_logo = ImageField()          # ุดุนุงุฑ ุงูุจูู
    
    # ูุนูููุงุช ุงูุญุณุงุจ
    account_number = CharField()      # ุฑูู ุงูุญุณุงุจ
    iban = CharField()                # IBAN
    swift_code = CharField()          # SWIFT Code
    branch = CharField()              # ุงููุฑุน
    account_holder = CharField()      # ุตุงุญุจ ุงูุญุณุงุจ
    currency = CharField()            # ุงูุนููุฉ (EGP, USD, etc.)
    
    # QR System
    qr_code_base64 = TextField()      # QR Code Image (Base64)
    unique_code = CharField()         # ุงูููุฏ ุงููุฑูุฏ (CIB001)
    
    # Settings
    is_active = BooleanField()        # ูุดุท
    is_primary = BooleanField()       # ุญุณุงุจ ุฑุฆูุณู
    display_order = IntegerField()    # ุชุฑุชูุจ ุงูุนุฑุถ
    show_in_qr = BooleanField()       # ุนุฑุถ ูู /bank/all
    
    # Cloudflare
    cloudflare_synced = BooleanField()
    last_synced_at = DateTimeField()
```

---

## ๐ **API & Integration**

### **Cloudflare Worker Routes**

```javascript
GET /bank/<code>     โ ุตูุญุฉ ุญุณุงุจ ูุงุญุฏ
GET /bank/all        โ ุตูุญุฉ ุฌููุน ุงูุญุณุงุจุงุช
```

### **Django URLs**

```python
/accounting/bank-qr/<code>/      โ ุนุฑุถ ูุญูู ููุญุณุงุจ
/accounting/bank-qr-all/         โ ุนุฑุถ ูุญูู ูุฌููุน ุงูุญุณุงุจุงุช
/accounting/bank-qr-pdf/         โ ุชุตุฏูุฑ PDF
```

### **KV Storage Structure**

```javascript
// ุญุณุงุจ ูุงุญุฏ
Key: "bank:CIB001"
Value: {
  code: "CIB001",
  bank_name: "ุจูู CIB ุดุฑูุงุช",
  account_number: "100054913731",
  iban: "EG380002...",
  // ... ุจุงูู ุงูุจูุงูุงุช
}

// ุฌููุน ุงูุญุณุงุจุงุช
Key: "bank:all"
Value: {
  type: "all_accounts",
  accounts: [...],
  count: 3,
  last_updated: "2025-12-23T..."
}
```

---

## ๐ฏ **ุฃูุซูุฉ ุงุณุชุฎุฏุงู**

### **ูุซุงู 1: ุฅุถุงูุฉ ุจูู CIB**

```python
from accounting.models import BankAccount

bank = BankAccount.objects.create(
    bank_name="ุจูู CIB ุดุฑูุงุช",
    bank_name_en="CIB Corporate",
    account_number="100054913731",
    iban="EG380002000534913731000100001",
    swift_code="CIBEEGCX",
    branch="ูุฑุน ุงูุฌูุฒุฉ",
    account_holder="ุงูุฎูุงุฌุฉ",
    account_holder_en="Elkhawaga",
    currency="EGP",
    is_primary=True,
    is_active=True,
)

# ุชูููุฏ QR
bank.generate_qr_code()
```

### **ูุซุงู 2: ุงูุจุญุซ ูุงูููุชุฑุฉ**

```python
# ุฌููุน ุงูุญุณุงุจุงุช ุงููุดุทุฉ
active_banks = BankAccount.get_active_accounts()

# ุงูุญุณุงุจ ุงูุฑุฆูุณู
primary = BankAccount.get_primary_account()

# ุญุณุงุจ ูุญุฏุฏ
cib = BankAccount.objects.get(unique_code='CIB001')
```

---

## ๐ **ุงุณุชูุดุงู ุงูุฃุฎุทุงุก**

### **ุงููุดููุฉ: QR ูุง ูุชู ุชูููุฏู**

**ุงูุญู:**
```bash
python manage.py generate_bank_qr --force
```

### **ุงููุดููุฉ: Cloudflare ูุง ูุนุฑุถ ุงูุจูุงูุงุช**

**ุงูุญู:**
1. ุชุญูู ูู ุฅุนุฏุงุฏุงุช `.env`
2. ุฃุนุฏ ุงููุฒุงููุฉ:
   ```bash
   python manage.py sync_bank_accounts
   ```

### **ุงููุดููุฉ: ุฑุงุจุท QR ูุง ูุนูู**

**ุงูุญู:**
- ุชุฃูุฏ ูู ูุดุฑ Worker:
  ```bash
  cd cloudflare-worker
  wrangler deploy
  ```

---

## ๐ **ููุงุญุธุงุช ูููุฉ**

1. โ **ุงูุฃูุงู:** ูุง ูุชู ุนุฑุถ ูุนูููุงุช ุญุณุงุณุฉ ุนุจุฑ QR (ููุท ุงูุจูุงูุงุช ุงูุนุงูุฉ)
2. โ **ุงูุฃุฏุงุก:** ุงูุตูุญุงุช ุซุงุจุชุฉ ุนูู Cloudflare = ุณุฑุนุฉ ุนุงููุฉ
3. โ **ุงูุชูุงูู:** ูุนูู ุจุฏูู ุงุชุตุงู ุจุงูุฅูุชุฑูุช ุจุนุฏ ุงูุชุญููู ุงูุฃูู
4. โ **ุงููุฑููุฉ:** ูููู ุฅุถุงูุฉ ุญุณุงุจุงุช ุบูุฑ ูุญุฏูุฏุฉ

---

## ๐ **ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ**

- [ ] ุฏุนู ุดุนุงุฑุงุช ุงูุจููู (ุชุญููู ุงูุตูุฑ)
- [ ] ุฅุญุตุงุฆูุงุช ุนุฏุฏ ูุฑุงุช ูุญุต QR
- [ ] ุฅุดุนุงุฑุงุช ุนูุฏ ุฅุถุงูุฉ ุญุณุงุจ ุฌุฏูุฏ
- [ ] ุฏุนู ุนููุงุช ูุชุนุฏุฏุฉ
- [ ] API ููุชูุงูู ูุน ุชุทุจููุงุช ุฎุงุฑุฌูุฉ

---

## ๐ **ุงูุฏุนู**

ูููุณุงุนุฏุฉ ุฃู ุงูุงุณุชูุณุงุฑุงุช:
- ๐ง Email: developer@elkhawaga.com
- ๐ฑ ุงูุฏุนู ุงูููู: ุฏุงุฎูู

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 23 ุฏูุณูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงููุทูุฑ:** Zakee @ Elkhawaga
