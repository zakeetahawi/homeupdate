# ๐ ููุฒุฉ ุชุงุฑูุฎ ุงูุฎุฑูุฌ ูุนูุงุตุฑ ุงูุชูุทูุน

## ๐ ุงููุตู

ุชู ุฅุถุงูุฉ ููุฒุฉ ุชุงุฑูุฎ ุงูุฎุฑูุฌ ูุนูุงุตุฑ ุฃูุงูุฑ ุงูุชูุทูุน ูุน ุฅููุงููุฉ ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู ูุชูุซูู ุงูุณุจุจ.

---

## โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### **1. ุชุงุฑูุฎ ุงูุฎุฑูุฌ (Exit Date)**
- โ ุญูู ุฌุฏูุฏ: `exit_date` - ุชุงุฑูุฎ ุงูุฎุฑูุฌ ุงููุนูู ููุนูุตุฑ
- โ ุงูุชุฑุงุถูุงู: ุชุงุฑูุฎ ุงูููู
- โ ูููู ุงุฎุชูุงุฑ ุฃู ุชุงุฑูุฎ ุณุงุจู
- โ ูุง ูููู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ูุณุชูุจูู

### **2. ุณุจุจ ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู (Backdate Reason)**
- โ ุญูู ุฌุฏูุฏ: `backdate_reason` - ุณุจุจ ุงูุชุฃุฎูุฑ ูู ุงูุชุณุฌูู
- โ **ุฅูุฒุงูู** ุนูุฏ ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุณุงุจู
- โ ููุญูุธ ูู ุณุฌู ุงูุทูุจ
- โ ููุถุงู ุชููุงุฆูุงู ููููุงุญุธุงุช

### **3. ุงูุชุญูู ุงูุชููุงุฆู**
- โ ุงูุชุญูู ูู ุนุฏู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ูุณุชูุจูู
- โ ุงูุชุฃูุฏ ูู ุฅุฏุฎุงู ุงูุณุจุจ ุนูุฏ ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุณุงุจู
- โ ุนุฑุถ ุชูุจูู ุชููุงุฆู ุนูุฏ ุชุบููุฑ ุงูุชุงุฑูุฎ

---

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### **ุงูุญููู ุงูุฌุฏูุฏุฉ ูู `CuttingOrderItem`:**

```python
exit_date = models.DateField(
    null=True,
    blank=True,
    verbose_name='ุชุงุฑูุฎ ุงูุฎุฑูุฌ'
)

backdate_reason = models.TextField(
    blank=True,
    verbose_name='ุณุจุจ ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู'
)
```

### **โ๏ธ ุชุบููุฑ ููู: ุชุงุฑูุฎ ุงูุชูุทูุน**
- **`cutting_date`** ุงูุขู = ุงูุชุงุฑูุฎ ุงูููุฏุฎู ูุฏููุงู (exit_date)
- **`delivery_date`** ุงูุขู = ููุณ cutting_date
- **ุชุงุฑูุฎ ุงููุนุงููุฉ ุงููุนููุฉ** = ููุณุฌู ูู ุงูููุงุญุธุงุช ููุท

### **Migration:**
```bash
cutting/migrations/0008_cuttingorderitem_backdate_reason_and_more.py
    + Add field backdate_reason to cuttingorderitem
    + Add field exit_date to cuttingorderitem
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### **ูููุฐุฌ ุงูุฅููุงู ุงููุญุณูู:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        ุฅููุงู ุงูุนูุตุฑ                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุงุณู ุงููุตุงุต *                         โ
โ [____________]                      โ
โ                                     โ
โ ุฑูู ุงูุฅุฐู *                          โ
โ [____________]                      โ
โ                                     โ
โ ุงุณู ุงููุณุชูู *                        โ
โ [____________]                      โ
โ                                     โ
โ ุชุงุฑูุฎ ุงูุฎุฑูุฌ *                       โ
โ [2025-11-08  โผ]                    โ
โ โน๏ธ ุงูุชุฑุงุถูุงู: ุงูููู. ูููู ุงุฎุชูุงุฑ   โ
โ   ุชุงุฑูุฎ ุณุงุจู ูุน ุฅุฏุฎุงู ุงูุณุจุจ.        โ
โ                                     โ
โ โ๏ธ ุณุจุจ ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู * (ูุธูุฑ) โ
โ [________________________]          โ
โ [________________________]          โ
โ โ๏ธ ูุฌุจ ุฅุฏุฎุงู ุณุจุจ ูุงุถุญ ููุชุณุฌูู     โ
โ    ุจุชุงุฑูุฎ ุณุงุจู (ูุญูุธ ูู ุณุฌู ุงูุทูุจ)  โ
โ                                     โ
โ ููุงุญุธุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)            โ
โ [________________________]          โ
โ [________________________]          โ
โ                                     โ
โ    [โ ุฅููุงู]    [โ ุฅูุบุงุก]         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง ุงูุชุบููุฑุงุช ูู ุงูููุฏ

### **1. Models (`cutting/models.py`)**

```python
def mark_as_completed(self, cutter_name, permit_number, receiver_name, user, notes='', 
                     exit_date=None, backdate_reason='', auto_deduct_inventory=True):
    """ุชุนููู ุงูุนูุตุฑ ูููุชูู ูุน ุฎุตู ุงููุฎุฒูู ุงูุชููุงุฆู"""
    from datetime import date, datetime
    
    self.status = 'completed'
    self.cutter_name = cutter_name
    self.permit_number = permit_number
    self.receiver_name = receiver_name
    self.notes = notes
    self.updated_by = user
    
    # ุชุญุฏูุฏ ุชุงุฑูุฎ ุงูุฎุฑูุฌ ูุชุงุฑูุฎ ุงูุชูุทูุน
    actual_exit_date = exit_date if exit_date else date.today()
    self.exit_date = actual_exit_date
    
    # โญ ุชุงุฑูุฎ ุงูุชูุทูุน ูู ุงูุชุงุฑูุฎ ุงููุฏุฎู ูุฏููุงู
    self.cutting_date = datetime.combine(actual_exit_date, datetime.now().time())
    self.delivery_date = self.cutting_date
    
    # ุชุณุฌูู ุชุงุฑูุฎ ุงููุนุงููุฉ ุงููุนููุฉ ูู ุงูููุงุญุธุงุช
    transaction_datetime = timezone.now()
    today = date.today()
    
    # ุฅุถุงูุฉ ูุนูููุงุช ุงููุนุงููุฉ ููููุงุญุธุงุช
    transaction_note = f'[ุชุงุฑูุฎ ุงููุนุงููุฉ: {transaction_datetime.strftime("%Y-%m-%d %H:%M")}]'
    
    if actual_exit_date < today:
        # ุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู
        self.backdate_reason = backdate_reason or f'ุชู ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู ({actual_exit_date})'
        backdate_note = f'[ุชุงุฑูุฎ ุงูุชูุทูุน: {actual_exit_date}] {backdate_reason}'
        
        if self.notes:
            self.notes += f'\n{transaction_note}\n{backdate_note}'
        else:
            self.notes = f'{transaction_note}\n{backdate_note}'
    elif actual_exit_date == today:
        # ุชุณุฌูู ุจุชุงุฑูุฎ ุงูููู
        if self.notes:
            self.notes += f'\n{transaction_note}'
        else:
            self.notes = transaction_note
    
    self.save()
```

### **2. Views (`cutting/views.py`)**

#### **ุฅููุงู ุนูุตุฑ ูุงุญุฏ:**
```python
@login_required
def complete_cutting_item(request, pk):
    from datetime import datetime, date
    item = get_object_or_404(CuttingOrderItem, pk=pk)
    
    if request.method == 'POST':
        data = json.loads(request.body)
        
        cutter_name = data.get('cutter_name')
        permit_number = data.get('permit_number')
        receiver_name = data.get('receiver_name')
        notes = data.get('notes', '')
        exit_date_str = data.get('exit_date')  # ุฌุฏูุฏ
        backdate_reason = data.get('backdate_reason', '')  # ุฌุฏูุฏ
        
        # ูุนุงูุฌุฉ ุชุงุฑูุฎ ุงูุฎุฑูุฌ
        exit_date = None
        if exit_date_str:
            exit_date = datetime.strptime(exit_date_str, '%Y-%m-%d').date()
            
            # ุงูุชุญูู ูู ุฃู ุงูุชุงุฑูุฎ ููุณ ูู ุงููุณุชูุจู
            if exit_date > date.today():
                return JsonResponse({
                    'success': False,
                    'message': 'ูุง ูููู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ูู ุงููุณุชูุจู'
                })
            
            # ุฅุฐุง ูุงู ุงูุชุงุฑูุฎ ุณุงุจูุ ูุฌุจ ุฅุฏุฎุงู ุงูุณุจุจ
            if exit_date < date.today() and not backdate_reason:
                return JsonResponse({
                    'success': False,
                    'message': 'ูุฌุจ ุฅุฏุฎุงู ุณุจุจ ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู'
                })
        
        item.mark_as_completed(
            cutter_name=cutter_name,
            permit_number=permit_number,
            receiver_name=receiver_name,
            user=request.user,
            notes=notes,
            exit_date=exit_date,  # ุฌุฏูุฏ
            backdate_reason=backdate_reason  # ุฌุฏูุฏ
        )
```

#### **ุฅููุงู ูุฌูุน:**
ููุณ ุงูุชุนุฏููุงุช ุชุทุจู ุนูู `bulk_complete_items`

---

## ๐ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### **ุงูุญุงูุฉ 1: ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุงูููู (ุงูุชุฑุงุถู)**
```
1. ุงููุณุชุฎุฏู ููุชุญ ูููุฐุฌ ุงูุฅููุงู
2. ุงูุชุงุฑูุฎ ูููู ุชููุงุฆูุงู: ุงูููู
3. ูููุฃ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
4. ูุถุบุท "ุฅููุงู"
โ ูุชู ุญูุธ exit_date = ุชุงุฑูุฎ ุงูููู
โ ูุง ูุธูุฑ ุญูู ุงูุณุจุจ
```

### **ุงูุญุงูุฉ 2: ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู**
```
1. ุงููุณุชุฎุฏู ููุชุญ ูููุฐุฌ ุงูุฅููุงู
2. ูุบูุฑ ุงูุชุงุฑูุฎ ูุชุงุฑูุฎ ุฃูุณ (ูุซูุงู)
3. โ๏ธ ูุธูุฑ ุญูู "ุณุจุจ ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู" ุชููุงุฆูุงู
4. ูุฌุจ ุฅุฏุฎุงู ุงูุณุจุจ (ูุซุงู: "ุชู ุงูุชูุทูุน ุฃูุณ ูููู ูู ูุชู ุงูุชุณุฌูู ุจุณุจุจ...")
5. ูุถุบุท "ุฅููุงู"
โ ูุชู ุญูุธ exit_date = ุงูุชุงุฑูุฎ ุงููุฎุชุงุฑ
โ ูุชู ุญูุธ backdate_reason
โ ููุถุงู ุงูุณุจุจ ุชููุงุฆูุงู ููููุงุญุธุงุช
```

### **ุงูุญุงูุฉ 3: ูุญุงููุฉ ุงูุชุณุฌูู ุจุชุงุฑูุฎ ูุณุชูุจูู**
```
1. ุงููุณุชุฎุฏู ูุญุงูู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุบุฏุงู
2. โ ุฑุณุงูุฉ ุฎุทุฃ: "ูุง ูููู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ูู ุงููุณุชูุจู"
```

### **ุงูุญุงูุฉ 4: ุชุงุฑูุฎ ุณุงุจู ุจุฏูู ุณุจุจ**
```
1. ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุชุงุฑูุฎ ุณุงุจู
2. ูุง ูุฏุฎู ุงูุณุจุจ
3. ูุญุงูู ุงูุถุบุท ุนูู "ุฅููุงู"
4. โ ุฑุณุงูุฉ ุฎุทุฃ: "ูุฌุจ ุฅุฏุฎุงู ุณุจุจ ูุงุถุญ ููุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู"
```

---

## ๐ฏ ุงูููุงุฆุฏ

### **1. ุงูุชูุซูู ุงูุฏููู:**
- โ ุชุณุฌูู ุชุงุฑูุฎ ุงูุฎุฑูุฌ ุงููุนูู (ููุณ ููุท ููุช ุงูุชุณุฌูู)
- โ ุชูุซูู ุฃุณุจุงุจ ุงูุชุฃุฎูุฑ ูู ุงูุชุณุฌูู
- โ ุดูุงููุฉ ูุงููุฉ ูู ุงูุณุฌูุงุช

### **2. ุงููุฑููุฉ:**
- โ ุฅููุงููุฉ ุชุณุฌูู ุนูููุงุช ุชูุช ูู ุฃูุงู ุณุงุจูุฉ
- โ ุชุตุญูุญ ุงูุฃุฎุทุงุก ุฏูู ููุฏุงู ุงูุฏูุฉ

### **3. ุงูุฑูุงุจุฉ:**
- โ ูู ุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู ูุญุชุงุฌ ุณุจุจ
- โ ุงูุณุจุจ ููุญูุธ ูู ุณุฌู ุงูุทูุจ ููุง ูููู ุญุฐูู
- โ ุณูููุฉ ุงูุชุฏููู ูุงููุฑุงุฌุนุฉ

### **4. ุณูููุฉ ุงูุงุณุชุฎุฏุงู:**
- โ ุงูุชุงุฑูุฎ ุงูุงูุชุฑุงุถู ูู ุงูููู
- โ ุชูุจููุงุช ุชููุงุฆูุฉ ุนูุฏ ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุณุงุจู
- โ ูุงุฌูุฉ ุจุณูุทุฉ ููุงุถุญุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

### **ุชุณุฌูู ุงูุณุจุจ:**
- ุงูุณุจุจ ููุญูุธ ูู ุญูููู:
  1. `backdate_reason` - ุญูู ูุฎุตุต
  2. `notes` - ููุถุงู ุชููุงุฆูุงู ูููุงุญุธุฉ ูุน ุงูุชุงุฑูุฎ

### **ูุซุงู ุนูู ุงูููุงุญุธุงุช ุงููุญููุธุฉ:**

**ูุซุงู 1: ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุงูููู (2025-11-08)**
```
ุงูููุงุญุธุงุช ุงูุฃุตููุฉ: "ุชู ุงูุชูุทูุน ุจูุฌุงุญ"

ุจุนุฏ ุงูุฅููุงู:
"ุชู ุงูุชูุทูุน ุจูุฌุงุญ
[ุชุงุฑูุฎ ุงููุนุงููุฉ: 2025-11-08 15:30]"

cutting_date = 2025-11-08 15:30:00
exit_date = 2025-11-08
```

**ูุซุงู 2: ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู (2025-11-07)**
```
ุงูููุงุญุธุงุช ุงูุฃุตููุฉ: "ุชู ุงูุชูุทูุน ุจูุฌุงุญ"

ุจุนุฏ ุงูุฅููุงู:
"ุชู ุงูุชูุทูุน ุจูุฌุงุญ
[ุชุงุฑูุฎ ุงููุนุงููุฉ: 2025-11-08 15:30]
[ุชุงุฑูุฎ ุงูุชูุทูุน: 2025-11-07] ุชู ุงูุชูุทูุน ุฃูุณ ูููู ูู ูุชู ุงูุชุณุฌูู ุจุณุจุจ ุงููุทุงุน ุงููุช"

cutting_date = 2025-11-07 15:30:00  โ ุงูุชุงุฑูุฎ ุงููุฏุฎู ูุฏููุงู
exit_date = 2025-11-07
backdate_reason = "ุชู ุงูุชูุทูุน ุฃูุณ ูููู ูู ูุชู ุงูุชุณุฌูู ุจุณุจุจ ุงููุทุงุน ุงููุช"
```

### **๐ ุงููุฑู ุงูููู:**
- **`cutting_date`** = ุงูุชุงุฑูุฎ ุงูููุฏุฎู ูุฏููุงู (ููุณ ุชุงุฑูุฎ ุงููุนุงููุฉ)
- **`exit_date`** = ููุณ ุงูุชุงุฑูุฎ ุงูููุฏุฎู ูุฏููุงู
- **ุชุงุฑูุฎ ุงููุนุงููุฉ ุงููุนููุฉ** = ููุณุฌู ูู ุงูููุงุญุธุงุช ููุท
- **ุงููุงุฆุฏุฉ**: ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช ุณุชุนุชูุฏ ุนูู ุงูุชุงุฑูุฎ ุงูุญูููู ููุชูุทูุนุ ูููุณ ูุชู ุชู ุงูุชุณุฌูู

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### **ุงุฎุชุจุงุฑ ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุงูููู:**
```bash
1. ุงูุชุญ ุฃูุฑ ุชูุทูุน
2. ุงุถุบุท "ุฅููุงู" ุนูู ุนูุตุฑ
3. ุงููุฃ ุงูุจูุงูุงุช (ูุง ุชุบูุฑ ุงูุชุงุฑูุฎ)
4. โ ุชุฃูุฏ ูู ุญูุธ exit_date = ุงูููู
```

### **ุงุฎุชุจุงุฑ ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู:**
```bash
1. ุงูุชุญ ุฃูุฑ ุชูุทูุน
2. ุงุถุบุท "ุฅููุงู" ุนูู ุนูุตุฑ
3. ุบูุฑ ุงูุชุงุฑูุฎ ูููู ุฃูุณ
4. โ ุชุฃูุฏ ูู ุธููุฑ ุญูู ุงูุณุจุจ
5. ุงุชุฑู ุงูุณุจุจ ูุงุฑุบุงู ูุงุถุบุท "ุฅููุงู"
6. โ ุชุฃูุฏ ูู ุธููุฑ ุฑุณุงูุฉ ุฎุทุฃ
7. ุงูุชุจ ุงูุณุจุจ ูุงุถุบุท "ุฅููุงู"
8. โ ุชุฃูุฏ ูู ุงูุญูุธ ุจูุฌุงุญ
9. ุงูุชุญ ุชูุงุตูู ุงูุนูุตุฑ
10. โ ุชุฃูุฏ ูู ุธููุฑ ุงูุณุจุจ ูู ุงูููุงุญุธุงุช
```

### **ุงุฎุชุจุงุฑ ุงูุชุงุฑูุฎ ุงููุณุชูุจูู:**
```bash
1. ุญุงูู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุบุฏุงู
2. โ ุชุฃูุฏ ูู ุนุฏู ุฅููุงููุฉ ุงูุงุฎุชูุงุฑ (HTML max attribute)
```

---

## ๐ ุงูุชูุงูู ูุน ุงูููุฒุงุช ุงูุฃุฎุฑู

### **ุฎุตู ุงููุฎุฒูู:**
- โ ูุชู ุฎุตู ุงููุฎุฒูู ุจูุงุกู ุนูู ุชุงุฑูุฎ ุงูููู (cutting_date)
- โ exit_date ููุณุชุฎุฏู ููุท ููุชูุซูู

### **ุงูุชูุงุฑูุฑ:**
- ๐ก ูููู ูุงุญูุงู ุฅุถุงูุฉ ุชูุงุฑูุฑ ุจูุงุกู ุนูู exit_date
- ๐ก ุชุญููู ุฃุณุจุงุจ ุงูุชุฃุฎูุฑ ุงูุดุงุฆุนุฉ

---

## โ ุงูุฎูุงุตุฉ

ุชู ุฅุถุงูุฉ ููุฒุฉ ูุงููุฉ ูุชุณุฌูู ุชุงุฑูุฎ ุงูุฎุฑูุฌ ูุน:
- โ ุญูููู ุฌุฏูุฏูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุชุนุฏูู Models ู Views
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ูุญุณููุฉ
- โ ุงูุชุญูู ุงูุชููุงุฆู ูู ุงูุจูุงูุงุช
- โ ุชูุซูู ูุงูู ูู ุงูุณุฌูุงุช
- โ ุณูููุฉ ูู ุงูุงุณุชุฎุฏุงู

**ุงููุธุงู ุงูุขู ูุฏุนู ุงูุชุณุฌูู ุจุชุงุฑูุฎ ุณุงุจู ูุน ุชูุซูู ุงูุณุจุจ ุจุดูู ูุงูู!** ๐
