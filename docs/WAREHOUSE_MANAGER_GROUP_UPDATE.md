# ๐ฅ ููุฒุฉ ุฏุนู ูุฌููุนุฉ ูุณุคูู ุงููุฎุฒูู

## ๐ ุงููุตู

ุชู ุชุญุฏูุซ ุงููุธุงู ูุฏุนู **ูุฌููุนุฉ ูุณุคูู ุงููุฎุฒูู** ูู ุฅุธูุงุฑ ุฒุฑ ุงูุชุญูููุงุช ุงููุฎุฒููุฉ ูู ุงูููุฏุฑ.

---

## โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### **1. ุฏุนู ูุฌููุนุงุช ุงููุณุชุฎุฏููู**
ุงูุขู ูููู ุฅุธูุงุฑ ุฒุฑ ุงูุชุญูููุงุช ุงููุฎุฒููุฉ ูู:
- โ ูุฏูุฑู ุงููุธุงู (Superusers)
- โ ูุฏูุฑู ุงููุณุชูุฏุนุงุช (ูุฏููู ูุณุชูุฏุนุงุช ูุญุฏุฏุฉ)
- โ **ุฃุนุถุงุก ูุฌููุนุฉ "ูุณุคูู ุงููุฎุฒูู"** โ ุฌุฏูุฏ!

### **2. ุฃุณูุงุก ุงููุฌููุนุงุช ุงููุฏุนููุฉ**
ูุฏุนู ุงููุธุงู ุงูุขู ุฃุณูุงุก ูุชุนุฏุฏุฉ ูููุฌููุนุฉ:
- `ูุณุคูู ูุฎุฒูู`
- `ูุณุคูู ูุฎุงุฒู`
- `Warehouse Manager`
- `ูุณุคูู ูุณุชูุฏุน`

### **3. ูุณุชููุงุช ุงูุตูุงุญูุงุช**

#### **ูุฏูุฑ ุงููุธุงู (Superuser):**
- โ ูุฑู ุฌููุน ุงูุชุญูููุงุช ุงููุนููุฉ
- โ ููููู ุงูููุงููุฉ ุนูู ุฌููุน ุงูุชุญูููุงุช

#### **ูุฏูุฑ ูุณุชูุฏุน (ูู ูุณุชูุฏุนุงุช ูุญุฏุฏุฉ):**
- โ ูุฑู ููุท ุงูุชุญูููุงุช ุงููุงุฑุฏุฉ ููุณุชูุฏุนุงุชู
- โ ููููู ุงุณุชูุงู ุงูุชุญูููุงุช ููุณุชูุฏุนุงุชู

#### **ูุณุคูู ูุฎุฒูู (ุนุถู ูู ุงููุฌููุนุฉ ุจุฏูู ูุณุชูุฏุนุงุช ูุญุฏุฏุฉ):**
- โ ูุฑู ุฌููุน ุงูุชุญูููุงุช ุงููุนููุฉ
- โ ููููู ุงูุชุนุงูู ูุน ุฌููุน ุงูุชุญูููุงุช

---

## ๐ง ุงูุชุนุฏููุงุช ูู ุงูููุฏ

### **ูู `inventory/context_processors.py`:**

#### **ูุจู ุงูุชุนุฏูู:**
```python
# ุงูุชุญูู ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุคูู ูุฎุฒู
is_warehouse_manager = False
if not user.is_superuser:
    is_warehouse_manager = Warehouse.objects.filter(manager=user).exists()

return {
    'is_warehouse_manager': is_warehouse_manager or user.is_superuser
}
```

#### **ุจุนุฏ ุงูุชุนุฏูู:**
```python
# ุงูุชุญูู ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุคูู ูุฎุฒู
is_warehouse_manager = False
if not user.is_superuser:
    # ุงูุชุญูู ูู ูููู ูุฏูุฑ ูุณุชูุฏุน ุฃู ุนุถู ูู ูุฌููุนุฉ ูุณุคูู ูุฎุฒูู
    is_warehouse_manager = (
        Warehouse.objects.filter(manager=user).exists() or
        user.groups.filter(name__in=[
            'ูุณุคูู ูุฎุฒูู', 
            'ูุณุคูู ูุฎุงุฒู', 
            'Warehouse Manager', 
            'ูุณุคูู ูุณุชูุฏุน'
        ]).exists()
    )

return {
    'is_warehouse_manager': is_warehouse_manager or user.is_superuser
}
```

### **ููุทู ุนุฑุถ ุงูุชุญูููุงุช:**

```python
else:
    # ูุณุคูู ุงููุฎุฒูู ูุฑู ุงูุชุญูููุงุช ุญุณุจ ุตูุงุญูุงุชู
    managed_warehouses = Warehouse.objects.filter(manager=user)
    
    # ุงูุชุญูู ูู ูุฌููุนุฉ ูุณุคูู ูุฎุฒูู
    is_in_warehouse_group = user.groups.filter(
        name__in=['ูุณุคูู ูุฎุฒูู', 'ูุณุคูู ูุฎุงุฒู', 'Warehouse Manager', 'ูุณุคูู ูุณุชูุฏุน']
    ).exists()
    
    if managed_warehouses.exists():
        # ูุฏูู ูุณุชูุฏุนุงุช ูุญุฏุฏุฉ - ูุฑู ุงูุชุญูููุงุช ุงููุงุฑุฏุฉ ููุง
        pending_transfers = StockTransfer.objects.filter(
            to_warehouse__in=managed_warehouses,
            status__in=['approved', 'in_transit']
        )
        
    elif is_in_warehouse_group:
        # ูู ูุฌููุนุฉ ูุณุคูู ูุฎุฒูู ุจุฏูู ูุณุชูุฏุนุงุช ูุญุฏุฏุฉ - ูุฑู ุฌููุน ุงูุชุญูููุงุช
        pending_transfers = StockTransfer.objects.filter(
            status__in=['approved', 'in_transit']
        )
        
    else:
        # ููุณ ูุฏูู ุตูุงุญูุงุช
        pending_transfers = StockTransfer.objects.none()
```

---

## ๐ฏ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### **ุณููุงุฑูู 1: ูุฏูุฑ ุงููุธุงู**
```
ุงููุณุชุฎุฏู: admin
ุงูุตูุงุญูุฉ: is_superuser = True

ุงููุชูุฌุฉ:
  โ ูุฑู ุฒุฑ ุงูุชุญูููุงุช ูู ุงูููุฏุฑ
  โ ูุฑู ุฌููุน ุงูุชุญูููุงุช (ุฌููุน ุงููุณุชูุฏุนุงุช)
  โ ููููู ุงูููุงููุฉ ุนูู ุฌููุน ุงูุชุญูููุงุช
```

### **ุณููุงุฑูู 2: ูุฏูุฑ ูุณุชูุฏุน ูุญุฏุฏ**
```
ุงููุณุชุฎุฏู: ุงุญูุฏ
ุงูุตูุงุญูุฉ: ูุฏูุฑ ููุณุชูุฏุน "ุงูุฑูุงุถ"

ุงููุชูุฌุฉ:
  โ ูุฑู ุฒุฑ ุงูุชุญูููุงุช ูู ุงูููุฏุฑ
  โ ูุฑู ููุท ุงูุชุญูููุงุช ุงููุงุฑุฏุฉ ููุณุชูุฏุน "ุงูุฑูุงุถ"
  โ ููููู ุงุณุชูุงู ุงูุชุญูููุงุช ููุณุชูุฏุนู ููุท
```

### **ุณููุงุฑูู 3: ุนุถู ูู ูุฌููุนุฉ "ูุณุคูู ูุฎุฒูู" (ุฌุฏูุฏ!)**
```
ุงููุณุชุฎุฏู: ูุญูุฏ
ุงูุตูุงุญูุฉ: ุนุถู ูู ูุฌููุนุฉ "ูุณุคูู ูุฎุฒูู"
ุงููุณุชูุฏุนุงุช ุงููุญุฏุฏุฉ: ูุง ููุฌุฏ

ุงููุชูุฌุฉ:
  โ ูุฑู ุฒุฑ ุงูุชุญูููุงุช ูู ุงูููุฏุฑ
  โ ูุฑู ุฌููุน ุงูุชุญูููุงุช (ุฌููุน ุงููุณุชูุฏุนุงุช)
  โ ููููู ุงูุชุนุงูู ูุน ุฌููุน ุงูุชุญูููุงุช
```

### **ุณููุงุฑูู 4: ูุณุชุฎุฏู ุนุงุฏู**
```
ุงููุณุชุฎุฏู: ุฎุงูุฏ
ุงูุตูุงุญูุฉ: ูุณุชุฎุฏู ุนุงุฏู (ุจุฏูู ูุฌููุนุงุช ุฎุงุตุฉ)

ุงููุชูุฌุฉ:
  โ ูุง ูุฑู ุฒุฑ ุงูุชุญูููุงุช
  โ ูุง ููููู ุงููุตูู ูุตูุญุฉ ุงูุชุญูููุงุช
```

---

## ๐ ุฌุฏูู ุงูุตูุงุญูุงุช

| ุงูููุน | ุฒุฑ ุงูุชุญูููุงุช | ุงูุชุญูููุงุช ุงููุฑุฆูุฉ | ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ |
|------|-------------|-------------------|------------------|
| **Superuser** | โ ูุนู | ุฌููุน ุงูุชุญูููุงุช | ุฌููุน ุงูุฅุฌุฑุงุกุงุช |
| **ูุฏูุฑ ูุณุชูุฏุน** | โ ูุนู | ุงูุชุญูููุงุช ุงููุงุฑุฏุฉ ููุณุชูุฏุนุงุชู | ุงุณุชูุงู ููุณุชูุฏุนุงุชู |
| **ูุณุคูู ูุฎุฒูู (ูุฌููุนุฉ)** | โ ูุนู | ุฌููุน ุงูุชุญูููุงุช | ุฌููุน ุงูุฅุฌุฑุงุกุงุช |
| **ูุณุชุฎุฏู ุนุงุฏู** | โ ูุง | ูุง ุดูุก | ูุง ุดูุก |

---

## ๐จ ุงููุงุฌูุฉ

### **ุงูููุฏุฑ (Header):**

```html
<!-- ุฒุฑ ุงูุชุญูููุงุช - ูุธูุฑ ูููุตุฑุญ ููู ููุท -->
{% if is_warehouse_manager %}
<a href="{% url 'inventory:stock_transfer_list' %}" 
   class="btn {% if has_pending_transfers %}btn-warning{% else %}btn-outline-secondary{% endif %} position-relative me-2">
    <i class="fas fa-truck"></i> ุงูุชุญูููุงุช
    {% if has_pending_transfers %}
    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        {{ pending_transfers_count }}
        <span class="visually-hidden">ุชุญูููุงุช ูุนููุฉ</span>
    </span>
    {% endif %}
</a>
{% endif %}
```

### **ุธููุฑ ุงูุฒุฑ:**
- โ **ุฃุตูุฑ** ุฅุฐุง ูุงู ููุงู ุชุญูููุงุช ูุนููุฉ
- โ **ุฑูุงุฏู** ุฅุฐุง ูู ููู ููุงู ุชุญูููุงุช ูุนููุฉ
- โ **ุฑูู ุฃุญูุฑ** ููุถุญ ุนุฏุฏ ุงูุชุญูููุงุช ุงููุนููุฉ

---

## ๐ ุงูุฃูุงู

### **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:**
1. โ ุงูุชุญูู ุนูู ูุณุชูู Context Processor
2. โ ุงูุชุญูู ุนูู ูุณุชูู Views
3. โ ุงูุชุญูู ุนูู ูุณุชูู Templates

### **ุงูุญูุงูุฉ:**
- โ ูุง ูููู ูููุณุชุฎุฏู ุงูุนุงุฏู ุฑุคูุฉ ุงูุฒุฑ
- โ ูุง ูููู ุงููุตูู ููุตูุญุฉ ุจุฏูู ุตูุงุญูุงุช
- โ ุงูุชุญูููุงุช ูููุชุฑุฉ ุญุณุจ ุงูุตูุงุญูุงุช

---

## ๐ ููููุฉ ุฅุถุงูุฉ ูุณุชุฎุฏู ููุฌููุนุฉ "ูุณุคูู ูุฎุฒูู"

### **ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ (Admin Panel):**

1. ุงูุชูู ุฅูู: `ุงููุณุชุฎุฏููู` โ `ุงุฎุชุฑ ุงููุณุชุฎุฏู`
2. ูู ูุณู "ุงูุตูุงุญูุงุช":
   - ุงุจุญุซ ุนู "ุงููุฌููุนุงุช" (Groups)
   - ุฃุถู ุงููุณุชุฎุฏู ููุฌููุนุฉ "ูุณุคูู ูุฎุฒูู"
3. ุงุญูุธ

### **ูู Django Shell:**

```python
from django.contrib.auth.models import User, Group

# ุฅูุดุงุก ุงููุฌููุนุฉ (ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ)
warehouse_group, created = Group.objects.get_or_create(name='ูุณุคูู ูุฎุฒูู')

# ุฅุถุงูุฉ ูุณุชุฎุฏู ูููุฌููุนุฉ
user = User.objects.get(username='ูุญูุฏ')
user.groups.add(warehouse_group)
```

### **ูู ููุฏ Python:**

```python
def add_user_to_warehouse_managers(user):
    """ุฅุถุงูุฉ ูุณุชุฎุฏู ููุฌููุนุฉ ูุณุคูู ูุฎุฒูู"""
    from django.contrib.auth.models import Group
    
    warehouse_group, _ = Group.objects.get_or_create(name='ูุณุคูู ูุฎุฒูู')
    user.groups.add(warehouse_group)
    user.save()
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### **ุงุฎุชุจุงุฑ 1: ุงูุชุญูู ูู ุธููุฑ ุงูุฒุฑ**

```python
from django.contrib.auth.models import User, Group
from django.test import Client

# ุฅูุดุงุก ูุณุชุฎุฏู ุนุถู ูู ูุฌููุนุฉ ูุณุคูู ูุฎุฒูู
user = User.objects.create_user('test_user', password='password')
group = Group.objects.get_or_create(name='ูุณุคูู ูุฎุฒูู')[0]
user.groups.add(group)

# ุชุณุฌูู ุงูุฏุฎูู
client = Client()
client.login(username='test_user', password='password')

# ุงููุตูู ูุตูุญุฉ ุงููุฎุฒูู
response = client.get('/inventory/dashboard/')

# ุงูุชุญูู ูู ุธููุฑ ุงูุฒุฑ
assert 'is_warehouse_manager' in response.context
assert response.context['is_warehouse_manager'] == True
```

### **ุงุฎุชุจุงุฑ 2: ุงูุชุญูู ูู ุงูุตูุงุญูุงุช**

```python
# ูุณุชุฎุฏู ูู ูุฌููุนุฉ ูุณุคูู ูุฎุฒูู ุจุฏูู ูุณุชูุฏุนุงุช
user = User.objects.create_user('warehouse_staff', password='password')
group = Group.objects.get_or_create(name='ูุณุคูู ูุฎุฒูู')[0]
user.groups.add(group)

client = Client()
client.login(username='warehouse_staff', password='password')

# ุงููุตูู ูุตูุญุฉ ุงูุชุญูููุงุช
response = client.get('/inventory/transfers/')

# ูุฌุจ ุฃู ูุฑู ุฌููุน ุงูุชุญูููุงุช
assert response.status_code == 200
transfers = response.context['page_obj']
assert transfers.count() > 0  # ูุฑู ุงูุชุญูููุงุช
```

---

## ๐ ุงูุฎูุงุตุฉ

**ุชู ุชุญุฏูุซ ุงููุธุงู ููุฏุนู ูุฌููุนุฉ "ูุณุคูู ูุฎุฒูู":**

- โ ุฒุฑ ุงูุชุญูููุงุช ูุธูุฑ ูุฃุนุถุงุก ุงููุฌููุนุฉ
- โ ุฏุนู ุฃุณูุงุก ูุชุนุฏุฏุฉ ูููุฌููุนุฉ
- โ ุตูุงุญูุงุช ูุฑูุฉ (ูุน/ุจุฏูู ูุณุชูุฏุนุงุช ูุญุฏุฏุฉ)
- โ ุขูู ููุญูู

**ุงูุขู ูููู ุฅุนุทุงุก ุตูุงุญูุงุช ุงูุชุญูููุงุช ุงููุฎุฒููุฉ ุจุณูููุฉ ุนุจุฑ ุงููุฌููุนุงุช!** ๐
