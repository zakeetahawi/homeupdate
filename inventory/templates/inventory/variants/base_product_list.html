{% extends "base.html" %}
{% load static %}
{% block title %}ุงูููุชุฌุงุช ุงูุฃุณุงุณูุฉ{% endblock %}
{% block content %}
    <div class="container-fluid">
        <style>
            #warehousePrintModal .hover-bg-light:hover { background-color: #f8f9fa !important; }
            #warehousePrintModal .cursor-pointer { cursor: pointer; }
        </style>
        <script>
        // ููู ุงูููุฏูู ูุถูุงู ุงูุชูุณูุท ูููุน ูุดุงูู ุงูุชุฏุงุฎู
        document.addEventListener("DOMContentLoaded", function() {
            const modal = document.getElementById('warehousePrintModal');
            if (modal && modal.parentElement !== document.body) {
                document.body.appendChild(modal);
            }
        });
        </script>
        <!-- Warehouse Selection Modal -->
        <div class="modal fade"
             id="warehousePrintModal"
             tabindex="-1"
             aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg">
                    <div class="modal-header bg-dark text-white p-3">
                        <h5 class="modal-title fs-6 fw-bold">
                            <i class="fas fa-warehouse me-2"></i>
                            ุชุญุฏูุฏ ุงููุฎุงุฒู ููุทุจุงุนุฉ
                        </h5>
                        <button type="button"
                                class="btn-close btn-close-white"
                                data-bs-dismiss="modal"
                                aria-label="Close"></button>
                    </div>
                    <form action="{% url 'inventory:all_products_label_cards' %}"
                          method="get"
                          target="_blank">
                        <div class="modal-body p-4 text-start" dir="rtl">
                            <p class="text-muted mb-4 small">ุงุฎุชุฑ ุงููุฎุงุฒู ูุทุจุงุนุฉ ุงูุฃุตูุงู ุงููุชููุฑุฉ ุจูุง ููุท.</p>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0 fw-bold small text-dark">ูุงุฆูุฉ ุงููุฎุงุฒู</h6>
                                <button type="button"
                                        class="btn btn-sm btn-link text-decoration-none p-0"
                                        id="toggleAllWHBtn"
                                        onclick="toggleAllWarehouses(this)">ุชุญุฏูุฏ ุงููู</button>
                            </div>
                            <div class="warehouse-list border rounded p-2 bg-white"
                                 style="max-height: 250px;
                                        overflow-y: auto">
                                {% for wh in all_warehouses %}
                                    <div class="form-check mb-1 p-2 rounded hover-bg-light d-flex align-items-center">
                                        <input class="form-check-input ms-0 me-2 warehouse-checkbox"
                                               type="checkbox"
                                               name="warehouses"
                                               value="{{ wh.id }}"
                                               id="wh_{{ wh.id }}">
                                        <label class="form-check-label w-100 cursor-pointer text-dark"
                                               for="wh_{{ wh.id }}">{{ wh.name }}</label>
                                    </div>
                                {% empty %}
                                    <div class="text-center py-3 text-muted small">
                                        <i class="fas fa-exclamation-circle mb-2"></i>
                                        <br>
                                        ูุง ุชูุฌุฏ ูุฎุงุฒู ูุนุฑูุฉ ุฃู ูู ูุชู ุชูุฑูุฑ ุงูุจูุงูุงุช
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="modal-footer bg-light p-2">
                            <button type="button"
                                    class="btn btn-sm btn-secondary"
                                    data-bs-dismiss="modal">ุฅูุบุงุก</button>
                            <button type="submit"
                                    class="btn btn-sm btn-dark px-4"
                                    {% if not all_warehouses %}disabled{% endif %}>
                                <i class="fas fa-print me-2"></i>
                                ุทุจุงุนุฉ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Header Section -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-1">
                    <i class="fas fa-boxes text-primary me-2"></i>
                    ุงูููุชุฌุงุช ุงูุฃุณุงุณูุฉ
                </h2>
                <p class="text-muted mb-0">ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช ุงูุฃุณุงุณูุฉ ููุชุบูุฑุงุชูุง</p>
            </div>
            <div class="d-flex gap-2">
                <button onclick="generateAllQR()" class="btn btn-info text-white">
                    <i class="fas fa-qrcode me-1"></i>
                    ุชูููุฏ QR ูููู
                </button>
                <button onclick="downloadQRPDF()" class="btn btn-secondary">
                    <i class="fas fa-file-pdf me-1"></i>
                    PDF
                </button>
                <a href="{% url 'inventory:migrate_products' %}" class="btn btn-warning">
                    <i class="fas fa-sync-alt me-1"></i>
                    ุชุฑุญูู ุงูููุชุฌุงุช
                </a>
                <button type="button"
                        class="btn btn-dark"
                        data-bs-toggle="modal"
                        data-bs-target="#warehousePrintModal">
                    <i class="fas fa-tags me-1"></i>
                    ุทุจุงุนุฉ ูู ุงูุจุทุงูุงุช
                </button>
                <a href="{% url 'inventory:base_product_create' %}"
                   class="btn btn-primary">
                    <i class="fas fa-plus me-1"></i>
                    ููุชุฌ ุฃุณุงุณู ุฌุฏูุฏ
                </a>
            </div>
        </div>
        <!-- Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show"
                     role="alert">
                    <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% else %}info-circle{% endif %} me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card border-0 shadow-sm h-100"
                     style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
                    <div class="card-body text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-white-50 mb-1">ุฅุฌูุงูู ุงูููุชุฌุงุช ุงูุฃุณุงุณูุฉ</h6>
                                <h2 class="mb-0 fw-bold">{{ total_base_products }}</h2>
                                <small class="text-white-50">ููุชุฌ ุฃุณุงุณู</small>
                            </div>
                            <div class="opacity-50">
                                <i class="fas fa-boxes fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card border-0 shadow-sm h-100"
                     style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%)">
                    <div class="card-body text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-white-50 mb-1">ุฅุฌูุงูู ุงููุชุบูุฑุงุช</h6>
                                <h2 class="mb-0 fw-bold">{{ total_variants }}</h2>
                                <small class="text-white-50">ูุชุบูุฑ ูุดุท</small>
                            </div>
                            <div class="opacity-50">
                                <i class="fas fa-layer-group fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card border-0 shadow-sm h-100"
                     style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)">
                    <div class="card-body text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-white-50 mb-1">ุงูููุชุฌุงุช ุงููุดุทุฉ</h6>
                                <h2 class="mb-0 fw-bold">{{ active_base_products }}</h2>
                                <small class="text-white-50">ูู ุฃุตู {{ total_base_products }}</small>
                            </div>
                            <div class="opacity-50">
                                <i class="fas fa-check-circle fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card border-0 shadow-sm h-100"
                     style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%)">
                    <div class="card-body text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-white-50 mb-1">ูููุฉ ุงููุฎุฒูู</h6>
                                <h2 class="mb-0 fw-bold">{{ total_inventory_value|floatformat:0 }}</h2>
                                <small class="text-white-50">ุฌููู ูุตุฑู</small>
                            </div>
                            <div class="opacity-50">
                                <i class="fas fa-dollar-sign fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Results Summary -->
        {% if search or selected_category or selected_status %}
            <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                <div>
                    <strong>ูุชุงุฆุฌ ุงูุจุญุซ:</strong> ุชู ุงูุนุซูุฑ ุนูู <strong>{{ filtered_count }}</strong> ููุชุฌ ูู ุฃุตู <strong>{{
                        total_base_products }}</strong> ููุชุฌ ุฃุณุงุณู
                    </div>
                </div>
            {% endif %}
            <!-- Filter Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-filter me-2"></i>
                        ููุชุฑุฉ ูุจุญุซ
                    </h5>
                </div>
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">ุงูุจุญุซ</label>
                            <input type="text"
                                   name="search"
                                   class="form-control"
                                   placeholder="ุงูุจุญุซ ุจุงูุงุณู ุฃู ุงูููุฏ..."
                                   value="{{ request.GET.search }}">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">ุงููุฆุฉ</label>
                            <select name="category" class="form-select">
                                <option value="">ุฌููุน ุงููุฆุงุช</option>
                                {% for cat in categories %}
                                    <option value="{{ cat.id }}"
                                            {% if selected_category == cat.id|stringformat:"s" %}selected{% endif %}>
                                        {{ cat.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">ุงูุญุงูุฉ</label>
                            <select name="status" class="form-select">
                                <option value="">ุงููู</option>
                                <option value="active"
                                        {% if request.GET.status == 'active' %}selected{% endif %}>ูุดุท</option>
                                <option value="inactive"
                                        {% if request.GET.status == 'inactive' %}selected{% endif %}>ุบูุฑ ูุดุท</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">
                                <i class="fas fa-tags text-primary me-1"></i>
                                ููุน ุงูุณุนุฑ
                            </label>
                            <select name="price_type" class="form-select" id="priceTypeFilter">
                                <option value="retail"
                                        {% if request.GET.price_type == 'retail' or not request.GET.price_type %}selected{% endif %}>
                                    ๐ช ูุทุงุนู
                                </option>
                                <option value="wholesale"
                                        {% if request.GET.price_type == 'wholesale' %}selected{% endif %}>
                                    ๐ญ ุฌููุฉ
                                </option>
                            </select>
                        </div>
                        <div class="col-md-3 d-flex align-items-end gap-2">
                            <button type="submit" class="btn btn-primary flex-grow-1">
                                <i class="fas fa-search me-1"></i>
                                ุจุญุซ
                            </button>
                            <a href="?" class="btn btn-outline-secondary" title="ุฅุนุงุฏุฉ ุชุนููู">
                                <i class="fas fa-redo"></i>
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            <!-- Products Table -->
            <div class="card shadow">
                <div class="card-body">
                    {% if base_products %}
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 80px;">ุงูููุฏ</th>
                                        <th>ุงุณู ุงูููุชุฌ</th>
                                        <th>ุงููุฆุฉ</th>
                                        <th class="text-center">
                                            {% if request.GET.price_type == 'wholesale' %}
                                                <span class="badge bg-primary me-1">๐ญ ุฌููุฉ</span>
                                            {% else %}
                                                <span class="badge bg-success me-1">๐ช ูุทุงุนู</span>
                                            {% endif %}
                                            ุงูุณุนุฑ
                                        </th>
                                        <th class="text-center">ุนุฏุฏ ุงููุชุบูุฑุงุช</th>
                                        <th class="text-center">ุงูุญุงูุฉ</th>
                                        <th style="width: 150px;">ุงูุฅุฌุฑุงุกุงุช</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for product in base_products %}
                                        <tr>
                                            <td>
                                                <span class="badge bg-secondary">{{ product.code }}</span>
                                            </td>
                                            <td>
                                                <a href="{% url 'inventory:base_product_detail' product.pk %}"
                                                   class="text-decoration-none fw-bold">{{ product.name }}</a>
                                                {% if product.description %}
                                                    <br>
                                                    <small class="text-muted">{{ product.description|truncatewords:10 }}</small>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if product.category %}
                                                    <span class="badge bg-info">{{ product.category.name }}</span>
                                                {% else %}
                                                    <span class="text-muted">-</span>
                                                {% endif %}
                                            </td>
                                            <td class="text-center">
                                                {% if request.GET.price_type == 'wholesale' %}
                                                    {% if product.wholesale_price %}
                                                        <strong class="text-primary">{{ product.wholesale_price|floatformat:2 }}</strong>
                                                    {% else %}
                                                        <span class="text-warning" title="ูู ููุญุฏุฏ ุณุนุฑ ุฌููุฉ">
                                                            <i class="fas fa-exclamation-triangle me-1"></i>
                                                            {{ product.base_price|floatformat:2 }}
                                                        </span>
                                                    {% endif %}
                                                {% else %}
                                                    <strong class="text-success">{{ product.base_price|floatformat:2 }}</strong>
                                                {% endif %}
                                                <small class="text-muted">{{ product.currency }}</small>
                                            </td>
                                            <td class="text-center">
                                                {% with variants_count=product.variants.count %}
                                                    <span class="badge {% if variants_count > 0 %}bg-primary{% else %}bg-secondary{% endif %}">
                                                        {{ variants_count }} ูุชุบูุฑ
                                                    </span>
                                                {% endwith %}
                                            </td>
                                            <td class="text-center">
                                                {% if product.is_active %}
                                                    <span class="badge bg-success">
                                                        <i class="fas fa-check me-1"></i>ูุดุท
                                                    </span>
                                                {% else %}
                                                    <span class="badge bg-danger">
                                                        <i class="fas fa-times me-1"></i>ุบูุฑ ูุดุท
                                                    </span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <a href="{% url 'inventory:base_product_detail' product.pk %}"
                                                       class="btn btn-outline-info"
                                                       title="ุนุฑุถ">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a href="{% url 'inventory:base_product_update' product.pk %}"
                                                       class="btn btn-outline-primary"
                                                       title="ุชุนุฏูู">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <a href="{% url 'inventory:variant_create' product.pk %}"
                                                       class="btn btn-outline-success"
                                                       title="ุฅุถุงูุฉ ูุชุบูุฑ">
                                                        <i class="fas fa-plus"></i>
                                                    </a>
                                                    <button type="button"
                                                            class="btn btn-outline-danger"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#deleteModal{{ product.pk }}"
                                                            title="ุญุฐู">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                                <!-- Delete Modal -->
                                                <div class="modal fade" id="deleteModal{{ product.pk }}" tabindex="-1">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header bg-danger text-white">
                                                                <h5 class="modal-title">ุชุฃููุฏ ุงูุญุฐู</h5>
                                                                <button type="button"
                                                                        class="btn-close btn-close-white"
                                                                        data-bs-dismiss="modal"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p>ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูููุชุฌ ุงูุฃุณุงุณู:</p>
                                                                <p class="fw-bold text-danger">{{ product.name }} ({{ product.code }})</p>
                                                                <p class="text-warning">
                                                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                                                    ุณูุชู ุญุฐู ุฌููุน ุงููุชุบูุฑุงุช ุงููุฑุชุจุทุฉ!
                                                                </p>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                                                                <form action="{% url 'inventory:base_product_delete' product.pk %}"
                                                                      method="post"
                                                                      style="display:inline">
                                                                    {% csrf_token %}
                                                                    <button type="submit" class="btn btn-danger">
                                                                        <i class="fas fa-trash me-1"></i>
                                                                        ุญุฐู
                                                                    </button>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <!-- Showing Info -->
                        <div class="d-flex justify-content-between align-items-center mt-3 px-3">
                            <div class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                ุนุฑุถ
                                <strong>{{ page_obj.start_index }}</strong>
                                ุฅูู
                                <strong>{{ page_obj.end_index }}</strong>
                                ูู ุฃุตู
                                <strong>{{ page_obj.paginator.count }}</strong>
                                ููุชุฌ
                                {% if search or selected_category or selected_status %}(ูููุชุฑ ูู {{ total_base_products }} ููุชุฌ){% endif %}
                            </div>
                            <div class="text-muted">
                                <i class="fas fa-file-alt me-1"></i>
                                ุตูุญุฉ <strong>{{ page_obj.number }}</strong> ูู <strong>{{ page_obj.paginator.num_pages }}</strong>
                            </div>
                        </div>
                        <!-- Pagination -->
                        {% if page_obj %}
                            <nav aria-label="pagination" class="mt-4">
                                <ul class="pagination justify-content-center">
                                    {% if page_obj.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">
                                                <i class="fas fa-angle-double-right"></i>
                                            </a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">
                                                <i class="fas fa-angle-right"></i>
                                            </a>
                                        </li>
                                    {% endif %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ page_obj.number }} ูู {{ page_obj.paginator.num_pages }}</span>
                                    </li>
                                    {% if page_obj.has_next %}
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">
                                                <i class="fas fa-angle-left"></i>
                                            </a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">
                                                <i class="fas fa-angle-double-left"></i>
                                            </a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </nav>
                        {% endif %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-box-open fa-4x text-muted mb-3"></i>
                            <h4 class="text-muted">ูุง ุชูุฌุฏ ููุชุฌุงุช ุฃุณุงุณูุฉ</h4>
                            <p class="text-muted">ุงุจุฏุฃ ุจุฅุถุงูุฉ ููุชุฌ ุฃุณุงุณู ุฌุฏูุฏ ุฃู ุชุฑุญูู ุงูููุชุฌุงุช ุงูููุฌูุฏุฉ</p>
                            <div class="d-flex justify-content-center gap-2">
                                <a href="{% url 'inventory:base_product_create' %}"
                                   class="btn btn-primary">
                                    <i class="fas fa-plus me-1"></i>
                                    ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ
                                </a>
                                <a href="{% url 'inventory:migrate_products' %}" class="btn btn-warning">
                                    <i class="fas fa-sync-alt me-1"></i>
                                    ุชุฑุญูู ูู ุงูููุชุฌุงุช ุงููุฏููุฉ
                                </a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <script>
    function generateAllQR() {
        if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุชูููุฏ QR ูุฌููุน ุงูููุชุฌุงุชุ ูุฏ ุชุณุชุบุฑู ุงูุนูููุฉ ุจุนุถ ุงูููุช.')) return;

        // Show Loading
        Swal.fire({
            title: 'ุฌุงุฑู ุงูุชูููุฏ...',
            text: 'ูุฑุฌู ุงูุงูุชุธุงุฑ ุจูููุง ูุชู ุชูููุฏ ุฑููุฒ QR',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        fetch("{% url 'inventory:generate_all_qr_api' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire('ุชู ุจูุฌุงุญ!', data.message, 'success').then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire('ุฎุทุฃ!', data.error || 'ุญุฏุซ ุฎุทุฃ ูุง', 'error');
                }
            })
            .catch(error => {
                Swal.fire('ุฎุทุฃ!', 'ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            });
    }

    function downloadQRPDF() {
        // Show Loading
        Swal.fire({
            title: 'ุฌุงุฑู ุงูุชุญุถูุฑ...',
            text: 'ูุชู ุชุฌููุฒ ููู PDFุ ูุฑุฌู ุงูุงูุชุธุงุฑ...',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        fetch("{% url 'inventory:generate_qr_pdf_api' %}")
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.close();
                    // Create a temporary link to download
                    const link = document.createElement('a');
                    link.href = data.file_url;
                    link.download = 'products_qr_catalog.pdf';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    Swal.fire('ุฎุทุฃ!', data.error || 'ุญุฏุซ ุฎุทุฃ ูู ุชูููุฏ ุงูููู', 'error');
                }
            })
            .catch(error => {
                Swal.fire('ุฎุทุฃ!', 'ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู', 'error');
            });
    }
    </script>
    <script>
        function toggleAllWarehouses(btn) {
                const checkboxes = document.querySelectorAll('.warehouse-checkbox');
                const isSelectAll = btn.textContent.includes('ุชุญุฏูุฏ ุงููู');
                checkboxes.forEach(cb => cb.checked = isSelectAll);
                btn.textContent = isSelectAll ? 'ุฅูุบุงุก ุงูุชุญุฏูุฏ' : 'ุชุญุฏูุฏ ุงููู';
            }
</script>
{% endblock %}
