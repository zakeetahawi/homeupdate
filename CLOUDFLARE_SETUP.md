# Ø¯Ù„ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ Cloudflare Workers QR Scanner

## ğŸ“‹ Ù…Ù„Ù Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª (.env)

Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ù…Ù„Ù `.env`:

```bash
# ===================================
# Cloudflare Workers Settings
# ===================================
CLOUDFLARE_WORKER_URL=https://qr.elkhawaga.uk
CLOUDFLARE_SYNC_ENABLED=true
CLOUDFLARE_SYNC_API_KEY=cf_66eed06368ff433b92ac3f80c950038f
CLOUDFLARE_KV_NAMESPACE_ID=5dad2f4d72b246758bdafa17dfe4eb10
```

> **Ù…Ù„Ø§Ø­Ø¸Ø©:** Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ÙØ¹Ø¯Ù‘Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± migrationØŒ Ù„Ø°Ø§ Ù„Ø§ ØªØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„ `.env` Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙŠÙ….

---

## ğŸš€ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¥Ù†ØªØ§Ø¬ (Ø¨Ø¹Ø¯ git pull)

### Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø³Ø­Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
```bash
cd /path/to/homeupdate
git pull origin main
```

### Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª (Ø¥Ù† ÙˆØ¬Ø¯Øª Ø¬Ø¯ÙŠØ¯Ø©)
```bash
pip install -r requirements.txt
```

### Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªØ·Ø¨ÙŠÙ‚ Migrations
```bash
python manage.py migrate public
```

### Ø§Ù„Ø®Ø·ÙˆØ© 4: Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Cloudflare (Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙ‚Ø·)
```bash
python manage.py sync_to_cloudflare
```

### Ø§Ù„Ø®Ø·ÙˆØ© 5: ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…
```bash
python manage.py runserver 0.0.0.0:8000
# Ø£Ùˆ Ù„Ù„Ø¥Ù†ØªØ§Ø¬:
gunicorn crm.wsgi:application --bind 0.0.0.0:8000
```

---

## âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„

### 1. ÙØ­Øµ Ø­Ø§Ù„Ø© Worker
```bash
curl https://qr.elkhawaga.uk/health
```
**Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
```json
{"status":"ok","service":"elkhawaga-qr","products_cached":123}
```

### 2. ÙØ­Øµ Ù…Ù†ØªØ¬
Ø§ÙØªØ­ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­:
```
https://qr.elkhawaga.uk/p/PRODUCT-CODE/
```

### 3. Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Admin
```
/admin/public/cloudflaresettings/
```
- ÙŠØ¸Ù‡Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
- Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙØ²Ø§Ù…ÙÙ†Ø©
- Ø£Ø²Ø±Ø§Ø± Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ© ÙˆØ§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„

---

## ğŸ”§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©

| Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ | Ø§Ù„Ù‚ÙŠÙ…Ø© | Ø§Ù„ÙˆØµÙ |
|---------|--------|-------|
| Worker URL | `https://qr.elkhawaga.uk` | Ø±Ø§Ø¨Ø· Worker |
| API Key | `cf_66eed06368ff433b92ac3f80c950038f` | Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© |
| KV Namespace | `5dad2f4d72b246758bdafa17dfe4eb10` | Ù…ÙØ¹Ø±Ù‘Ù Ø§Ù„ØªØ®Ø²ÙŠÙ† |
| Ù…Ø²Ø§Ù…Ù†Ø© Ù…ÙØ¹Ù‘Ù„Ø© | âœ… Ù†Ø¹Ù… | ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ |
| Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸ | âœ… Ù†Ø¹Ù… | Ø¹Ù†Ø¯ Ø­ÙØ¸ Ø£ÙŠ Ù…Ù†ØªØ¬ |

---

## âš¡ ÙƒÙŠÙ ØªØ¹Ù…Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Ø­ÙØ¸ Ù…Ù†ØªØ¬    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Django Admin   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Signal Handler  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    API Request   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare KV  â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  cloudflare_sync â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QR Scanner     â”‚  â† ÙŠØ¹Ù…Ù„ Ø­ØªÙ‰ Ù„Ùˆ ØªÙˆÙ‚Ù Django!
â”‚  Worker         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ†˜ Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„

### Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù„Ø§ ØªØ¹Ù…Ù„
```bash
# ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
python manage.py shell -c "from public.models import CloudflareSettings; s=CloudflareSettings.get_settings(); print(f'Enabled: {s.is_enabled}, URL: {s.worker_url}')"
```

### Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
```bash
python manage.py sync_to_cloudflare
```

### Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ API Ø¬Ø¯ÙŠØ¯
Ù…Ù† Admin â†’ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudflare â†’ Ø§Ø®ØªØ± "ğŸ”‘ Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ API Ø¬Ø¯ÙŠØ¯"

Ø«Ù… Ø­Ø¯Ù‘Ø«Ù‡ ÙÙŠ Cloudflare KV:
```bash
npx wrangler kv key put "__SYNC_API_KEY__" "NEW_KEY_HERE" --namespace-id 5dad2f4d72b246758bdafa17dfe4eb10 --remote
```
