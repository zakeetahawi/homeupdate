# ุชุญุฏูุซ ุฑูู ุงูุนูุฏ ูุฅุตูุงุญ ุงูุชุฎุตูู ุงูููุฑู ูููููุงุช
## 2025-11-23

## ุงูููุฎุต
ุชู ุชูููุฐ ุงูุชุญุฏูุซุงุช ุงูุชุงููุฉ:

### 1. ุชุญุฏูุซ ุนุฑุถ ุฑูู ุงูุนูุฏ ูู ุจุทุงูุฉ ูุนูููุงุช ุงูุนูุฏ โ

**ุงููุดููุฉ:**
- ูุงู ุฑูู ุงูุนูุฏ ูุธูุฑ ุจุชูุณูู ูุนูุฏ: `2--2511-13-0795-0007`
- ุงูุชูุณูู ุงููุฏูู: `ุฑูู ุงููุฑุน-ุฑูู ุงูุทูุจ-ุงูุชุงุฑูุฎ-ุฑูู ุงูุนูุฏ`

**ุงูุญู:**
- ุชู ุชุจุณูุท ุงูุชูุณูู ููููู: `ุฑูู ุงูุนูุฏ-ุฑูู ุงูุทูุจ`
- ุงูุชูุณูู ุงูุฌุฏูุฏ: `0007-0795` (ุจุฏูู ุชุงุฑูุฎ ูุจุฏูู ุฑูู ุงููุฑุน)

**ุงูููู ุงููุนุฏู:**
- `orders/templates/orders/contract_template.html` (ุงูุณุทุฑ 703-705)

```html
<!-- ูุจู ุงูุชุนุฏูู -->
<span class="contract-number-main" dir="ltr">
    {{ order.branch.id|default:"1" }}-{{ order.order_number|stringformat:"04d" }}-{{ order.created_at|date:"ym" }}-{{ order.contract_number|default:"00" }}
</span>

<!-- ุจุนุฏ ุงูุชุนุฏูู -->
<span class="contract-number-main" dir="ltr">
    {{ order.contract_number|default:"00" }}-{{ order.order_number|stringformat:"04d" }}
</span>
```

### 2. ุฅุตูุงุญ ุงูุชุฎุตูู ุงูููุฑู ูููููุงุช ุนูุฏ ุงุฎุชูุงุฑ ุงูุฃููุดุฉ โ

**ุงููุดุงูู:**
1. ุงููููุงุช ูุง ุชูุฎุตู ุจุดูู ูุงูู ุจุนุฏ ุงูุงุฎุชูุงุฑ
2. ุงูุนูุงุตุฑ ุงููุณุชุฎุฏูุฉ ุจุงููุงูู ุชุธู ุธุงูุฑุฉ ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
3. ุงููุธุงู ููุจู ุฃุฑูุงู ุตุญูุญุฉ ููุท ูููุณ ููู ุนุดุฑูุฉ

**ุงูุญููู ุงููููุฐุฉ:**

#### ุฃ) ุฏุนู ุงูููู ุงูุนุดุฑูุฉ ุงููุงูู
- ุชู ุชุญุฏูุซ ุฌููุน ุญููู ุงููููุฉ ููุจูู ุงูููู ุงูุนุดุฑูุฉ (`step="0.01"`)
- ุชู ุชุญุฏูุซ ุฏูุงู JavaScript ูุงุณุชุฎุฏุงู `parseFloat` ุจุฏูุงู ูู `parseInt`
- ุชู ุฅุถุงูุฉ ูุญุต ููููู ุงูุนุดุฑูุฉ ุจุงุณุชุฎุฏุงู epsilon ููููุงุฑูุงุช ุงูุฏูููุฉ

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `orders/templates/orders/wizard/step5_contract.html`

**ุญููู ุงููููุฉ ุงููุญุฏุซุฉ:**
```html
<!-- ุญูู ูููุฉ ุงูููุงุด -->
<input type="number" id="fabric-meters" class="form-control" 
       min="0.01" step="0.01" placeholder="5.5">

<!-- ุญูู ูููุฉ ุงูุฅูุณุณูุงุฑ ูู ุงููุงุชูุฑุฉ -->
<input type="number" id="accessory-invoice-quantity" class="form-control" 
       min="0.01" step="0.01" value="1">

<!-- ุญูู ูููุฉ ุงูุฅูุณุณูุงุฑ ุงูุฎุงุฑุฌู -->
<input type="number" id="accessory-external-quantity" class="form-control" 
       min="0.01" step="0.01" value="1">
```

#### ุจ) ุงูุชุฎุตูู ุงูููุฑู ูุฅุฎูุงุก ุงูุนูุงุตุฑ ุงููุณุชุฎุฏูุฉ

**ุงูุฏูุงู ุงูุฌุฏูุฏุฉ/ุงููุญุฏุซุฉ:**

1. **ุฏุงูุฉ `updateFabricSelectOptions()`** - ุฌุฏูุฏุฉ
   - ุชุญุฏุซ ุฎูุงุฑุงุช ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ููุฑุงู
   - ุชุนุฑุถ ุงููููุฉ ุงููุชุจููุฉ ููู ุนูุตุฑ
   - ุชุฎูู ุงูุนูุงุตุฑ ุงูุชู ุงุณุชูุฎุฏูุช ุจุงููุงูู (ุงููููุฉ ุงููุชุจููุฉ โค 0.001)

```javascript
function updateFabricSelectOptions() {
    const fabricSelect = document.getElementById('fabric-name');
    const accessorySelect = document.getElementById('accessory-from-invoice');
    
    // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุฃููุดุฉ
    if (fabricSelect) {
        Array.from(fabricSelect.options).forEach(option => {
            if (option.value === '') return;
            
            const itemId = option.value;
            const tracker = fabricUsageTracker[itemId];
            if (tracker) {
                const remaining = tracker.total - tracker.used;
                
                // ุชุญุฏูุซ ุงููููุฉ ุงููุนุฑูุถุฉ
                const qtySpan = document.querySelector(`.available-qty-${itemId}`);
                if (qtySpan) {
                    qtySpan.textContent = remaining.toFixed(3).replace(/\.?0+$/, '');
                }
                
                // ุฅุฎูุงุก ุงูุฎูุงุฑ ุฅุฐุง ุงุณุชูุฎุฏู ุจุงููุงูู
                if (remaining <= 0.001) {
                    option.style.display = 'none';
                    option.disabled = true;
                } else {
                    option.style.display = '';
                    option.disabled = false;
                }
            }
        });
    }
    
    // ููุณ ุงูุดูุก ููุงุฆูุฉ ุงูุฅูุณุณูุงุฑุงุช
    // ... (ููุฏ ููุงุซู)
}
```

2. **ุชุญุฏูุซ ุฏุงูุฉ `calculateUsedQuantities()`**
   - ุชุณุชุฏุนู `updateFabricSelectOptions()` ุจุนุฏ ุงูุญุณุงุจ
   - ุชุญุฏุซ ุงูููุงุฆู ููุฑุงู ุจุนุฏ ูู ุนูููุฉ

3. **ุชุญุฏูุซ ุฏุงูุฉ `updateFabricQuantityInfo()`**
   - ุชุนุฑุถ ุงููููุฉ ุงููุชุจููุฉ ุจุชูุณูู ุตุญูุญ (ุจุฏูู ุฃุตูุงุฑ ุฒุงุฆุฏุฉ)
   - ุชููุฃ ุญูู ุงููููุฉ ุชููุงุฆูุงู ุจุงููููุฉ ุงููุชุจููุฉ ุฅุฐุง ูุงู ูุงุฑุบุงู

4. **ุชุญุฏูุซ ุฏุงูุฉ `addFabricToList()`**
   - ุงุณุชุฎุฏุงู `parseFloat` ุจุฏูุงู ูู `parseInt`
   - ูุญุต ุงูููู ุงูุนุดุฑูุฉ ุจุดูู ุตุญูุญ
   - ุฅุถุงูุฉ `isNaN` ููุชุญูู ูู ุตุญุฉ ุงููููุฉ
   - ุงุณุชุฎุฏุงู epsilon (0.001) ููููุงุฑูุงุช ุงูุฏูููุฉ

5. **ุชุญุฏูุซ ุฏุงูุฉ `removeFabric()`**
   - ุชุณุชุฏุนู `calculateUsedQuantities()` ูุชุญุฏูุซ ุงูููุงุฆู ุจุนุฏ ุงูุญุฐู

6. **ุชุญุฏูุซ ุฏูุงู ุงูุฅูุณุณูุงุฑุงุช**
   - `addAccessoryFromInvoice()`: ุฏุนู ุงูููู ุงูุนุดุฑูุฉ ูุงูุชุญุฏูุซ ุงูููุฑู
   - `addExternalAccessory()`: ุฏุนู ุงูููู ุงูุนุดุฑูุฉ
   - `updateAccessoryQuantityInfo()`: ุนุฑุถ ุงููููุฉ ุงููุชุจููุฉ ุจุดูู ุตุญูุญ
   - `removeAccessory()`: ุชุญุฏูุซ ุงูููุงุฆู ุจุนุฏ ุงูุญุฐู

#### ุฌ) ุงูุชููุฆุฉ ุนูุฏ ูุชุญ ุงูููุฏุงู

ุชู ุฅุถุงูุฉ ูุณุชูุน ูุญุฏุซ ูุชุญ ุงูููุฏุงู:
```javascript
document.addEventListener('DOMContentLoaded', function() {
    // ... ููุฏ ููุฌูุฏ
    
    // ุชููุฆุฉ ุงูุชุชุจุน ูุชุญุฏูุซ ุงูุฎูุงุฑุงุช ุนูุฏ ุชุญููู ุงูุตูุญุฉ
    calculateUsedQuantities();
    
    // ุงูุงุณุชูุงุน ูุญุฏุซ ูุชุญ ุงูููุฏุงู ูุชุญุฏูุซ ุงููููุงุช
    const addCurtainModal = document.getElementById('addCurtainModal');
    if (addCurtainModal) {
        addCurtainModal.addEventListener('show.bs.modal', function() {
            if (!editingCurtainId) {
                tempFabrics = [];
                tempAccessories = [];
            }
            calculateUsedQuantities();
        });
    }
});
```

#### ุฏ) ุชุญุณููุงุช ุงูุนุฑุถ

1. **ุฅุฒุงูุฉ ุงูุฃุตูุงุฑ ุงูุฒุงุฆุฏุฉ ูู ุงูุฃุฑูุงู ุงูุนุดุฑูุฉ:**
```javascript
// ุงุณุชุฎุฏุงู ูุฐุง ุงูุชูุณูู ูู ุฌููุน ุนูููุงุช ุงูุนุฑุถ
parseFloat(value).toFixed(3).replace(/\.?0+$/, '')

// ูุซุงู:
// 5.500 โ 5.5
// 3.000 โ 3
// 2.750 โ 2.75
```

2. **ุชุญุฏูุซ ุนุฑุถ ุงูุฃููุดุฉ ูุงูุฅูุณุณูุงุฑุงุช ูู ุงูููุงุฆู:**
```javascript
// ูู updateFabricsList()
const metersFormatted = parseFloat(fabric.meters).toFixed(3).replace(/\.?0+$/, '');

// ูู updateAccessoriesList()
const quantityFormatted = parseFloat(accessory.quantity).toFixed(3).replace(/\.?0+$/, '');
```

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุงูุชุฎุตูู ุงูููุฑู
- ุนูุฏ ุงุฎุชูุงุฑ ููุงุด ุฃู ุฅูุณุณูุงุฑุ ูุชู ุชุญุฏูุซ ุงููููุฉ ุงููุชุงุญุฉ ููุฑุงู
- ูุง ูููู ุงุฎุชูุงุฑ ูููุฉ ุฃูุจุฑ ูู ุงููุชุงุญุฉ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุชุนุฑุถ ุงููููุฉ ุงููุชุจููุฉ

### 2. ุฅุฎูุงุก ุงูุนูุงุตุฑ ุงููุณุชุฎุฏูุฉ ุจุงููุงูู
- ุงูุนูุงุตุฑ ุงูุชู ุชู ุงุณุชุฎุฏุงู ูููุชูุง ุจุงููุงูู ุชุฎุชูู ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
- ูุชู ุชุนุทูููุง (`disabled`) ูููุน ุงูุงุฎุชูุงุฑ ุนู ุทุฑูู ุงูุฎุทุฃ
- ุชุนูุฏ ููุธููุฑ ุฅุฐุง ุชู ุญุฐู ุงุณุชุฎุฏุงู ูููุง

### 3. ุฏุนู ุงูููู ุงูุนุดุฑูุฉ ุงููุงูู
- ูููู ุฅุฏุฎุงู ููู ูุซู: 2.5ุ 3.75ุ 0.25
- ุญุณุงุจุงุช ุฏูููุฉ ุจุงุณุชุฎุฏุงู floating point ูุน epsilon
- ุนุฑุถ ูุธูู ุจุฏูู ุฃุตูุงุฑ ุฒุงุฆุฏุฉ

### 4. ุงูููุก ุงูุชููุงุฆู
- ุนูุฏ ุงุฎุชูุงุฑ ุนูุตุฑุ ูุชู ููุก ุญูู ุงููููุฉ ุชููุงุฆูุงู ุจุงููููุฉ ุงููุชุจููุฉ
- ูุณูู ุงุณุชุฎุฏุงู ูุงูู ุงููููุฉ ุงููุชุงุญุฉ

## ุงูุงุฎุชุจุงุฑุงุช ุงููุทููุจุฉ

### ุงุฎุชุจุงุฑ ุฑูู ุงูุนูุฏ
1. ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ ุนุจุฑ ุงููุนุงูุฌ
2. ุฅุถุงูุฉ ุณุชุงุฆุฑ ูุญูุธ ุงูุนูุฏ
3. ูุชุญ ุจุทุงูุฉ ูุนูููุงุช ุงูุนูุฏ (Contract Template)
4. ุงูุชุญูู ูู ุนุฑุถ ุฑูู ุงูุนูุฏ ุจุงูุชูุณูู: `ุฑูู_ุงูุนูุฏ-ุฑูู_ุงูุทูุจ`

### ุงุฎุชุจุงุฑ ุงูุชุฎุตูู ุงูููุฑู

#### ุงูุณููุงุฑูู 1: ุงุณุชุฎุฏุงู ุฌุฒุฆู
1. ุฅุถุงูุฉ ููุชุฌ ุจูููุฉ 10 ูุชุฑ ูู ุงููุงุชูุฑุฉ
2. ุจุฏุก ุฅุถุงูุฉ ุณุชุงุฑุฉ ูุฅุถุงูุฉ ููุงุด
3. ุงุฎุชูุงุฑ ุงูููุชุฌ ูุฅุฏุฎุงู 3.5 ูุชุฑ
4. ุญูุธ ุงูููุงุด
5. ุงูุชุญูู ูู:
   - ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ุชุนุฑุถ "ูุชููุฑ: 6.5 ูุชุฑ"
   - ูููู ุฅุถุงูุฉ ููุงุด ุขุฎุฑ ูู ููุณ ุงูููุชุฌ
   - ุงูุญุฏ ุงูุฃูุตู ูููููุฉ ุงูุฌุฏูุฏุฉ ูู 6.5 ูุชุฑ

#### ุงูุณููุงุฑูู 2: ุงุณุชุฎุฏุงู ูุงูู
1. ุฅุถุงูุฉ ููุชุฌ ุจูููุฉ 5 ูุชุฑ
2. ุงุณุชุฎุฏุงู 5 ูุชุฑ ูู ููุงุด
3. ุงูุชุญูู ูู:
   - ุงูููุชุฌ ุงุฎุชูู ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
   - ูุง ูุธูุฑ ุญุชู ูู ุงูููุงุฆู ุงูุฃุฎุฑู (ุฅูุณุณูุงุฑุงุช)

#### ุงูุณููุงุฑูู 3: ุงูููู ุงูุนุดุฑูุฉ
1. ุฅุฏุฎุงู ูููุงุช ุนุดุฑูุฉ ูุซู: 2.75ุ 3.333ุ 0.5
2. ุงูุชุญูู ูู:
   - ูุจูู ุงูููู ุจุดูู ุตุญูุญ
   - ุนุฑุถ ุงููููุงุช ุงููุชุจููุฉ ุจุฏูุฉ
   - ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุตุญูุญุฉ

#### ุงูุณููุงุฑูู 4: ุงูุญุฐู ูุงูุฅุนุงุฏุฉ
1. ุฅุถุงูุฉ ููุงุด ุจูููุฉ 3 ูุชุฑ
2. ุญุฐู ุงูููุงุด
3. ุงูุชุญูู ูู:
   - ุงููููุฉ ุนุงุฏุช ูููุงุฆูุฉ ุงูููุณุฏูุฉ
   - ูููู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงููููุฉ

### ุงุฎุชุจุงุฑ ุงูุฅูุณุณูุงุฑุงุช
ููุณ ุงูุณููุงุฑูููุงุช ุงูุณุงุจูุฉ ูููู ููุฅูุณุณูุงุฑุงุช (ูู ุงููุงุชูุฑุฉ ูุงูุฎุงุฑุฌูุฉ)

## ุงููููุงุช ุงููุนุฏูุฉ

```
orders/templates/orders/contract_template.html
orders/templates/orders/wizard/step5_contract.html
```

## ุงูููุงุญุธุงุช ุงููููุฉ

### ุงุณุชุฎุฏุงู Epsilon ูู ุงูููุงุฑูุงุช
```javascript
// ุจุฏูุงู ูู:
if (remaining === 0)

// ุงุณุชุฎุฏู:
if (remaining <= 0.001)
```
ูุฐุง ูุชุนุงูู ูุน ุฃุฎุทุงุก floating point ูู JavaScript.

### ุชูุณูู ุงูุฃุฑูุงู ุงูุนุดุฑูุฉ
```javascript
// ููุญุตูู ุนูู ุฑูู ุจุฏูู ุฃุตูุงุฑ ุฒุงุฆุฏุฉ:
parseFloat(value).toFixed(3).replace(/\.?0+$/, '')

// ุฃูุซูุฉ:
// 5.000 โ "5"
// 5.500 โ "5.5"
// 5.123 โ "5.123"
```

### ุฅุฎูุงุก ุนูุงุตุฑ Select
```javascript
// ูู JavaScript ูุง ูููู ุฅุฎูุงุก options ูู ุจุนุถ ุงููุชุตูุญุงุช
// ูุฐูู ูุณุชุฎุฏู:
option.style.display = 'none';  // ููุฅุฎูุงุก
option.disabled = true;          // ููุชุนุทูู (ุงุญุชูุงุทู)
```

## ุงูุชูุตูุงุช ูููุณุชูุจู

1. **ุฅุถุงูุฉ ุฑุณุงุฆู ุชูุถูุญูุฉ:**
   - ุนุฑุถ tooltip ููุถุญ ุงููููุฉ ุงูุฃุตููุฉ ูุงููุณุชุฎุฏูุฉ
   - ุฅุถุงูุฉ ูุคุดุฑ ูููู (ุฃุญูุฑ/ุฃุตูุฑ/ุฃุฎุถุฑ) ุญุณุจ ุงููููุฉ ุงููุชุจููุฉ

2. **ุชุญุณูู ุงูุฃุฏุงุก:**
   - Cache ูุชุงุฆุฌ calculateUsedQuantities ุฅุฐุง ูุงูุช ุงูููุงุฆู ูุจูุฑุฉ
   - ุงุณุชุฎุฏุงู debouncing ููุชุญุฏูุซุงุช ุงููุชูุฑุฑุฉ

3. **ุชุญุณูู UX:**
   - ุฅุถุงูุฉ ุชุฃููุฏ ุนูุฏ ุงุณุชุฎุฏุงู ูููุฉ ูุจูุฑุฉ
   - ุนุฑุถ ููุฎุต ูููููุงุช ุงููุณุชุฎุฏูุฉ ูุจู ุงูุญูุธ ุงูููุงุฆู

4. **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:**
   - ุฅุถุงูุฉ ูุญุต server-side ูููููุงุช ุงููุชุงุญุฉ
   - ููุน ุงูุญูุธ ุฅุฐุง ุชุฌุงูุฒุช ุงููููุฉ ุงููุชุงุญุฉ

## ููุฎุต ุงูุชุญุฏูุซุงุช

โ **ุชู ุจูุฌุงุญ:**
- ุชุจุณูุท ุนุฑุถ ุฑูู ุงูุนูุฏ (ุฑูู ุงูุนูุฏ-ุฑูู ุงูุทูุจ)
- ุฏุนู ุงูููู ุงูุนุดุฑูุฉ ุงููุงูู ูู ุฌููุน ุญููู ุงููููุฉ
- ุงูุชุฎุตูู ุงูููุฑู ูููููุงุช ุนูุฏ ุงูุงุฎุชูุงุฑ
- ุฅุฎูุงุก ุงูุนูุงุตุฑ ุงููุณุชุฎุฏูุฉ ุจุงููุงูู ูู ุงูููุงุฆู
- ุชุญุฏูุซ ููุฑู ูููููุงุช ุงููุชุงุญุฉ ุจุนุฏ ูู ุนูููุฉ
- ุนุฑุถ ูุธูู ููุฃุฑูุงู (ุจุฏูู ุฃุตูุงุฑ ุฒุงุฆุฏุฉ)
- ููุก ุชููุงุฆู ูููููุงุช ุงููุชุจููุฉ
- ูุนุงูุฌุฉ ุฏูููุฉ ูุฃุฎุทุงุก floating point

๐ **ูุญุชุงุฌ ุงุฎุชุจุงุฑ:**
- ุฌููุน ุงูุณููุงุฑูููุงุช ุงููุฐููุฑุฉ ุฃุนูุงู
- ุงูุชูุงูู ูุน ุงููุชุตูุญุงุช ุงููุฎุชููุฉ
- ุงูุฃุฏุงุก ูุน ููุงุฆู ุทูููุฉ ูู ุงูููุชุฌุงุช

โณ **ูููุณุชูุจู:**
- ุชุญุณููุงุช UX ุงูููุชุฑุญุฉ
- ูุญุต server-side ูููููุงุช
