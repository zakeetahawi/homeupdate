{% extends 'base.html' %}
{% load i18n %}
{% load widget_tweaks %}
{% load static %}

{% block title %}
    {% if inspection %}
        {% trans 'تعديل معاينة' %}
    {% else %}
        {% trans 'معاينة جديدة' %}
    {% endif %}
{% endblock %}

{% block extra_css %}
<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css" rel="stylesheet" />
<link rel="stylesheet" href="{% static 'inspections/css/google_drive.css' %}">

<style>
.form-section {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.form-section h5 {
    color: #495057;
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
    margin-bottom: 20px;
}

.payment-status-display {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 12px;
    text-align: center;
}

.badge-large {
    font-size: 0.9rem;
    padding: 8px 12px;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        {% if inspection %}
                            {% trans 'تعديل معاينة' %}
                        {% else %}
                            {% trans 'معاينة جديدة' %}
                        {% endif %}
                    </h3>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" novalidate>
                        {% csrf_token %}

                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- معلومات العميل والمعاين -->
                        <div class="form-section">
                            <h5>
                                <i class="fas fa-users text-primary"></i> {% trans 'معلومات العميل والمعاين' %}
                            </h5>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="{{ form.customer.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-user text-primary me-2"></i>{% trans 'العميل' %} <span class="text-danger">*</span>
                                        </label>
                                        {% if form.fields.customer.disabled %}
                                        <input type="text" class="form-control" value="{{ customer.name|default:'' }}" readonly>
                                        <input type="hidden" name="customer" value="{{ customer.pk }}">
                                        {% else %}
                                        {% render_field form.customer class="form-control select2" id="customer-select" %}
                                        {% endif %}
                                        {% if form.customer.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.customer.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="{{ form.inspector.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-user-tie text-info me-2"></i>{% trans 'المعاين' %} <span class="text-danger">*</span>
                                        </label>
                                        {% render_field form.inspector class="form-control select2" %}
                                        {% if form.inspector.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.inspector.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                            <!-- عنوان العميل -->
                            <div class="form-group mb-3" id="customer-address-container" style="display: none;">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-map-marker-alt text-warning me-2"></i>{% trans 'عنوان العميل' %}
                                </label>
                                <div class="form-control bg-light" id="customer-address" style="height: auto; min-height: 60px;"></div>
                            </div>
                        </div>

                        <!-- معلومات العقد والتواريخ -->
                        <div class="form-section">
                            <h5>
                                <i class="fas fa-calendar-alt text-success"></i> {% trans 'معلومات العقد والتواريخ' %}
                            </h5>

                            <!-- تم إزالة حقل رقم العقد -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="{{ form.windows_count.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-th-large text-info me-2"></i>{% trans 'عدد الشبابيك' %}
                                        </label>
                                        {% render_field form.windows_count class="form-control" %}
                                        {% if form.windows_count.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.windows_count.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="{{ form.request_date.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-calendar text-primary me-2"></i>{% trans 'تاريخ الطلب' %}
                                        </label>
                                        {% render_field form.request_date class="form-control" %}
                                        {% if form.request_date.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.request_date.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="{{ form.scheduled_date.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-calendar-check text-warning me-2"></i>{% trans 'تاريخ التنفيذ' %}
                                        </label>
                                        {% render_field form.scheduled_date class="form-control" %}
                                        {% if form.scheduled_date.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.scheduled_date.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="{{ form.scheduled_time.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-clock text-warning me-2"></i>{% trans 'وقت التنفيذ' %}
                                        </label>
                                        {% render_field form.scheduled_time class="form-control" %}
                                        {% if form.scheduled_time.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.scheduled_time.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                        <small class="form-text text-muted">اختياري - مثال: 14:30</small>
                                    </div>
                                </div>
                            </div>

                            <!-- تاريخ التسليم المتوقع -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label fw-bold">
                                            <i class="fas fa-truck text-success me-2"></i>{% trans 'تاريخ التسليم المتوقع' %}
                                        </label>
                                        <div class="payment-status-display">
                                            {% if inspection.expected_delivery_date %}
                                                <span class="badge bg-info badge-large">
                                                    <i class="fas fa-calendar-day me-1"></i> {{ inspection.expected_delivery_date|date:"Y-m-d" }}
                                                </span>
                                            {% else %}
                                                <span class="badge bg-secondary badge-large">
                                                    <i class="fas fa-question me-1"></i> سيتم حسابه تلقائياً
                                                </span>
                                            {% endif %}
                                        </div>
                                        <small class="form-text text-muted mt-2 d-block">
                                            <i class="fas fa-info-circle me-1"></i> يتم حسابه تلقائياً: 48 ساعة من تاريخ الطلب
                                        </small>
                                        <!-- إزالة الحقل المخفي المسبب للمشكلة -->
                                        {% comment %}
                                        <input type="hidden" name="expected_delivery_date" value="{{ inspection.expected_delivery_date|default:'' }}">
                                        {% endcomment %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- الحالة والنتيجة والمديونية -->
                        <div class="form-section">
                            <h5>
                                <i class="fas fa-tasks text-warning"></i> {% trans 'الحالة والنتيجة والمديونية' %}
                            </h5>

                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="{{ form.status.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-flag text-primary me-2"></i>{% trans 'الحالة' %} <span class="text-danger">*</span>
                                        </label>
                                        {% render_field form.status class="form-control" %}
                                        {% if form.status.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.status.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-money-bill text-success me-2"></i>{% trans 'حالة المديونية' %}
                                    </label>
                                    <div class="payment-status-display">
                                        {% if inspection.payment_status == 'paid' %}
                                            <span class="badge bg-success badge-large">
                                                <i class="fas fa-check-circle me-1"></i> مكتمل السداد
                                            </span>
                                        {% elif inspection.payment_status == 'collect_on_visit' %}
                                            <span class="badge bg-warning text-dark badge-large">
                                                <i class="fas fa-clock me-1"></i> تحصيل عند العميل
                                            </span>
                                        {% else %}
                                            <span class="badge bg-secondary badge-large">
                                                <i class="fas fa-question me-1"></i> غير محدد
                                            </span>
                                        {% endif %}
                                    </div>
                                    <small class="form-text text-muted mt-2 d-block">
                                        <i class="fas fa-info-circle me-1"></i> يتم تحديد حالة المديونية تلقائياً بناءً على حالة الدفع في الطلب
                                    </small>
                                    <!-- لا نرسل payment_status في النموذج - يتم تحديدها تلقائياً -->
                                </div>
                            </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="{{ form.result.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-clipboard-check text-success me-2"></i>{% trans 'النتيجة' %}
                                        </label>
                                        {% render_field form.result class="form-control" %}
                                        {% if form.result.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.result.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- معلومات الفرع والموظف -->
                        <div class="form-section">
                            <h5>
                                <i class="fas fa-building text-info"></i> {% trans 'معلومات الفرع والموظف' %}
                            </h5>

                            <div class="row mb-3">
                                {% if not user.is_superuser %}
                                    {{ form.branch.as_hidden }}
                                {% else %}
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="{{ form.branch.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-store text-info me-2"></i>{% trans 'الفرع' %} <span class="text-danger">*</span>
                                        </label>
                                        {% render_field form.branch class="form-control select2" %}
                                        {% if form.branch.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.branch.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="{{ form.responsible_employee.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-user-cog text-secondary me-2"></i>{% trans 'الموظف المسؤول' %}
                                        </label>
                                        {% render_field form.responsible_employee class="form-control select2" %}
                                        {% if form.responsible_employee.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.responsible_employee.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ form.inspection_file.id_for_label }}" class="form-label">
                                        <i class="fas fa-file-pdf"></i> {% trans 'ملف المعاينة' %}
                                    </label>
                                    {% render_field form.inspection_file class="form-control" accept=".pdf" %}

                                    <!-- معاينة اسم الملف في Google Drive -->
                                    <div class="mt-2">
                                        <div class="alert alert-info py-2">
                                            <i class="fab fa-google-drive text-primary"></i>
                                            <strong>رفع تلقائي إلى Google Drive:</strong>
                                            <br>
                                            <small class="text-muted">
                                                سيتم رفع الملف تلقائياً إلى Google Drive عند الحفظ
                                                <br>
                                                <strong>اسم الملف:</strong> <span id="filename-preview" class="text-primary">سيتم توليده تلقائياً</span>
                                            </small>
                                        </div>
                                    </div>

                                    <!-- حالة الرفع إلى Google Drive -->
                                    {% if inspection.is_uploaded_to_drive %}
                                    <div class="mt-2">
                                        <div class="alert alert-success py-2">
                                            <i class="fas fa-check-circle"></i>
                                            <strong>تم الرفع إلى Google Drive بنجاح!</strong>
                                            <br>
                                            <a href="{{ inspection.google_drive_file_url }}" target="_blank" class="btn btn-sm btn-primary mt-1">
                                                <i class="fab fa-google-drive"></i> عرض في Google Drive
                                            </a>
                                        </div>
                                    </div>
                                    {% endif %}

                                    {% if form.inspection_file.help_text %}
                                        <small class="text-muted">{{ form.inspection_file.help_text }}</small>
                                    {% endif %}
                                    {% if form.inspection_file.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.inspection_file.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ form.windows_count.id_for_label }}" class="form-label">{% trans 'عدد الشبابيك' %}</label>
                                    {% render_field form.windows_count class="form-control" type="number" min="0" %}
                                    {% if form.windows_count.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.windows_count.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Customer Address Update Section -->
                        {% if inspection %}
                        <div class="mb-4">
                            <div class="card border-warning">
                                <div class="card-header bg-warning text-dark">
                                    <h5 class="card-title mb-0">
                                        <i class="fas fa-map-marker-alt"></i> {% trans 'تحديث عنوان العميل' %}
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="{{ form.update_customer_address.id_for_label }}" class="form-label fw-bold">
                                            <i class="fas fa-edit"></i> {% trans 'العنوان الجديد للعميل' %}:
                                        </label>
                                        {{ form.update_customer_address|add_class:"form-control" }}
                                        <small class="text-muted mt-1 d-block">
                                            <i class="fas fa-info-circle"></i> 
                                            {% trans 'إذا تم ملء هذا الحقل، سيتم تحديث العنوان الرئيسي للعميل في جميع أنحاء النظام (المعاينات والتركيبات)' %}
                                        </small>
                                        {% if form.update_customer_address.errors %}
                                            <div class="invalid-feedback d-block">{{ form.update_customer_address.errors }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    {% if inspection.customer.address %}
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading fw-bold">
                                            <i class="fas fa-map-marker-alt"></i> {% trans 'العنوان الحالي للعميل' %}:
                                        </h6>
                                        <p class="mb-0">{{ inspection.customer.address|linebreaks }}</p>
                                    </div>
                                    {% else %}
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle"></i> 
                                        {% trans 'لا يوجد عنوان مسجل للعميل حالياً' %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Notes section -->
                        <div class="mb-4">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="card-title mb-0">{% trans 'ملاحظات المعاينة' %}</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="{{ form.notes.id_for_label }}" class="form-label fw-bold">
                                            {% trans 'ملاحظات المعاينة' %}:
                                        </label>
                                        {{ form.notes|add_class:"form-control" }}
                                        <small class="text-muted mt-1 d-block">{% trans 'أدخل ملاحظات خاصة بعملية المعاينة هنا' %}</small>
                                        {% if form.notes.errors %}
                                            <div class="invalid-feedback d-block">{{ form.notes.errors }}</div>
                                        {% endif %}
                                    </div>

                                    {% if inspection.order_notes %}
                                    <div class="mt-4">
                                        <div class="alert alert-info">
                                            <h6 class="alert-heading fw-bold">{% trans 'ملاحظات من الطلب (للعلم فقط)' %}:</h6>
                                            <hr>
                                            <p class="mb-0">{{ inspection.order_notes|linebreaks }}</p>
                                        </div>
                                        <div class="text-muted small"><i class="fas fa-info-circle"></i> {% trans 'هذه الملاحظات للعلم فقط ولا يمكن تعديلها هنا. يمكن التعديل من صفحة الطلب.' %}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{% url 'inspections:inspection_list' %}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> {% trans 'إلغاء' %}
                            </a>
                            <button type="submit" class="btn btn-primary" id="save-btn">
                                <i class="fas fa-save"></i>
                                <span id="save-text">
                                    {% if inspection %}
                                        {% trans 'حفظ التغييرات' %}
                                    {% else %}
                                        {% trans 'إنشاء المعاينة' %}
                                    {% endif %}
                                </span>
                                <span id="saving-text" style="display: none;">
                                    <i class="fas fa-spinner fa-spin"></i> جاري الحفظ...
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Select2 JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'inspections/js/upload_status_checker.js' %}"></script>
<script src="{% static 'inspections/js/inspection_form_enhanced.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // تهيئة Select2 للقوائم المنسدلة فقط
    if (typeof $ !== 'undefined' && $.fn.select2) {
        $('.select2').select2({
            theme: 'bootstrap-5',
            dir: 'rtl',
            width: '100%',
            placeholder: 'اختر...',
            allowClear: true
        });
    }

    // إزالة الشرط من حقل النتيجة - سيظهر دائماً
    // لا حاجة لكود خاص هنا

    // عرض عنوان العميل فقط
    const customerSelect = document.getElementById('customer-select');
    const customerAddressContainer = document.getElementById('customer-address-container');
    const customerAddress = document.getElementById('customer-address');

    if (customerSelect && customerAddressContainer && customerAddress) {
        customerSelect.addEventListener('change', function() {
            const customerId = this.value;
            if (customerId) {
                fetch('/customers/api/customer/' + customerId + '/')
                    .then(response => response.json())
                    .then(data => {
                        if (data.address) {
                            customerAddress.textContent = data.address;
                            customerAddressContainer.style.display = 'block';
                        } else {
                            customerAddress.textContent = 'لا يوجد عنوان مسجل';
                            customerAddressContainer.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        console.error('خطأ في جلب بيانات العميل:', error);
                        customerAddress.textContent = 'حدث خطأ أثناء جلب بيانات العميل';
                        customerAddressContainer.style.display = 'block';
                    });
            } else {
                customerAddressContainer.style.display = 'none';
            }
        });
    }

    // تنفيذ تغيير العميل عند التحميل إذا كان هناك عميل محدد
    const customerSelectElement = document.getElementById('customer-select');
    if (customerSelectElement && customerSelectElement.value) {
        customerSelectElement.dispatchEvent(new Event('change'));
    }

    // تعيين معرف المعاينة للـ JavaScript (في حالة التعديل)
    {% if inspection %}
    if (typeof setCurrentInspectionId === 'function') {
        setCurrentInspectionId('{{ inspection.inspection_code }}');
    }

    // تحقق من حالة الرفع كل 3 ثوان إذا كان الملف لم يتم رفعه بعد
    {% if inspection.inspection_file and not inspection.is_uploaded_to_drive %}
    if (typeof checkUploadStatus === 'function') {
        checkUploadStatus('{{ inspection.inspection_code }}');
    }
    {% endif %}
    {% endif %}
});

// دالة محسنة للتحقق من حالة الرفع في الخلفية
function checkUploadStatus(inspectionId) {
    let attempts = 0;
    const maxAttempts = 20; // تقليل عدد المحاولات

    const interval = setInterval(function() {
        attempts++;

        fetch(`/inspections/${inspectionId}/check-upload-status/`)
            .then(response => response.json())
            .then(data => {
                if (data.is_uploaded && data.google_drive_url) {
                    // تم الرفع بنجاح
                    clearInterval(interval);
                    
                    // تحديث الواجهة بدون إعادة تحميل كامل
                    updateUploadStatus(true, data.google_drive_url);
                    
                    // عرض إشعار صامت في الزاوية
                    showQuietNotification('تم رفع الملف بنجاح إلى Google Drive', 'success');
                    
                } else if (attempts >= maxAttempts) {
                    // انتهت المحاولات
                    clearInterval(interval);
                }
            })
            .catch(error => {
                console.error('خطأ في التحقق من حالة الرفع:', error);
                if (attempts >= maxAttempts) {
                    clearInterval(interval);
                }
            });
    }, 3000); // كل 3 ثوان
}

// دالة لتحديث حالة الرفع في الواجهة
function updateUploadStatus(uploaded, url) {
    const uploadAlert = document.querySelector('.alert-info');
    if (uploadAlert && uploaded) {
        uploadAlert.className = 'alert alert-success py-2';
        uploadAlert.innerHTML = `
            <i class="fas fa-check-circle"></i>
            <strong>تم الرفع إلى Google Drive بنجاح!</strong>
            <br>
            <a href="${url}" target="_blank" class="btn btn-sm btn-primary mt-1">
                <i class="fab fa-google-drive"></i> عرض في Google Drive
            </a>
        `;
    }
}

// دالة لعرض إشعارات صامتة
function showQuietNotification(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `alert alert-${type} position-fixed`;
    toast.style.cssText = `
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        opacity: 0;
        transition: opacity 0.3s ease;
    `;
    toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
        ${message}
        <button type="button" class="btn-close float-end" onclick="this.parentElement.remove()"></button>
    `;
    
    document.body.appendChild(toast);
    
    // تدرج الظهور
    setTimeout(() => toast.style.opacity = '1', 100);
    
    // إخفاء تلقائي بعد 5 ثوان
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 5000);
}
</script>
{% endblock %}
