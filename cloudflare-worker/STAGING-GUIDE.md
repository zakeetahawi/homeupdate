# ๐งช ุฏููู ุงุณุชุฎุฏุงู Staging Worker

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก Worker ุงุฎุชุจุงุฑู ูุงูู ูุงุฎุชุจุงุฑ ุชุตููู ุนุฑุถ ุงูุฃุณุนุงุฑ ูุจู ูุจุนุฏ ุงูุฎุตู ูุจู ุงููุดุฑ ุนูู Production.

### ๐ฆ ุงููููุงุช ุงููุถุงูุฉ

```
cloudflare-worker/
โโโ src/
โ   โโโ index.js              # Production Worker (ุงูุฃุณุงุณู)
โ   โโโ index-test.js         # Test Worker (ุงุฎุชุจุงุฑ ูุญูู)
โ   โโโ index-staging.js      # Staging Worker (ุงุฎุชุจุงุฑ ูุจู ุงููุดุฑ) โจ ุฌุฏูุฏ
โโโ wrangler.toml             # Production config
โโโ wrangler-test.toml        # Test config
โโโ wrangler-staging.toml     # Staging config โจ ุฌุฏูุฏ
โโโ staging-dashboard.html    # ููุญุฉ ุชุญูู ุงูุงุฎุชุจุงุฑ โจ ุฌุฏูุฏ
โโโ package.json              # (ูุญุฏูุซ ุจู staging scripts)
```

---

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### 1. ุชุดุบูู Staging Worker ูุญููุงู

```bash
cd /home/zakee/homeupdate/cloudflare-worker
npm run staging:dev
```

**ุงููุชูุฌุฉ:** Worker ูุนูู ุนูู `http://localhost:8787`

**ูุซุงู:** ุงูุชุญ `http://localhost:8787/BERO-17` ูุฑุคูุฉ:
- ๐ด ุงูุณุนุฑ ูุจู ุงูุฎุตู: **507 ุฌ.ู** (ูุดุทูุจ ุจุงูุฃุญูุฑ)
- ๐ก ุงูุณุนุฑ ุงูุญุงูู: **390 ุฌ.ู** (ูุจูุฑ ูุฐูุจู)
- ๐ ูุนูููุงุช Debug: ุงููุนุงููุ ุงูุญุณุงุจุ ุงููุฆุฉ

---

### 2. ูุชุญ ููุญุฉ ุงูุชุญูู

```bash
# ุงูุชุญ ุงูููู ูู ุงููุชุตูุญ:
firefox staging-dashboard.html
# ุฃู
xdg-open staging-dashboard.html
```

**ูููุฒุงุช ุงูููุญุฉ:**
- โ ุงุฎุชุจุงุฑ ุฃู ููุชุฌ (BERO-17, WOOD-17, ุฅูุฎ)
- โ ุญุงุณุจุฉ ุงูุณุนุฑ ูุจู ุงูุฎุตู
- โ ููุงุฑูุฉ Staging vs Production (ูุงูุฐุชูู ุฌูุจุงู ูุฌูุจ)
- โ ุฒุฑ "ุงุนุชูุงุฏ ุงูุชุตููู" ูุน ุชุนูููุงุช ุงููุดุฑ

---

## ๐งฎ ููููุฉ ุญุณุงุจ ุงูุณุนุฑ ูุจู ุงูุฎุตู

| ุงูุณุนุฑ ุงูุญุงูู | ุงููุนุงูู | ุงููุณุจุฉ | ูุซุงู |
|--------------|---------|--------|------|
| 1 - 400 ุฌ.ู | ร1.35 | +35% | 300 โ 405 ุฌ.ู |
| 401 - 600 ุฌ.ู | ร1.30 | +30% | 390 โ 507 ุฌ.ู |
| 601 - 800 ุฌ.ู | ร1.25 | +25% | 700 โ 875 ุฌ.ู |
| 801+ ุฌ.ู | ร1.20 | +20% | 1000 โ 1200 ุฌ.ู |

**ุงูููุฏ:**
```javascript
function calculatePriceBeforeDiscount(currentPrice) {
  if (currentPrice <= 400) return currentPrice * 1.35;
  if (currentPrice <= 600) return currentPrice * 1.30;
  if (currentPrice <= 800) return currentPrice * 1.25;
  return currentPrice * 1.20;
}
```

---

## ๐ ุงุฎุชุจุงุฑ ุงูููุชุฌุงุช

### ุงุฎุชุจุงุฑ BERO-17 (ุงูุณุนุฑ ุงูุญูููู: 390 ุฌ.ู)

```bash
# ุดุบูู Staging Worker
npm run staging:dev

# ุงูุชุญ ูู ุงููุชุตูุญ:
# http://localhost:8787/BERO-17
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
๐งช STAGING

ุงูุณุนุฑ ูุจู ุงูุฎุตู: 507 ุฌ.ู (ูุดุทูุจ)
ุงูุณุนุฑ ุงูุญุงูู: 390 ุฌ.ู

๐ ูุนูููุงุช Debug:
- ุงูุณุนุฑ ุงูุญุงูู: 390 ุฌ.ู
- ุงููุนุงูู: 1.30 (ูุฆุฉ 401-600 ุฌ.ู)
- ุงูุณุนุฑ ูุจู ุงูุฎุตู: 507 ุฌ.ู
```

### ุงุฎุชุจุงุฑ ููุชุฌุงุช ุฃุฎุฑู

```bash
# ููุชุฌ ุฑุฎูุต (ูุฆุฉ 1-400)
http://localhost:8787/PROD-100  # ุณุนุฑ 100 โ 135 ุฌ.ู ูุจู ุงูุฎุตู

# ููุชุฌ ูุชูุณุท (ูุฆุฉ 401-600)
http://localhost:8787/BERO-17   # ุณุนุฑ 390 โ 507 ุฌ.ู

# ููุชุฌ ุบุงูู (ูุฆุฉ 601-800)
http://localhost:8787/PROD-700  # ุณุนุฑ 700 โ 875 ุฌ.ู

# ููุชุฌ VIP (ูุฆุฉ 801+)
http://localhost:8787/PROD-1000 # ุณุนุฑ 1000 โ 1200 ุฌ.ู
```

---

## ๐ ููุงุฑูุฉ Staging vs Production

### ุงูุทุฑููุฉ ุงููุฏููุฉ

```bash
# Terminal 1: ุดุบูู Staging
npm run staging:dev

# Terminal 2: ุงูุชุธุฑ (Production ููุฌูุฏ ุจุงููุนู)
# https://qr.elkhawaga.uk

# ุงูุชุญ ุงููุชุตูุญ:
# Staging:    http://localhost:8787/BERO-17
# Production: https://qr.elkhawaga.uk/BERO-17
```

### ุงูุทุฑููุฉ ุงูุณููุฉ (ููุญุฉ ุงูุชุญูู)

1. ุงูุชุญ `staging-dashboard.html`
2. ุงูุชุจ `BERO-17` ูู ุญูู "ููุงุฑูุฉ ุณุฑูุนุฉ"
3. ุงุถุบุท "ูุชุญ ุงูููุงุฑูุฉ"
4. ุณุชููุชุญ ูุงูุฐุชุงู ุฌูุจุงู ูุฌูุจ:
   - ๐งช Staging (ูุณุงุฑ) - ูุน ุงูุณุนุฑ ูุจู ุงูุฎุตู
   - ๐ Production (ูููู) - ุจุฏูู ุงูุณุนุฑ ูุจู ุงูุฎุตู

---

## โ ุงููุดุฑ ุนูู Production (ุนูุฏ ุงูุงุนุชูุงุฏ)

### โ๏ธ ููู: ุงุณุชุฎุฏู ููู Production ุงููุธูู!

**โ ุงูุทุฑููุฉ ุงูุตุญูุญุฉ:**
```bash
cd /home/zakee/homeupdate/cloudflare-worker

# ุงุณุชุฎุฏู ููู Production ุงููุธูู (ุจุฏูู staging badge ู debug)
cp src/index-production.js src/index.js

# ูุดุฑ ุนูู Cloudflare
npm run deploy:prod
```

**โ ูุง ุชุณุชุฎุฏู:**
```bash
# ุฎุทุฃ! index-staging.js ููู ูุนูููุงุช ุงุฎุชุจุงุฑ
cp src/index-staging.js src/index.js  # โ ุฎุทุฃ
```

---

### ุงูุฎุทูุฉ 1: ุงูุชุฃูุฏ ูู ุงูุงุฎุชุจุงุฑ

```bash
# ุงุฎุชุจุฑ ุนูู ุงูุฃูู 5 ููุชุฌุงุช ูุฎุชููุฉ:
- BERO-17 (390 ุฌ.ู โ 507 ุฌ.ู)
- ููุชุฌ ุฑุฎูุต < 400
- ููุชุฌ ูุชูุณุท 401-600
- ููุชุฌ ุบุงูู 601-800
- ููุชุฌ VIP > 801
```

### ุงูุฎุทูุฉ 2: ุงููุณุฎ ูุงููุดุฑ (ุงูุทุฑููุฉ ุงูุขููุฉ)

```bash
cd /home/zakee/homeupdate/cloudflare-worker

# ูุณุฎ ููู Production ุงููุธูู (ุจุฏูู staging badge)
cp src/index-production.js src/index.js

# ูุดุฑ ุนูู Cloudflare
npm run deploy:prod
```

### ุงูุฎุทูุฉ 3: ุงูุชุญูู

```bash
# ุงูุชุญ ุงููุชุตูุญ:
https://qr.elkhawaga.uk/BERO-17

# ุชุฃูุฏ ูู:
# โ ุงูุณุนุฑ ูุจู ุงูุฎุตู: 507 ุฌ.ู (ุจุฎุท ูุงุฆู ุฃุญูุฑ)
# โ ุงูุณุนุฑ ุงูุญุงูู: 390 ุฌ.ู
# โ ูุง ุชูุฌุฏ ุดุงุฑุฉ ๐งช STAGING
# โ ูุง ุชูุฌุฏ ูุนูููุงุช Debug
```

---

### ๐ ุงูุถูุงู

**ููู `index-production.js` ูุธูู 100%:**
- โ ูุง ุชูุฌุฏ Staging Badge
- โ ูุง ุชูุฌุฏ Debug Info
- โ ููุท ุงูุณุนุฑ ูุจู ูุจุนุฏ ุงูุฎุตู (ุงุญุชุฑุงูู)

**ุงุทููุน ุนูู:** [PRODUCTION-DEPLOYMENT.md](PRODUCTION-DEPLOYMENT.md) ููุฒูุฏ ูู ุงูุชูุงุตูู

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### โ Worker ูุง ูุนูู

```bash
# ุชุฃูุฏ ูู ุชุซุจูุช wrangler
npm install

# ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู ุฅูู Cloudflare
npx wrangler whoami

# ุฅุฐุง ูู ุชุณุฌูุ ุณุฌูู:
npx wrangler login
```

### โ ุงูููุชุฌ ูุนุทู 404

```bash
# ุชุญูู ูู ูุฌูุฏ ุงูููุชุฌ ูู KV:
npx wrangler kv:key get "BERO-17" \
  --namespace-id=5dad2f4d72b246758bdafa17dfe4eb10

# ุฅุฐุง ูู ููุฌุฏุ ุงุฑูุนู ูู Django:
# ุฒุฑ "ุฑูุน ููููุงูุฏ ูููุฑ" ูู ุตูุญุฉ ุงูููุชุฌ
```

### โ ุงูุณุนุฑ ุฎุงุทุฆ

```bash
# ุงุณุชุฎุฏู ุญุงุณุจุฉ ุงูุณุนุฑ ูู staging-dashboard.html
# ุชุฃูุฏ ูู:
# - ุงูุณุนุฑ ุงูุญุงูู ุตุญูุญ ูู KV
# - ุงููุนุงูู ุงููุณุชุฎุฏู ุตุญูุญ (1.35, 1.30, 1.25, 1.20)
```

---

## ๐ ูุตุงุฆุญ

### โจ ุฃูุถู ููุงุฑุณุฉ

1. **ุงุฎุชุจุฑ ุฏุงุฆูุงู ุนูู Staging ูุจู Production**
   ```bash
   npm run staging:dev  # ุงุฎุชุจุฑ ุฃููุงู
   npm run deploy:prod  # ุงูุดุฑ ุจุนุฏ ุงูุชุฃูุฏ
   ```

2. **ุงุณุชุฎุฏู ููุญุฉ ุงูุชุญูู ููููุงุฑูุฉ**
   - ุงูุชุญ `staging-dashboard.html`
   - ูุงุฑู Staging vs Production ุฌูุจุงู ูุฌูุจ

3. **ุงุฎุชุจุฑ ูุฆุงุช ุงูุฃุณุนุงุฑ ุงูุฃุฑุจุนุฉ**
   - < 400 (ร1.35)
   - 401-600 (ร1.30)
   - 601-800 (ร1.25)
   - 801+ (ร1.20)

### ๐ฏ ููุฏ ูููุฏ

```bash
# ุชุดุบูู Staging (ูุญูู + KV ุญูููู)
npm run staging:dev

# ุชุดุบูู Staging (ูุญูู ููุทุ ุจุฏูู KV)
npm run staging:dev:local

# ูุดุฑ Staging ุนูู Cloudflare (ูู ุชุฑูุฏ URL ุนุงู)
npm run staging:deploy

# ูุฑุงูุจุฉ Logs
npm run tail:staging
```

---

## ๐จ ุงููุฑููุงุช ุจูู Workers

| Feature | Production | Staging | Test |
|---------|-----------|---------|------|
| Badge | โ ูุง ููุฌุฏ | ๐ด STAGING | ๐ก TEST |
| Debug Info | โ ูุง | โ ูุนู | โ ูุนู |
| ุงูุณุนุฑ ูุจู ุงูุฎุตู | โ ูุง | โ ูุนู | โ ูุนู |
| KV | โ ุญูููู | โ ุญูููู | โ ุญูููู |
| URL | qr.elkhawaga.uk | localhost:8787 | localhost:8787 |

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดููุฉ:
1. ุชุญูู ูู `npm run staging:dev` ูุนูู
2. ุงูุชุญ Console ูู ุงููุชุตูุญ (F12)
3. ุชุญูู ูู `staging-dashboard.html` โ ุญุงุณุจุฉ ุงูุณุนุฑ
4. ูุงุฑู ูุน Production

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2024
**ุงูุฅุตุฏุงุฑ:** 1.0.0
