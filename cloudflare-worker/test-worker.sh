#!/bin/bash

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Cloudflare Worker - ุงุฎุชุจุงุฑ ุณุฑูุน
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo "๐งช ุงุฎุชุจุงุฑ Cloudflare Worker ููููุชุฌุงุช"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

# ุงูุงูุชูุงู ููุฌูุฏ Worker
cd "$(dirname "$0")"

echo ""
echo "ุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "1) ุงุฎุชุจุงุฑ ูุญูู (Local Dev)"
echo "2) ูุดุฑ ุนูู ุจูุฆุฉ ุงูุชุทููุฑ (Dev)"
echo "3) ูุดุฑ ุนูู ุจูุฆุฉ ุงูุงุฎุชุจุงุฑ (Staging)"
echo "4) ุนุฑุถ Logs ูุจุงุดุฑุฉ"
echo "5) ุงุฎุชุจุงุฑ ููุชุฌ ูุญุฏุฏ"
echo "6) ุฎุฑูุฌ"
echo ""

read -p "ุงุฎุชุฑ ุฑูู (1-6): " choice

case $choice in
  1)
    echo ""
    echo "๐ ุชุดุบูู Worker ูุญููุงู..."
    echo "ุณูุนูู ุนูู: http://localhost:8787/{product_code}"
    echo "ููุฅููุงู: ุงุถุบุท Ctrl+C"
    echo ""
    npm run test:dev
    ;;
    
  2)
    echo ""
    echo "๐ค ูุดุฑ ุนูู ุจูุฆุฉ ุงูุชุทููุฑ..."
    npm run test:deploy
    echo ""
    echo "โ ุชู ุงููุดุฑ! ุฌุฑุจ: https://elkhawaga-qr-test.workers.dev/TEST001"
    ;;
    
  3)
    echo ""
    echo "๐ค ูุดุฑ ุนูู ุจูุฆุฉ ุงูุงุฎุชุจุงุฑ (Staging)..."
    npm run test:staging
    echo ""
    echo "โ ุชู ุงููุดุฑ! ุฌุฑุจ: https://test-qr.elkhawaga.uk/TEST001"
    echo "ููุงุญุธุฉ: ุชุฃูุฏ ูู ุฅุนุฏุงุฏ subdomain ูู Cloudflare DNS ุฃููุงู"
    ;;
    
  4)
    echo ""
    echo "๐ ุนุฑุถ Logs ูุจุงุดุฑุฉ..."
    echo "ููุฅููุงู: ุงุถุบุท Ctrl+C"
    echo ""
    npm run tail:test
    ;;
    
  5)
    echo ""
    read -p "ุฃุฏุฎู ููุฏ ุงูููุชุฌ ููุงุฎุชุจุงุฑ: " product_code
    
    if [ -z "$product_code" ]; then
      echo "โ ูุฌุจ ุฅุฏุฎุงู ููุฏ ุงูููุชุฌ"
      exit 1
    fi
    
    echo ""
    echo "ุงุฎุชุฑ ุงูุจูุฆุฉ:"
    echo "1) ูุญูู (localhost:8787)"
    echo "2) ุชุทููุฑ (workers.dev)"
    echo "3) ุงุฎุชุจุงุฑ (test-qr.elkhawaga.uk)"
    echo ""
    read -p "ุงุฎุชุฑ (1-3): " env_choice
    
    case $env_choice in
      1)
        url="http://localhost:8787/$product_code"
        ;;
      2)
        url="https://elkhawaga-qr-test.workers.dev/$product_code"
        ;;
      3)
        url="https://test-qr.elkhawaga.uk/$product_code"
        ;;
      *)
        echo "โ ุงุฎุชูุงุฑ ุบูุฑ ุตุญูุญ"
        exit 1
        ;;
    esac
    
    echo ""
    echo "๐ ูุชุญ ุงูุฑุงุจุท: $url"
    
    # ูุชุญ ูู ุงููุชุตูุญ (ุญุณุจ ุงููุธุงู)
    if command -v xdg-open > /dev/null; then
      xdg-open "$url"
    elif command -v open > /dev/null; then
      open "$url"
    else
      echo "ุงูุฑุงุจุท: $url"
      echo "ุงูุชุญู ูุฏููุงู ูู ุงููุชุตูุญ"
    fi
    ;;
    
  6)
    echo "๐ ุฅูู ุงูููุงุก!"
    exit 0
    ;;
    
  *)
    echo "โ ุงุฎุชูุงุฑ ุบูุฑ ุตุญูุญ"
    exit 1
    ;;
esac
