# ๐ง ุญู ูุดููุฉ ุฎุทุฃ 400 ูู wizard/add-curtain

## ุงููุดููุฉ
```
Failed to load resource: the server responded with a status of 400 (Bad Request)
POST /orders/wizard/add-curtain/
```

## ุงูุฃุณุจุงุจ ุงููุญุชููุฉ ูุงูุญููู

### 1. ุงูุชุญูู ูู ูุฌูุฏ ูุณูุฏุฉ ูุดุทุฉ โ

**ุงููุดููุฉ:** ูุง ุชูุฌุฏ ูุณูุฏุฉ ุทูุจ ูุดุทุฉ ูููุณุชุฎุฏู ุงูุญุงูู.

**ุงูุญู:**
```python
# ุชุญูู ูู ูุฌูุฏ ูุณูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
python manage.py shell
>>> from orders.wizard_models import DraftOrder
>>> from django.contrib.auth import get_user_model
>>> User = get_user_model()
>>> user = User.objects.get(username='zakee.tahawi')
>>> drafts = DraftOrder.objects.filter(created_by=user, is_completed=False)
>>> print(f"Active drafts: {drafts.count()}")
```

**ุฅุฐุง ูู ุชูุฌุฏ ูุณูุฏุฉ:**
- ุงุฑุฌุน ููููุฒุงุฑุฏ ูุงููุฃ ุงูุฎุทูุงุช ูู 1 ุฅูู 4
- ุฃู ุฃูุดุฆ ูุณูุฏุฉ ุฌุฏูุฏุฉ

---

### 2. ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงูููุฑุณูุฉ โ

**ุงููุดููุฉ:** ุงูุจูุงูุงุช ุงูููุฑุณูุฉ ุบูุฑ ุตุญูุญุฉ ุฃู ูุงูุตุฉ.

**ุงูุจูุงูุงุช ุงููุทููุจุฉ:**
```javascript
{
    "room_name": "ุบุฑูุฉ ุงูููู",      // ูุทููุจ
    "width": 3.5,                   // ูุทููุจ > 0
    "height": 2.8,                  // ูุทููุจ > 0
    "fabrics": [                    // ุงุฎุชูุงุฑู
        {
            "type": "light",        // light, heavy, blackout
            "item_id": 123,         // ID ูู DraftOrderItem
            "name": "ููุงุด ุดุงููู",
            "meters": 45,
            "pieces": 2,
            "tailoring": "rings"    // ุงุฎุชูุงุฑู
        }
    ],
    "accessories": [                // ุงุฎุชูุงุฑู
        {
            "name": "ูุฌุฑู",
            "quantity": 2,
            "notes": ""
        }
    ]
}
```

---

### 3. ุงูุชุญูู ูู ุนูุงุตุฑ ุงููุงุชูุฑุฉ โ

**ุงููุดููุฉ:** ูุง ุชูุฌุฏ ุนูุงุตุฑ ูู ุงููุงุชูุฑุฉ (draft.items).

**ุงูุญู:**
```python
# ุชุญูู ูู ุนูุงุตุฑ ุงููุณูุฏุฉ
>>> draft = DraftOrder.objects.filter(created_by=user, is_completed=False).first()
>>> print(f"Draft items: {draft.items.count()}")
>>> for item in draft.items.all():
...     print(f"  - {item.product.name}: {item.quantity}")
```

**ุฅุฐุง ูู ุชูุฌุฏ ุนูุงุตุฑ:**
1. ุงุฑุฌุน ููุฎุทูุฉ 3 (ุนูุงุตุฑ ุงูุทูุจ)
2. ุฃุถู ุฃููุดุฉ ูููุงุชูุฑุฉ
3. ุซู ุงุฑุฌุน ููุฎุทูุฉ 5 (ุงูุนูุฏ)

---

### 4. ูุญุต ุงูุณุฌูุงุช (Logs) โ

**ุนุฑุถ ุขุฎุฑ 50 ุณุทุฑ ูู ุงูุณุฌูุงุช:**
```bash
cd /home/zakee/homeupdate
tail -50 logs/django.log | grep -A 10 "wizard/add-curtain"
```

**ุงูุจุญุซ ุนู ุฑุณุงุฆู ุงูุฎุทุฃ:**
```bash
grep "ERROR.*wizard_add_curtain" logs/django.log | tail -20
```

---

## ๐ ุงูุชุดุฎูุต ุงูุฏููู

### ุงูุฎุทูุฉ 1: ุชูุนูู ูุถุน ุงูุชุตุญูุญ ุงูููุญุณูู

ุชู ุฅุถุงูุฉ ุชุณุฌูู ุชูุตููู ูู ุงูุฏุงูุฉ `wizard_add_curtain`:

```python
# ุณูุชู ุชุณุฌูู:
- ุงูุจูุงูุงุช ุงูููุณุชููุฉ
- ุฃุฎุทุงุก JSON
- ูุนูููุงุช ุงููุณูุฏุฉ
- ุชูุงุตูู ุงูุฃููุดุฉ ูุงูุฅูุณุณูุงุฑุงุช
```

### ุงูุฎุทูุฉ 2: ุงูุชุญ ุงูููุฒุงุฑุฏ ูุฌุฑูุจ ูุฑุฉ ุฃุฎุฑู

1. ุงูุชุญ: `http://127.0.0.1:8000/orders/wizard/step/5/`
2. ุงุถุบุท "ุฅุถุงูุฉ ุณุชุงุฑุฉ ุฌุฏูุฏุฉ"
3. ุงููุฃ ุงูุจูุงูุงุช
4. ุฑุงูุจ Console ูู ุงููุชุตูุญ (F12)
5. ุฑุงูุจ `logs/django.log` ูู ููุณ ุงูููุช

### ุงูุฎุทูุฉ 3: ุงูุญุต ุงุณุชุฌุงุจุฉ ุงูุฎุงุฏู

ูู Console ุงููุชุตูุญ:
```javascript
// ุณุชุฑู ุงูุงุณุชุฌุงุจุฉ ุงููุงููุฉ
{
    "success": false,
    "message": "ุฑุณุงูุฉ ุงูุฎุทุฃ ููุง"
}
```

---

## ๐ฏ ุงูุญููู ุงูุณุฑูุนุฉ

### ุงูุญู 1: ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
```
Ctrl + F5 (ุฃู Cmd + Shift + R ุนูู Mac)
```

### ุงูุญู 2: ูุณุญ ุงูู Cache
```javascript
// ูู Console ุงููุชุตูุญ
localStorage.clear();
sessionStorage.clear();
location.reload();
```

### ุงูุญู 3: ุงูุจุฏุก ูู ุฌุฏูุฏ
```
1. ุงุญุฐู ุงููุณูุฏุฉ ุงูุญุงููุฉ (ุฅุฐุง ูุงูุช ูุงุณุฏุฉ)
2. ุงุจุฏุฃ ููุฒุงุฑุฏ ุฌุฏูุฏ
3. ุฃููู ุฌููุน ุงูุฎุทูุงุช ุจุงูุชุฑุชูุจ
```

---

## ๐ ุญุงูุงุช ุงูุฎุทุฃ ุงูุดุงุฆุนุฉ ูุฑุณุงุฆููุง

| ุฑุณุงูุฉ ุงูุฎุทุฃ | ุงูุณุจุจ | ุงูุญู |
|-------------|-------|------|
| `ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงูุบุฑูุฉ` | room_name ูุงุฑุบ | ุงููุฃ ุงุณู ุงูุบุฑูุฉ |
| `ูุฑุฌู ุฅุฏุฎุงู ุงูุนุฑุถ ูุงูุงุฑุชูุงุน` | width ุฃู height ุบูุฑ ููุฌูุฏ | ุงููุฃ ุงูููุงุณุงุช |
| `ูุฌุจ ุฃู ุชููู ุงูููู ุฃูุจุฑ ูู ุตูุฑ` | width ุฃู height <= 0 | ุฃุฏุฎู ููู ููุฌุจุฉ |
| `ููู ุบูุฑ ุตุญูุญุฉ ููุนุฑุถ ุฃู ุงูุงุฑุชูุงุน` | width ุฃู height ููุณ ุฑููุงู | ุฃุฏุฎู ุฃุฑูุงูุงู ููุท |
| `ูุฑุฌู ุงุฎุชูุงุฑ ุงูููุงุด ูู ุงููุงุชูุฑุฉ` | item_id ูุงุฑุบ | ุงุฎุชุฑ ููุงุดุงู ูู ุงููุงุฆูุฉ |
| `ุงููููุฉ ุงููุทููุจุฉ ุฃูุจุฑ ูู ุงููุชุงุญ` | ุชุฌุงูุฒ ุงููููุฉ ุงููุชููุฑุฉ | ููู ุงููููุฉ |
| `ุฎุทุฃ ูู ุชูุณูู ุงูุจูุงูุงุช` | JSON ุบูุฑ ุตุญูุญ | ุชุญูู ูู ุงูุจูุงูุงุช ุงูููุฑุณูุฉ |

---

## ๐๏ธ ุงูุฅุตูุงุญุงุช ุงูููุทุจูุฉ

ุชู ุชุญุณูู ุฏุงูุฉ `wizard_add_curtain` ุจู:

1. โ ูุนุงูุฌุฉ ุฃูุถู ูุฃุฎุทุงุก JSON
2. โ ุชุณุฌูู ุชูุตููู ููุจูุงูุงุช ุงูููุณุชููุฉ
3. โ ุฑุณุงุฆู ุฎุทุฃ ุฃูุถุญ
4. โ ูุนูููุงุช ุชุตุญูุญ ุฅุถุงููุฉ ูู ุงูุณุฌูุงุช

---

## ๐งช ุงุฎุชุจุงุฑ ูุฏูู

### ุงุฎุชุจุงุฑ 1: ุจุฏูู ุฃููุดุฉ
```javascript
fetch('/orders/wizard/add-curtain/', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify({
        room_name: "ุงุฎุชุจุงุฑ",
        width: 3.0,
        height: 2.5,
        fabrics: [],
        accessories: []
    })
})
.then(r => r.json())
.then(d => console.log(d));
```

### ุงุฎุชุจุงุฑ 2: ูุน ููุงุด ูุงุญุฏ
```javascript
// ุงูุชุฑุถ ุฃู item_id = 123 ููุฌูุฏ ูู draft.items
fetch('/orders/wizard/add-curtain/', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify({
        room_name: "ุบุฑูุฉ ุงูููู",
        width: 3.5,
        height: 2.8,
        fabrics: [
            {
                type: "light",
                item_id: 123,
                name: "ููุงุด ุดุงููู",
                meters: 10,
                pieces: 2,
                tailoring: "rings"
            }
        ],
        accessories: []
    })
})
.then(r => r.json())
.then(d => console.log(d));
```

---

## ๐ ูุตุงุฆุญ ููุชุทููุฑ

### 1. ุฏุงุฆูุงู ุงูุญุต ุงูุณุฌูุงุช ุฃููุงู
```bash
tail -f logs/django.log
```

### 2. ุงุณุชุฎุฏู Network Tab ูู ุงููุชุตูุญ
- ุงูุชุญ F12 โ Network
- ุฃุนุฏ ุฅุฑุณุงู ุงูุทูุจ
- ุงููุฑ ุนูู ุงูุทูุจ ุงููุงุดู
- ุงูุฑุฃ Response

### 3. ุชุญูู ูู CSRF Token
```javascript
// ูู Console
console.log(document.cookie);
// ูุฌุจ ุฃู ุชุฑู csrftoken
```

---

## โ ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ

ูุจู ุงูุฅุจูุงุบ ุนู ุฎุทุฃุ ุชุฃูุฏ ูู:

- [ ] ูุฌูุฏ ูุณูุฏุฉ ูุดุทุฉ
- [ ] ุฅุถุงูุฉ ุนูุงุตุฑ ูู ุงูุฎุทูุฉ 3
- [ ] ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ
- [ ] ุงุณุชุฎุฏุงู ููู ุตุญูุญุฉ (ุฃุฑูุงู ููุฌุจุฉ)
- [ ] ุงุฎุชูุงุฑ ุงูููุงุด ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
- [ ] ูุญุต Console ูู ุงููุชุตูุญ
- [ ] ูุญุต logs/django.log
- [ ] ูุณุญ Cache ูุฅุนุงุฏุฉ ุงููุญุงููุฉ

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-11-22  
**ุงูุญุงูุฉ:** ุชู ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก โ
