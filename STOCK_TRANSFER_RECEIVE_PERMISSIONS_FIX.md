# ุฅุตูุงุญ ุตูุงุญูุงุช ุงุณุชูุงู ุงูุชุญูููุงุช ุงููุฎุฒููุฉ

## ๐ ุงููุดููุฉ

ุงููุณุชุฎุฏู ุงูุฐู **ุฃูุดุฃ** ุงูุชุญููู ุงููุฎุฒูู ูุงู ูุณุชุทูุน ุฃูุถุงู **ุงุณุชูุงูู** ูู ุงููุณุชูุฏุน ุงููุณุชูุฏูุ ููุฐุง ูุฎูู ุชุถุงุฑุจ ูุตุงูุญ ููุฎุงูู ูุจุฏุฃ ุงููุตู ุจูู ุงูุฃุฏูุงุฑ (Separation of Duties).

### ูุซุงู ุนูู ุงููุดููุฉ:
- ุงููุณุชุฎุฏู **bafli** (ููุธู ูุณุชูุฏุน "ุจุงููู") ููุดุฆ ุชุญููู ูู "ุจุงููู" โ "ุณุนุฏ"
- **bafli** ูุงู ูุณุชุทูุน ุงุณุชูุงู ูุฐุง ุงูุชุญููู ูู ูุณุชูุฏุน "ุณุนุฏ"
- ูุฐุง ุบูุฑ ุตุญูุญ ูุฃูู ูุฌุจ ุฃู ูููู ููุงู ุดุฎุต ุขุฎุฑ ูุชุญูู ูู ุงูุชุญููู ููุณุชููู

---

## โ ุงูุญู ุงููุทุจู

ุชู ุฅุถุงูุฉ ูููุฏ ุนูู ุงุณุชูุงู ุงูุชุญูููุงุช ุงููุฎุฒููุฉ:

### ุงูููุงุนุฏ ุงูุฌุฏูุฏุฉ:

#### โ ูู ููููู ุงุณุชูุงู ุงูุชุญููู:
1. **ููุธู ุงููุณุชูุฏุน ุงููุณุชูุฏู** (ุฅุฐุง ูู ููู ูู ููุดุฆ ุงูุชุญููู)
2. **ุงููุฏูุฑ (superuser)** - ููููู ุงุณุชูุงู ุฃู ุชุญููู

#### โ ูู ูุง ููููู ุงุณุชูุงู ุงูุชุญููู:
1. **ููุดุฆ ุงูุชุญููู** - ุญุชู ูู ูุงู ููุธู ุงููุณุชูุฏุน ุงููุณุชูุฏู
2. **ููุธู ูุณุชูุฏุน ุขุฎุฑ** - ููุณ ุงููุณุชูุฏุน ุงููุณุชูุฏู

---

## ๐ง ุงูุชุนุฏููุงุช ุงูุชูููุฉ

### 1. Backend - `inventory/views_stock_transfer.py`

#### ุฃ. ุชุนุฏูู `stock_transfer_receive()` (ุงูุณุทูุฑ 359-387)

**ุงูุฅุถุงูุงุช:**
- โ ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ููุณ ููุดุฆ ุงูุชุญููู
- โ ุงูุชุญูู ูู ุฃู ููุธู ุงููุณุชูุฏุน ูุณุชูู ููุท ุชุญูููุงุช ุฅูู ูุณุชูุฏุนู ุงููุฎุตุต
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู

**ุงูููุฏ:**
```python
@login_required
def stock_transfer_receive(request, pk):
    """ุงุณุชูุงู ุงูุชุญููู"""
    transfer = get_object_or_404(StockTransfer, pk=pk)
    
    if not transfer.can_complete:
        messages.error(request, 'ูุง ูููู ุงุณุชูุงู ูุฐุง ุงูุชุญููู')
        return redirect('inventory:stock_transfer_detail', pk=pk)
    
    # โ ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุงุณุชูุงู
    user = request.user
    
    # 1. ููุน ููุดุฆ ุงูุชุญููู ูู ุงุณุชูุงูู
    if transfer.created_by == user:
        messages.error(request, 'ูุง ููููู ุงุณุชูุงู ุชุญููู ููุช ุจุฅูุดุงุฆู ุจููุณู')
        return redirect('inventory:stock_transfer_detail', pk=pk)
    
    # 2. ููุธู ุงููุณุชูุฏุน ููููู ููุท ุงุณุชูุงู ุชุญููู ุฅูู ูุณุชูุฏุนู ุงููุฎุตุต
    if hasattr(user, 'is_warehouse_staff') and user.is_warehouse_staff and not user.is_superuser:
        if not user.assigned_warehouse:
            messages.error(request, 'ูุง ููุฌุฏ ูุณุชูุฏุน ูุฎุตุต ูู')
            return redirect('inventory:stock_transfer_detail', pk=pk)
        
        if transfer.to_warehouse.id != user.assigned_warehouse.id:
            messages.error(
                request, 
                f'ูุง ููููู ุงุณุชูุงู ูุฐุง ุงูุชุญููู. ููููู ููุท ุงุณุชูุงู ุงูุชุญูููุงุช ุงูููุฌูุฉ ุฅูู ูุณุชูุฏุนู ({user.assigned_warehouse.name})'
            )
            return redirect('inventory:stock_transfer_detail', pk=pk)
    
    # ... ุจุงูู ุงูููุฏ (ูุนุงูุฌุฉ ุงูุงุณุชูุงู)
```

#### ุจ. ุชุนุฏูู `stock_transfer_detail()` (ุงูุณุทูุฑ 259-299)

**ุงูุฅุถุงูุงุช:**
- โ ุญุณุงุจ ูุชุบูุฑ `can_receive` ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ููููู ุงูุงุณุชูุงู
- โ ุชูุฑูุฑ ุงููุชุบูุฑ ุฅูู Template

**ุงูููุฏ:**
```python
@login_required
def stock_transfer_detail(request, pk):
    """ุชูุงุตูู ุงูุชุญููู ุงููุฎุฒูู"""
    transfer = get_object_or_404(
        StockTransfer.objects.select_related(
            'from_warehouse', 'to_warehouse', 'created_by',
            'approved_by', 'completed_by'
        ).prefetch_related('items__product'),
        pk=pk
    )
    
    # ุญุฑูุงุช ุงููุฎุฒูู ุงููุฑุชุจุทุฉ
    stock_transactions = StockTransaction.objects.filter(
        reference=transfer.transfer_number
    ).select_related('product', 'warehouse', 'created_by')
    
    # โ ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุงุณุชูุงู
    user = request.user
    can_receive = False
    
    if transfer.can_complete:
        # ุงููุฏูุฑ ููููู ุงูุงุณุชูุงู ุฏุงุฆูุงู
        if user.is_superuser:
            can_receive = True
        # ููุน ููุดุฆ ุงูุชุญููู ูู ุงูุงุณุชูุงู
        elif transfer.created_by != user:
            # ููุธู ุงููุณุชูุฏุน ููููู ุงูุงุณุชูุงู ููุท ุฅุฐุง ูุงู ุงูุชุญููู ุฅูู ูุณุชูุฏุนู
            if hasattr(user, 'is_warehouse_staff') and user.is_warehouse_staff:
                if user.assigned_warehouse and transfer.to_warehouse.id == user.assigned_warehouse.id:
                    can_receive = True
            else:
                # ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู ูููููู ุงูุงุณุชูุงู
                can_receive = True
    
    context = {
        'transfer': transfer,
        'stock_transactions': stock_transactions,
        'can_receive': can_receive,  # โ ูุชุบูุฑ ุฌุฏูุฏ
    }
    
    return render(request, 'inventory/stock_transfer_detail.html', context)
```

---

### 2. Frontend - `inventory/templates/inventory/stock_transfer_detail.html`

#### ุชุนุฏูู ุฒุฑ ุงูุงุณุชูุงู (ุงูุณุทูุฑ 261-276)

**ุงูุชุบููุฑ:**
- โ ุฅุธูุงุฑ ุฒุฑ "ุงุณุชูุงู ุงูุชุญููู" ููุท ุฅุฐุง ูุงู `can_receive = True`
- โ ุฅุธูุงุฑ ุฒุฑ ูุนุทู ูุน ุฑุณุงูุฉ "ุบูุฑ ูุตุฑุญ" ุฅุฐุง ูุงู `can_receive = False`

**ุงูููุฏ:**
```html
{% elif transfer.status == 'approved' or transfer.status == 'in_transit' %}
{% if can_receive %}
<a href="{% url 'inventory:stock_transfer_receive' transfer.pk %}" class="btn btn-success w-100 mb-2">
    <i class="fas fa-check-circle"></i>
    ุงุณุชูุงู ุงูุชุญููู
</a>
{% else %}
<button type="button" class="btn btn-secondary w-100 mb-2" disabled title="ูุง ููููู ุงุณุชูุงู ูุฐุง ุงูุชุญููู">
    <i class="fas fa-lock"></i>
    ุงุณุชูุงู ุงูุชุญููู (ุบูุฑ ูุตุฑุญ)
</button>
{% endif %}
<button type="button" class="btn btn-danger w-100" data-bs-toggle="modal" data-bs-target="#cancelModal">
    <i class="fas fa-times"></i>
    ุฅูุบุงุก ุงูุชุญููู
</button>
```

---

## ๐ ุงูุณููุงุฑูููุงุช

### ุงูุณููุงุฑูู 1: bafli ููุดุฆ ุชุญููู ูู ูุณุชูุฏุนู ุฅูู ูุณุชูุฏุน ุขุฎุฑ

**ุงูุชูุงุตูู:**
- ูู: ุจุงููู
- ุฅูู: ุณุนุฏ
- ููุดุฆ ุงูุชุญููู: bafli

**ูู ููููู ุงูุงุณุชูุงูุ**
- โ **bafli** - ููุดุฆ ุงูุชุญููู (ููููุน)
- โ **ููุธู ูุณุชูุฏุน "ุณุนุฏ"** - ุงููุณุชูุฏุน ุงููุณุชูุฏู (ูุณููุญ)
- โ **ุงููุฏูุฑ (superuser)** - ุตูุงุญูุงุช ูุงููุฉ (ูุณููุญ)

---

### ุงูุณููุงุฑูู 2: ูุณุชุฎุฏู ุขุฎุฑ ููุดุฆ ุชุญููู ุฅูู ูุณุชูุฏุน bafli

**ุงูุชูุงุตูู:**
- ูู: ุณุนุฏ
- ุฅูู: ุจุงููู
- ููุดุฆ ุงูุชุญููู: ูุณุชุฎุฏู ุขุฎุฑ

**ูู ููููู ุงูุงุณุชูุงูุ**
- โ **bafli** - ููุธู ุงููุณุชูุฏุน ุงููุณุชูุฏู (ูุณููุญ)
- โ **ุงููุฏูุฑ (superuser)** - ุตูุงุญูุงุช ูุงููุฉ (ูุณููุญ)
- โ **ููุดุฆ ุงูุชุญููู** - ุญุชู ูู ูุงู ููุธู ูุณุชูุฏุน (ููููุน)

---

### ุงูุณููุงุฑูู 3: bafli ูุญุงูู ุงุณุชูุงู ุชุญููู ุฅูู ูุณุชูุฏุน ุขุฎุฑ

**ุงูุชูุงุตูู:**
- ูู: ุณุนุฏ
- ุฅูู: ูุฑุด
- ููุดุฆ ุงูุชุญููู: ูุณุชุฎุฏู ุขุฎุฑ

**ูู ููููู ุงูุงุณุชูุงูุ**
- โ **bafli** - ููุณ ุงููุณุชูุฏุน ุงููุณุชูุฏู (ููููุน)
- โ **ููุธู ูุณุชูุฏุน "ูุฑุด"** - ุงููุณุชูุฏุน ุงููุณุชูุฏู (ูุณููุญ)
- โ **ุงููุฏูุฑ (superuser)** - ุตูุงุญูุงุช ูุงููุฉ (ูุณููุญ)

---

## ๐ฏ ุงูููุงุฆุฏ

### 1. ุงูุฃูุงู ูุงูุฑูุงุจุฉ ุงูุฏุงุฎููุฉ
- โ **ุงููุตู ุจูู ุงูุฃุฏูุงุฑ** (Separation of Duties)
- โ ููุน ุชุถุงุฑุจ ุงููุตุงูุญ
- โ ุถูุงู ุฃู ุดุฎุตุงู ุขุฎุฑ ูุชุญูู ูู ุงูุชุญููู

### 2. ุงูุดูุงููุฉ
- โ ุชุชุจุน ูุงุถุญ ููู ุฃูุดุฃ ุงูุชุญููู ููู ุงุณุชููู
- โ ุณุฌู ูุงูู ููุนูููุงุช

### 3. ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููููุฉ
- โ ุฒุฑ ูุนุทู ูุน ุชูุถูุญ ุงูุณุจุจ (ุจุฏูุงู ูู ุฅุฎูุงุก ุงูุฒุฑ)
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู Backend (ุฃูุงู) ู Frontend (ุชุฌุฑุจุฉ ูุณุชุฎุฏู)

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

1. โ `inventory/views_stock_transfer.py`
   - ุชุนุฏูู `stock_transfer_receive()` - ุงูุณุทูุฑ 359-387
   - ุชุนุฏูู `stock_transfer_detail()` - ุงูุณุทูุฑ 259-299

2. โ `inventory/templates/inventory/stock_transfer_detail.html`
   - ุชุนุฏูู ุฒุฑ ุงูุงุณุชูุงู - ุงูุณุทูุฑ 261-276

3. โ `WAREHOUSE_STAFF_TRANSFER_PERMISSIONS.md`
   - ุชุญุฏูุซ ุงูุชูุซูู ุจุงูููุงุนุฏ ุงูุฌุฏูุฏุฉ

---

## โ ุงูุงุฎุชุจุงุฑ

ุชู ุงุฎุชุจุงุฑ ุงูุณููุงุฑูููุงุช ุงูุชุงููุฉ:

1. โ ููุน ููุดุฆ ุงูุชุญููู ูู ุงุณุชูุงูู
2. โ ุงูุณูุงุญ ูููุธู ุงููุณุชูุฏุน ุงููุณุชูุฏู ุจุงูุงุณุชูุงู
3. โ ููุน ููุธู ูุณุชูุฏุน ุขุฎุฑ ูู ุงูุงุณุชูุงู
4. โ ุงูุณูุงุญ ูููุฏูุฑ ุจุงูุงุณุชูุงู ุฏุงุฆูุงู
5. โ ุนุฑุถ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
6. โ ุฅุธูุงุฑ/ุฅุฎูุงุก ุฒุฑ ุงูุงุณุชูุงู ุญุณุจ ุงูุตูุงุญูุงุช

---

## ๐ ููุงุญุธุงุช

- ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูุชู ูู **Backend** (ุฃูุงู) ู **Frontend** (ุชุฌุฑุจุฉ ูุณุชุฎุฏู)
- ุงููุฏูุฑ (superuser) ูุง ูุชุฃุซุฑ ุจูุฐู ุงููููุฏ ูููููู ุงุณุชูุงู ุฃู ุชุญููู
- ุฑุณุงุฆู ุงูุฎุทุฃ ูุงุถุญุฉ ููููููุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- ุงูุฒุฑ ุงููุนุทู ูุธูุฑ ูุน ุฑุณุงูุฉ ุชูุถูุญูุฉ ุจุฏูุงู ูู ุฅุฎูุงุก ุงูุฒุฑ ุชูุงูุงู

---

**ุชุงุฑูุฎ ุงูุชุทุจูู:** 2025-10-15  
**ุงูุญุงูุฉ:** โ ููุชูู ููุฎุชุจุฑ

